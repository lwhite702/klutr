module.exports=[8466,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,c)};function c(a,c){if("function"!=typeof c&&null!==c)throw TypeError("Class extends value "+String(c)+" is not a constructor or null");function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b,c,d,e,f){function g(a){if(void 0!==a&&"function"!=typeof a)throw TypeError("Function expected");return a}for(var h,i=d.kind,j="getter"===i?"get":"setter"===i?"set":"value",k=!b&&a?d.static?a:a.prototype:null,l=b||(k?Object.getOwnPropertyDescriptor(k,d.name):{}),m=!1,n=c.length-1;n>=0;n--){var o={};for(var p in d)o[p]="access"===p?{}:d[p];for(var p in d.access)o.access[p]=d.access[p];o.addInitializer=function(a){if(m)throw TypeError("Cannot add initializers after decoration has completed");f.push(g(a||null))};var q=(0,c[n])("accessor"===i?{get:l.get,set:l.set}:l[j],o);if("accessor"===i){if(void 0===q)continue;if(null===q||"object"!=typeof q)throw TypeError("Object expected");(h=g(q.get))&&(l.get=h),(h=g(q.set))&&(l.set=h),(h=g(q.init))&&e.unshift(h)}else(h=g(q))&&("field"===i?e.unshift(h):l[j]=h)}k&&Object.defineProperty(k,d.name,l),m=!0}function i(a,b,c){for(var d=arguments.length>2,e=0;e<b.length;e++)c=d?b[e].call(a,c):b[e].call(a);return d?c:void 0}function j(a){return"symbol"==typeof a?a:"".concat(a)}function k(a,b,c){return"symbol"==typeof b&&(b=b.description?"[".concat(b.description,"]"):""),Object.defineProperty(a,"name",{configurable:!0,value:c?"".concat(c," ",b):b})}function l(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function m(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function n(a,b){var c,d,e,f={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=h(0),g.throw=h(1),g.return=h(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function h(h){return function(i){var j=[h,i];if(c)throw TypeError("Generator is already executing.");for(;g&&(g=0,j[0]&&(f=0)),f;)try{if(c=1,d&&(e=2&j[0]?d.return:j[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,j[1])).done)return e;switch(d=0,e&&(j=[2&j[0],e.value]),j[0]){case 0:case 1:e=j;break;case 4:return f.label++,{value:j[1],done:!1};case 5:f.label++,d=j[1],j=[0];continue;case 7:j=f.ops.pop(),f.trys.pop();continue;default:if(!(e=(e=f.trys).length>0&&e[e.length-1])&&(6===j[0]||2===j[0])){f=0;continue}if(3===j[0]&&(!e||j[1]>e[0]&&j[1]<e[3])){f.label=j[1];break}if(6===j[0]&&f.label<e[1]){f.label=e[1],e=j;break}if(e&&f.label<e[2]){f.label=e[2],f.ops.push(j);break}e[2]&&f.ops.pop(),f.trys.pop();continue}j=b.call(a,f)}catch(a){j=[6,a],d=0}finally{c=e=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}}}var o=Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]};function p(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||o(b,a,c)}function q(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function s(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(r(arguments[b]));return a}function t(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function u(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))}function v(a){return this instanceof v?(this.v=a,this):new v(a)}function w(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),g("next"),g("throw"),g("return",function(a){return function(b){return Promise.resolve(b).then(a,j)}}),d[Symbol.asyncIterator]=function(){return this},d;function g(a,b){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})},b&&(d[a]=b(d[a])))}function h(a,b){try{var c;(c=e[a](b)).value instanceof v?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function x(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:v(a[d](b)),done:!1}:e?e(b):b}:e}}function y(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=q(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function z(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}var A=Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b},B=function(a){return(B=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)};function C(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=B(a),d=0;d<c.length;d++)"default"!==c[d]&&o(b,a,c[d]);return A(b,a),b}function D(a){return a&&a.__esModule?a:{default:a}}function E(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}function F(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function G(a,b){if(null===b||"object"!=typeof b&&"function"!=typeof b)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof a?b===a:a.has(b)}function H(a,b,c){if(null!=b){var d,e;if("object"!=typeof b&&"function"!=typeof b)throw TypeError("Object expected.");if(c){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");d=b[Symbol.asyncDispose]}if(void 0===d){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");d=b[Symbol.dispose],c&&(e=d)}if("function"!=typeof d)throw TypeError("Object not disposable.");e&&(d=function(){try{e.call(this)}catch(a){return Promise.reject(a)}}),a.stack.push({value:b,dispose:d,async:c})}else c&&a.stack.push({async:!0});return b}var I="function"==typeof SuppressedError?SuppressedError:function(a,b,c){var d=Error(c);return d.name="SuppressedError",d.error=a,d.suppressed=b,d};function J(a){function b(b){a.error=a.hasError?new I(b,a.error,"An error was suppressed during disposal."):b,a.hasError=!0}var c,d=0;return function e(){for(;c=a.stack.pop();)try{if(!c.async&&1===d)return d=0,a.stack.push(c),Promise.resolve().then(e);if(c.dispose){var f=c.dispose.call(c.value);if(c.async)return d|=2,Promise.resolve(f).then(e,function(a){return b(a),e()})}else d|=1}catch(a){b(a)}if(1===d)return a.hasError?Promise.reject(a.error):Promise.resolve();if(a.hasError)throw a.error}()}function K(a,b){return"string"==typeof a&&/^\.\.?\//.test(a)?a.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,c,d,e,f){return c?b?".jsx":".js":!d||e&&f?d+e+"."+f.toLowerCase()+"js":a}):a}let L={__extends:c,__assign:d,__rest:e,__decorate:f,__param:g,__esDecorate:h,__runInitializers:i,__propKey:j,__setFunctionName:k,__metadata:l,__awaiter:m,__generator:n,__createBinding:o,__exportStar:p,__values:q,__read:r,__spread:s,__spreadArrays:t,__spreadArray:u,__await:v,__asyncGenerator:w,__asyncDelegator:x,__asyncValues:y,__makeTemplateObject:z,__importStar:C,__importDefault:D,__classPrivateFieldGet:E,__classPrivateFieldSet:F,__classPrivateFieldIn:G,__addDisposableResource:H,__disposeResources:J,__rewriteRelativeImportExtension:K};a.s(["__addDisposableResource",()=>H,"__assign",()=>d,"__asyncDelegator",()=>x,"__asyncGenerator",()=>w,"__asyncValues",()=>y,"__await",()=>v,"__awaiter",()=>m,"__classPrivateFieldGet",()=>E,"__classPrivateFieldIn",()=>G,"__classPrivateFieldSet",()=>F,"__createBinding",()=>o,"__decorate",()=>f,"__disposeResources",()=>J,"__esDecorate",()=>h,"__exportStar",()=>p,"__extends",()=>c,"__generator",()=>n,"__importDefault",()=>D,"__importStar",()=>C,"__makeTemplateObject",()=>z,"__metadata",()=>l,"__param",()=>g,"__propKey",()=>j,"__read",()=>r,"__rest",()=>e,"__rewriteRelativeImportExtension",()=>K,"__runInitializers",()=>i,"__setFunctionName",()=>k,"__spread",()=>s,"__spreadArray",()=>u,"__spreadArrays",()=>t,"__values",()=>q,"default",0,L])},23996,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=class extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}},69728,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8466),e=d.__importDefault(a.r(3328)),f=d.__importDefault(a.r(23996));c.default=class{constructor(a){var b,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=null!=(b=a.shouldThrowOnError)&&b,this.signal=a.signal,this.isMaybeSingle=null!=(c=a.isMaybeSingle)&&c,a.fetch?this.fetch=a.fetch:"undefined"==typeof fetch?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,b){return this.headers=new Headers(this.headers),this.headers.set(a,b),this}then(a,b){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let c=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var b,c,d,e;let g=null,h=null,i=null,j=a.status,k=a.statusText;if(a.ok){if("HEAD"!==this.method){let c=await a.text();""===c||(h="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null==(b=this.headers.get("Accept"))?void 0:b.includes("application/vnd.pgrst.plan+text"))?c:JSON.parse(c))}let e=null==(c=this.headers.get("Prefer"))?void 0:c.match(/count=(exact|planned|estimated)/),f=null==(d=a.headers.get("content-range"))?void 0:d.split("/");e&&f&&f.length>1&&(i=parseInt(f[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(h)&&(h.length>1?(g={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,i=null,j=406,k="Not Acceptable"):h=1===h.length?h[0]:null)}else{let b=await a.text();try{g=JSON.parse(b),Array.isArray(g)&&404===a.status&&(h=[],g=null,j=200,k="OK")}catch(c){404===a.status&&""===b?(j=204,k="No Content"):g={message:b}}if(g&&this.isMaybeSingle&&(null==(e=null==g?void 0:g.details)?void 0:e.includes("0 rows"))&&(g=null,j=200,k="OK"),g&&this.shouldThrowOnError)throw new f.default(g)}return{error:g,data:h,count:i,status:j,statusText:k}});return this.shouldThrowOnError||(c=c.catch(a=>{var b,c,d;return{error:{message:`${null!=(b=null==a?void 0:a.name)?b:"FetchError"}: ${null==a?void 0:a.message}`,details:`${null!=(c=null==a?void 0:a.stack)?c:""}`,hint:"",code:`${null!=(d=null==a?void 0:a.code)?d:""}`},data:null,count:null,status:0,statusText:""}})),c.then(a,b)}returns(){return this}overrideTypes(){return this}}},21332,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8466).__importDefault(a.r(69728));class e extends d.default{select(a){let b=!1,c=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!b?"":('"'===a&&(b=!b),a)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:b=!0,nullsFirst:c,foreignTable:d,referencedTable:e=d}={}){let f=e?`${e}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${a}.${b?"asc":"desc"}${void 0===c?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:b,referencedTable:c=b}={}){let d=void 0===c?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,b,{foreignTable:c,referencedTable:d=c}={}){let e=void 0===d?"offset":`${d}.offset`,f=void 0===d?"limit":`${d}.limit`;return this.url.searchParams.set(e,`${a}`),this.url.searchParams.set(f,`${b-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:b=!1,settings:c=!1,buffers:d=!1,wal:e=!1,format:f="text"}={}){var g;let h=[a?"analyze":null,b?"verbose":null,c?"settings":null,d?"buffers":null,e?"wal":null].filter(Boolean).join("|"),i=null!=(g=this.headers.get("Accept"))?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${i}"; options=${h};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}c.default=e},63175,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8466).__importDefault(a.r(21332)),e=RegExp("[,()]");class f extends d.default{eq(a,b){return this.url.searchParams.append(a,`eq.${b}`),this}neq(a,b){return this.url.searchParams.append(a,`neq.${b}`),this}gt(a,b){return this.url.searchParams.append(a,`gt.${b}`),this}gte(a,b){return this.url.searchParams.append(a,`gte.${b}`),this}lt(a,b){return this.url.searchParams.append(a,`lt.${b}`),this}lte(a,b){return this.url.searchParams.append(a,`lte.${b}`),this}like(a,b){return this.url.searchParams.append(a,`like.${b}`),this}likeAllOf(a,b){return this.url.searchParams.append(a,`like(all).{${b.join(",")}}`),this}likeAnyOf(a,b){return this.url.searchParams.append(a,`like(any).{${b.join(",")}}`),this}ilike(a,b){return this.url.searchParams.append(a,`ilike.${b}`),this}ilikeAllOf(a,b){return this.url.searchParams.append(a,`ilike(all).{${b.join(",")}}`),this}ilikeAnyOf(a,b){return this.url.searchParams.append(a,`ilike(any).{${b.join(",")}}`),this}is(a,b){return this.url.searchParams.append(a,`is.${b}`),this}in(a,b){let c=Array.from(new Set(b)).map(a=>"string"==typeof a&&e.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(a,`in.(${c})`),this}contains(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cs.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cs.{${b.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(b)}`),this}containedBy(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cd.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cd.{${b.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(b)}`),this}rangeGt(a,b){return this.url.searchParams.append(a,`sr.${b}`),this}rangeGte(a,b){return this.url.searchParams.append(a,`nxl.${b}`),this}rangeLt(a,b){return this.url.searchParams.append(a,`sl.${b}`),this}rangeLte(a,b){return this.url.searchParams.append(a,`nxr.${b}`),this}rangeAdjacent(a,b){return this.url.searchParams.append(a,`adj.${b}`),this}overlaps(a,b){return"string"==typeof b?this.url.searchParams.append(a,`ov.${b}`):this.url.searchParams.append(a,`ov.{${b.join(",")}}`),this}textSearch(a,b,{config:c,type:d}={}){let e="";"plain"===d?e="pl":"phrase"===d?e="ph":"websearch"===d&&(e="w");let f=void 0===c?"":`(${c})`;return this.url.searchParams.append(a,`${e}fts${f}.${b}`),this}match(a){return Object.entries(a).forEach(([a,b])=>{this.url.searchParams.append(a,`eq.${b}`)}),this}not(a,b,c){return this.url.searchParams.append(a,`not.${b}.${c}`),this}or(a,{foreignTable:b,referencedTable:c=b}={}){let d=c?`${c}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,b,c){return this.url.searchParams.append(a,`${b}.${c}`),this}}c.default=f},54413,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8466).__importDefault(a.r(63175));c.default=class{constructor(a,{headers:b={},schema:c,fetch:d}){this.url=a,this.headers=new Headers(b),this.schema=c,this.fetch=d}select(a,b){let{head:c=!1,count:e}=null!=b?b:{},f=!1,g=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!f?"":('"'===a&&(f=!f),a)).join("");return this.url.searchParams.set("select",g),e&&this.headers.append("Prefer",`count=${e}`),new d.default({method:c?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:b,defaultToNull:c=!0}={}){var e;if(b&&this.headers.append("Prefer",`count=${b}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new d.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(e=this.fetch)?e:fetch})}upsert(a,{onConflict:b,ignoreDuplicates:c=!1,count:e,defaultToNull:f=!0}={}){var g;if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),void 0!==b&&this.url.searchParams.set("on_conflict",b),e&&this.headers.append("Prefer",`count=${e}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new d.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(g=this.fetch)?g:fetch})}update(a,{count:b}={}){var c;return b&&this.headers.append("Prefer",`count=${b}`),new d.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(c=this.fetch)?c:fetch})}delete({count:a}={}){var b;return a&&this.headers.append("Prefer",`count=${a}`),new d.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(b=this.fetch)?b:fetch})}}},72893,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8466),e=d.__importDefault(a.r(54413)),f=d.__importDefault(a.r(63175));class g{constructor(a,{headers:b={},schema:c,fetch:d}={}){this.url=a,this.headers=new Headers(b),this.schemaName=c,this.fetch=d}from(a){let b=new URL(`${this.url}/${a}`);return new e.default(b,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new g(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,b={},{head:c=!1,get:d=!1,count:e}={}){var g;let h,i,j=new URL(`${this.url}/rpc/${a}`);c||d?(h=c?"HEAD":"GET",Object.entries(b).filter(([a,b])=>void 0!==b).map(([a,b])=>[a,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([a,b])=>{j.searchParams.append(a,b)})):(h="POST",i=b);let k=new Headers(this.headers);return e&&k.set("Prefer",`count=${e}`),new f.default({method:h,url:j,headers:k,schema:this.schemaName,body:i,fetch:null!=(g=this.fetch)?g:fetch})}}c.default=g},22177,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PostgrestError=c.PostgrestBuilder=c.PostgrestTransformBuilder=c.PostgrestFilterBuilder=c.PostgrestQueryBuilder=c.PostgrestClient=void 0;let d=a.r(8466),e=d.__importDefault(a.r(72893));c.PostgrestClient=e.default;let f=d.__importDefault(a.r(54413));c.PostgrestQueryBuilder=f.default;let g=d.__importDefault(a.r(63175));c.PostgrestFilterBuilder=g.default;let h=d.__importDefault(a.r(21332));c.PostgrestTransformBuilder=h.default;let i=d.__importDefault(a.r(69728));c.PostgrestBuilder=i.default;let j=d.__importDefault(a.r(23996));c.PostgrestError=j.default,c.default={PostgrestClient:e.default,PostgrestQueryBuilder:f.default,PostgrestFilterBuilder:g.default,PostgrestTransformBuilder:h.default,PostgrestBuilder:i.default,PostgrestError:j.default}},25657,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),c.parse=function(a,b){let c=new j,d=a.length;if(d<2)return c;let e=b?.decode||m,f=0;do{let b=a.indexOf("=",f);if(-1===b)break;let g=a.indexOf(";",f),h=-1===g?d:g;if(b>h){f=a.lastIndexOf(";",b-1)+1;continue}let i=k(a,f,b),j=l(a,b,i),m=a.slice(i,j);if(void 0===c[m]){let d=k(a,b+1,h),f=l(a,h,d),g=e(a.slice(d,f));c[m]=g}f=h+1}while(f<d)return c},c.serialize=function(a,b,c){let d=c?.encode||encodeURIComponent;if(!e.test(a))throw TypeError(`argument name is invalid: ${a}`);let j=d(b);if(!f.test(j))throw TypeError(`argument val is invalid: ${b}`);let k=a+"="+j;if(!c)return k;if(void 0!==c.maxAge){if(!Number.isInteger(c.maxAge))throw TypeError(`option maxAge is invalid: ${c.maxAge}`);k+="; Max-Age="+c.maxAge}if(c.domain){if(!g.test(c.domain))throw TypeError(`option domain is invalid: ${c.domain}`);k+="; Domain="+c.domain}if(c.path){if(!h.test(c.path))throw TypeError(`option path is invalid: ${c.path}`);k+="; Path="+c.path}if(c.expires){var l;if(l=c.expires,"[object Date]"!==i.call(l)||!Number.isFinite(c.expires.valueOf()))throw TypeError(`option expires is invalid: ${c.expires}`);k+="; Expires="+c.expires.toUTCString()}if(c.httpOnly&&(k+="; HttpOnly"),c.secure&&(k+="; Secure"),c.partitioned&&(k+="; Partitioned"),c.priority)switch("string"==typeof c.priority?c.priority.toLowerCase():void 0){case"low":k+="; Priority=Low";break;case"medium":k+="; Priority=Medium";break;case"high":k+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${c.priority}`)}if(c.sameSite)switch("string"==typeof c.sameSite?c.sameSite.toLowerCase():c.sameSite){case!0:case"strict":k+="; SameSite=Strict";break;case"lax":k+="; SameSite=Lax";break;case"none":k+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${c.sameSite}`)}return k};let e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,f=/^[\u0021-\u003A\u003C-\u007E]*$/,g=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,h=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,j=((d=function(){}).prototype=Object.create(null),d);function k(a,b,c){do{let c=a.charCodeAt(b);if(32!==c&&9!==c)return b}while(++b<c)return c}function l(a,b,c){for(;b>c;){let c=a.charCodeAt(--b);if(32!==c&&9!==c)return b+1}return c}function m(a){if(-1===a.indexOf("%"))return a;try{return decodeURIComponent(a)}catch(b){return a}}},5211,(a,b,c)=>{},14698,a=>{"use strict";let b,c,d,e,f;var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=a.i(42990);a.i(92864);var v=a.i(66375),w=a.i(8466);class x extends Error{constructor(a,b="FunctionsError",c){super(a),this.name=b,this.context=c}}class y extends x{constructor(a){super("Failed to send a request to the Edge Function","FunctionsFetchError",a)}}class z extends x{constructor(a){super("Relay Error invoking the Edge Function","FunctionsRelayError",a)}}class A extends x{constructor(a){super("Edge Function returned a non-2xx status code","FunctionsHttpError",a)}}(c3=de||(de={})).Any="any",c3.ApNortheast1="ap-northeast-1",c3.ApNortheast2="ap-northeast-2",c3.ApSouth1="ap-south-1",c3.ApSoutheast1="ap-southeast-1",c3.ApSoutheast2="ap-southeast-2",c3.CaCentral1="ca-central-1",c3.EuCentral1="eu-central-1",c3.EuWest1="eu-west-1",c3.EuWest2="eu-west-2",c3.EuWest3="eu-west-3",c3.SaEast1="sa-east-1",c3.UsEast1="us-east-1",c3.UsWest1="us-west-1",c3.UsWest2="us-west-2";class B{constructor(b,{headers:c={},customFetch:d,region:e=de.Any}={}){this.url=b,this.headers=c,this.region=e,this.fetch=(b=>{let c;return c=b||("undefined"==typeof fetch?(...b)=>a.A(3062).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)})(d)}setAuth(a){this.headers.Authorization=`Bearer ${a}`}invoke(a){return(0,w.__awaiter)(this,arguments,void 0,function*(a,b={}){var c;try{let d,{headers:e,method:f,body:g,signal:h}=b,i={},{region:j}=b;j||(j=this.region);let k=new URL(`${this.url}/${a}`);j&&"any"!==j&&(i["x-region"]=j,k.searchParams.set("forceFunctionRegion",j)),g&&(e&&!Object.prototype.hasOwnProperty.call(e,"Content-Type")||!e)?"undefined"!=typeof Blob&&g instanceof Blob||g instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",d=g):"string"==typeof g?(i["Content-Type"]="text/plain",d=g):"undefined"!=typeof FormData&&g instanceof FormData?d=g:(i["Content-Type"]="application/json",d=JSON.stringify(g)):d=g;let l=yield this.fetch(k.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),e),body:d,signal:h}).catch(a=>{if("AbortError"===a.name)throw a;throw new y(a)}),m=l.headers.get("x-relay-error");if(m&&"true"===m)throw new z(l);if(!l.ok)throw new A(l);let n=(null!=(c=l.headers.get("Content-Type"))?c:"text/plain").split(";")[0].trim();return{data:"application/json"===n?yield l.json():"application/octet-stream"===n||"application/pdf"===n?yield l.blob():"text/event-stream"===n?l:"multipart/form-data"===n?yield l.formData():yield l.text(),error:null,response:l}}catch(a){if(a instanceof Error&&"AbortError"===a.name)return{data:null,error:new y(a)};return{data:null,error:a,response:a instanceof A||a instanceof z?a.context:void 0}}})}}var C=a.i(22177);let{PostgrestClient:D,PostgrestQueryBuilder:E,PostgrestFilterBuilder:F,PostgrestTransformBuilder:G,PostgrestBuilder:H,PostgrestError:I}=C.default||C,J=class{static detectEnvironment(){var b;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==a.g.WebSocket)return{type:"native",constructor:a.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(b=navigator.userAgent)?void 0:b.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){let a=process.versions;if(a&&a.node){let b=parseInt(a.node.replace(/^v/,"").split(".")[0]);return b>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${b} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${b} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let a=this.detectEnvironment();if(a.constructor)return a.constructor;let b=a.error||"WebSocket not supported in this environment.";throw a.workaround&&(b+=`

Suggested solution: ${a.workaround}`),Error(b)}static createWebSocket(a,b){return new(this.getWebSocketConstructor())(a,b)}static isWebSocketSupported(){try{let a=this.detectEnvironment();return"native"===a.type||"ws"===a.type}catch(a){return!1}}};(c4=df||(df={}))[c4.connecting=0]="connecting",c4[c4.open=1]="open",c4[c4.closing=2]="closing",c4[c4.closed=3]="closed",(c5=dg||(dg={})).closed="closed",c5.errored="errored",c5.joined="joined",c5.joining="joining",c5.leaving="leaving",(c6=dh||(dh={})).close="phx_close",c6.error="phx_error",c6.join="phx_join",c6.reply="phx_reply",c6.leave="phx_leave",c6.access_token="access_token",(di||(di={})).websocket="websocket",(c7=dj||(dj={})).Connecting="connecting",c7.Open="open",c7.Closing="closing",c7.Closed="closed";class K{constructor(){this.HEADER_LENGTH=1}decode(a,b){return a.constructor===ArrayBuffer?b(this._binaryDecode(a)):"string"==typeof a?b(JSON.parse(a)):b({})}_binaryDecode(a){let b=new DataView(a),c=new TextDecoder;return this._decodeBroadcast(a,b,c)}_decodeBroadcast(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=this.HEADER_LENGTH+2,g=c.decode(a.slice(f,f+d));f+=d;let h=c.decode(a.slice(f,f+e));return f+=e,{ref:null,topic:g,event:h,payload:JSON.parse(c.decode(a.slice(f,a.byteLength)))}}}class L{constructor(a,b){this.callback=a,this.timerCalc=b,this.timer=void 0,this.tries=0,this.callback=a,this.timerCalc=b}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(c8=dk||(dk={})).abstime="abstime",c8.bool="bool",c8.date="date",c8.daterange="daterange",c8.float4="float4",c8.float8="float8",c8.int2="int2",c8.int4="int4",c8.int4range="int4range",c8.int8="int8",c8.int8range="int8range",c8.json="json",c8.jsonb="jsonb",c8.money="money",c8.numeric="numeric",c8.oid="oid",c8.reltime="reltime",c8.text="text",c8.time="time",c8.timestamp="timestamp",c8.timestamptz="timestamptz",c8.timetz="timetz",c8.tsrange="tsrange",c8.tstzrange="tstzrange";let M=(a,b,c={})=>{var d;let e=null!=(d=c.skipTypes)?d:[];return b?Object.keys(b).reduce((c,d)=>(c[d]=N(d,a,b,e),c),{}):{}},N=(a,b,c,d)=>{let e=b.find(b=>b.name===a),f=null==e?void 0:e.type,g=c[a];return f&&!d.includes(f)?O(f,g):P(g)},O=(a,b)=>{if("_"===a.charAt(0))return T(b,a.slice(1,a.length));switch(a){case dk.bool:return Q(b);case dk.float4:case dk.float8:case dk.int2:case dk.int4:case dk.int8:case dk.numeric:case dk.oid:return R(b);case dk.json:case dk.jsonb:return S(b);case dk.timestamp:return U(b);case dk.abstime:case dk.date:case dk.daterange:case dk.int4range:case dk.int8range:case dk.money:case dk.reltime:case dk.text:case dk.time:case dk.timestamptz:case dk.timetz:case dk.tsrange:case dk.tstzrange:default:return P(b)}},P=a=>a,Q=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},R=a=>{if("string"==typeof a){let b=parseFloat(a);if(!Number.isNaN(b))return b}return a},S=a=>{if("string"==typeof a)try{return JSON.parse(a)}catch(a){console.log(`JSON parse error: ${a}`)}return a},T=(a,b)=>{if("string"!=typeof a)return a;let c=a.length-1,d=a[c];if("{"===a[0]&&"}"===d){let d,e=a.slice(1,c);try{d=JSON.parse("["+e+"]")}catch(a){d=e?e.split(","):[]}return d.map(a=>O(b,a))}return a},U=a=>"string"==typeof a?a.replace(" ","T"):a,V=a=>{let b=new URL(a);return b.protocol=b.protocol.replace(/^ws/i,"http"),b.pathname=b.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===b.pathname||"/"===b.pathname?b.pathname="/api/broadcast":b.pathname=b.pathname+"/api/broadcast",b.href};class W{constructor(a,b,c={},d=1e4){this.channel=a,this.event=b,this.payload=c,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(a){this.timeout=a,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(a){this.payload=Object.assign(Object.assign({},this.payload),a)}receive(a,b){var c;return this._hasReceived(a)&&b(null==(c=this.receivedResp)?void 0:c.response),this.recHooks.push({status:a,callback:b}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let a=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},a),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(a,b){this.refEvent&&this.channel._trigger(this.refEvent,{status:a,response:b})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:a,response:b}){this.recHooks.filter(b=>b.status===a).forEach(a=>a.callback(b))}_hasReceived(a){return this.receivedResp&&this.receivedResp.status===a}}(c9=dl||(dl={})).SYNC="sync",c9.JOIN="join",c9.LEAVE="leave";class X{constructor(a,b){this.channel=a,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(null==b?void 0:b.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=X.syncState(this.state,a,b,c),this.pendingDiffs.forEach(a=>{this.state=X.syncDiff(this.state,a,b,c)}),this.pendingDiffs=[],d()}),this.channel._on(c.diff,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=X.syncDiff(this.state,a,b,c),d())}),this.onJoin((a,b,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:b,newPresences:c})}),this.onLeave((a,b,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:b,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(a,b,c,d){let e=this.cloneDeep(a),f=this.transformState(b),g={},h={};return this.map(e,(a,b)=>{f[a]||(h[a]=b)}),this.map(f,(a,b)=>{let c=e[a];if(c){let d=b.map(a=>a.presence_ref),e=c.map(a=>a.presence_ref),f=b.filter(a=>0>e.indexOf(a.presence_ref)),i=c.filter(a=>0>d.indexOf(a.presence_ref));f.length>0&&(g[a]=f),i.length>0&&(h[a]=i)}else g[a]=b}),this.syncDiff(e,{joins:g,leaves:h},c,d)}static syncDiff(a,b,c,d){let{joins:e,leaves:f}={joins:this.transformState(b.joins),leaves:this.transformState(b.leaves)};return c||(c=()=>{}),d||(d=()=>{}),this.map(e,(b,d)=>{var e;let f=null!=(e=a[b])?e:[];if(a[b]=this.cloneDeep(d),f.length>0){let c=a[b].map(a=>a.presence_ref),d=f.filter(a=>0>c.indexOf(a.presence_ref));a[b].unshift(...d)}c(b,f,d)}),this.map(f,(b,c)=>{let e=a[b];if(!e)return;let f=c.map(a=>a.presence_ref);e=e.filter(a=>0>f.indexOf(a.presence_ref)),a[b]=e,d(b,e,c),0===e.length&&delete a[b]}),a}static map(a,b){return Object.getOwnPropertyNames(a).map(c=>b(c,a[c]))}static transformState(a){return Object.getOwnPropertyNames(a=this.cloneDeep(a)).reduce((b,c)=>{let d=a[c];return"metas"in d?b[c]=d.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):b[c]=d,b},{})}static cloneDeep(a){return JSON.parse(JSON.stringify(a))}onJoin(a){this.caller.onJoin=a}onLeave(a){this.caller.onLeave=a}onSync(a){this.caller.onSync=a}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(da=dm||(dm={})).ALL="*",da.INSERT="INSERT",da.UPDATE="UPDATE",da.DELETE="DELETE",(db=dn||(dn={})).BROADCAST="broadcast",db.PRESENCE="presence",db.POSTGRES_CHANGES="postgres_changes",db.SYSTEM="system",(dc=dp||(dp={})).SUBSCRIBED="SUBSCRIBED",dc.TIMED_OUT="TIMED_OUT",dc.CLOSED="CLOSED",dc.CHANNEL_ERROR="CHANNEL_ERROR";class Y{constructor(a,b={config:{}},c){var d,e;if(this.topic=a,this.params=b,this.socket=c,this.bindings={},this.state=dg.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=a.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},b.config),this.timeout=this.socket.timeout,this.joinPush=new W(this,dh.join,this.params,this.timeout),this.rejoinTimer=new L(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dg.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dg.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dg.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dg.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dg.errored,this.rejoinTimer.scheduleTimeout())}),this._on(dh.reply,{},(a,b)=>{this._trigger(this._replyEventName(b),a)}),this.presence=new X(this),this.broadcastEndpointURL=V(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(e=null==(d=this.params.config)?void 0:d.broadcast)?void 0:e.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(a,b=this.timeout){var c,d,e;if(this.socket.isConnected()||this.socket.connect(),this.state==dg.closed){let{config:{broadcast:f,presence:g,private:h}}=this.params,i=null!=(d=null==(c=this.bindings.postgres_changes)?void 0:c.map(a=>a.filter))?d:[],j=!!this.bindings[dn.PRESENCE]&&this.bindings[dn.PRESENCE].length>0||(null==(e=this.params.config.presence)?void 0:e.enabled)===!0,k={},l={broadcast:f,presence:Object.assign(Object.assign({},g),{enabled:j}),postgres_changes:i,private:h};this.socket.accessTokenValue&&(k.access_token=this.socket.accessTokenValue),this._onError(b=>null==a?void 0:a(dp.CHANNEL_ERROR,b)),this._onClose(()=>null==a?void 0:a(dp.CLOSED)),this.updateJoinPayload(Object.assign({config:l},k)),this.joinedOnce=!0,this._rejoin(b),this.joinPush.receive("ok",async({postgres_changes:b})=>{var c;if(this.socket.setAuth(),void 0===b){null==a||a(dp.SUBSCRIBED);return}{let d=this.bindings.postgres_changes,e=null!=(c=null==d?void 0:d.length)?c:0,f=[];for(let c=0;c<e;c++){let e=d[c],{filter:{event:g,schema:h,table:i,filter:j}}=e,k=b&&b[c];if(k&&k.event===g&&k.schema===h&&k.table===i&&k.filter===j)f.push(Object.assign(Object.assign({},e),{id:k.id}));else{this.unsubscribe(),this.state=dg.errored,null==a||a(dp.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,a&&a(dp.SUBSCRIBED);return}}).receive("error",b=>{this.state=dg.errored,null==a||a(dp.CHANNEL_ERROR,Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{null==a||a(dp.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(a,b={}){return await this.send({type:"presence",event:"track",payload:a},b.timeout||this.timeout)}async untrack(a={}){return await this.send({type:"presence",event:"untrack"},a)}on(a,b,c){return this.state===dg.joined&&a===dn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(a,b,c)}async httpSend(a,b,c={}){var d;let e=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==b)return Promise.reject("Payload is required for httpSend()");let f={method:"POST",headers:{Authorization:e,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:b,private:this.private}]})},g=await this._fetchWithTimeout(this.broadcastEndpointURL,f,null!=(d=c.timeout)?d:this.timeout);if(202===g.status)return{success:!0};let h=g.statusText;try{let a=await g.json();h=a.error||a.message||h}catch(a){}return Promise.reject(Error(h))}async send(a,b={}){var c,d;if(this._canPush()||"broadcast"!==a.type)return new Promise(c=>{var d,e,f;let g=this._push(a.type,a,b.timeout||this.timeout);"broadcast"!==a.type||(null==(f=null==(e=null==(d=this.params)?void 0:d.config)?void 0:e.broadcast)?void 0:f.ack)||c("ok"),g.receive("ok",()=>c("ok")),g.receive("error",()=>c("error")),g.receive("timeout",()=>c("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:e,payload:f}=a,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:f,private:this.private}]})};try{let a=await this._fetchWithTimeout(this.broadcastEndpointURL,g,null!=(c=b.timeout)?c:this.timeout);return await (null==(d=a.body)?void 0:d.cancel()),a.ok?"ok":"error"}catch(a){if("AbortError"===a.name)return"timed out";return"error"}}}updateJoinPayload(a){this.joinPush.updatePayload(a)}unsubscribe(a=this.timeout){this.state=dg.leaving;let b=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(dh.close,"leave",this._joinRef())};this.joinPush.destroy();let c=null;return new Promise(d=>{(c=new W(this,dh.leave,{},a)).receive("ok",()=>{b(),d("ok")}).receive("timeout",()=>{b(),d("timed out")}).receive("error",()=>{d("error")}),c.send(),this._canPush()||c.trigger("ok",{})}).finally(()=>{null==c||c.destroy()})}teardown(){this.pushBuffer.forEach(a=>a.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dg.closed,this.bindings={}}async _fetchWithTimeout(a,b,c){let d=new AbortController,e=setTimeout(()=>d.abort(),c),f=await this.socket.fetch(a,Object.assign(Object.assign({},b),{signal:d.signal}));return clearTimeout(e),f}_push(a,b,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${a}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new W(this,a,b,c);return this._canPush()?d.send():this._addToPushBuffer(d),d}_addToPushBuffer(a){if(a.startTimeout(),this.pushBuffer.push(a),this.pushBuffer.length>100){let a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(a,b,c){return b}_isMember(a){return this.topic===a}_joinRef(){return this.joinPush.ref}_trigger(a,b,c){var d,e;let f=a.toLocaleLowerCase(),{close:g,error:h,leave:i,join:j}=dh;if(c&&[g,h,i,j].indexOf(f)>=0&&c!==this._joinRef())return;let k=this._onMessage(f,b,c);if(b&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?null==(d=this.bindings.postgres_changes)||d.filter(a=>{var b,c,d;return(null==(b=a.filter)?void 0:b.event)==="*"||(null==(d=null==(c=a.filter)?void 0:c.event)?void 0:d.toLocaleLowerCase())===f}).map(a=>a.callback(k,c)):null==(e=this.bindings[f])||e.filter(a=>{var c,d,e,g,h,i;if(!["broadcast","presence","postgres_changes"].includes(f))return a.type.toLocaleLowerCase()===f;if("id"in a){let f=a.id,g=null==(c=a.filter)?void 0:c.event;return f&&(null==(d=b.ids)?void 0:d.includes(f))&&("*"===g||(null==g?void 0:g.toLocaleLowerCase())===(null==(e=b.data)?void 0:e.type.toLocaleLowerCase()))}{let c=null==(h=null==(g=null==a?void 0:a.filter)?void 0:g.event)?void 0:h.toLocaleLowerCase();return"*"===c||c===(null==(i=null==b?void 0:b.event)?void 0:i.toLocaleLowerCase())}}).map(a=>{if("object"==typeof k&&"ids"in k){let a=k.data,{schema:b,table:c,commit_timestamp:d,type:e,errors:f}=a;k=Object.assign(Object.assign({},{schema:b,table:c,commit_timestamp:d,eventType:e,new:{},old:{},errors:f}),this._getPayloadRecords(a))}a.callback(k,c)})}_isClosed(){return this.state===dg.closed}_isJoined(){return this.state===dg.joined}_isJoining(){return this.state===dg.joining}_isLeaving(){return this.state===dg.leaving}_replyEventName(a){return`chan_reply_${a}`}_on(a,b,c){let d=a.toLocaleLowerCase(),e={type:d,filter:b,callback:c};return this.bindings[d]?this.bindings[d].push(e):this.bindings[d]=[e],this}_off(a,b){let c=a.toLocaleLowerCase();return this.bindings[c]&&(this.bindings[c]=this.bindings[c].filter(a=>{var d;return!((null==(d=a.type)?void 0:d.toLocaleLowerCase())===c&&Y.isEqual(a.filter,b))})),this}static isEqual(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(a[c]!==b[c])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(a){this._on(dh.close,{},a)}_onError(a){this._on(dh.error,{},b=>a(b))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(a=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dg.joining,this.joinPush.resend(a))}_getPayloadRecords(a){let b={new:{},old:{}};return("INSERT"===a.type||"UPDATE"===a.type)&&(b.new=M(a.columns,a.record)),("UPDATE"===a.type||"DELETE"===a.type)&&(b.old=M(a.columns,a.old_record)),b}}let Z=()=>{},$=[1e3,2e3,5e3,1e4],_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class aa{constructor(b,c){var d;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Z,this.ref=0,this.reconnectTimer=null,this.logger=Z,this.conn=null,this.sendBuffer=[],this.serializer=new K,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=b=>{let c;return c=b||("undefined"==typeof fetch?(...b)=>a.A(3062).then(({default:a})=>a(...b)).catch(a=>{throw Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...a)=>c(...a)},!(null==(d=null==c?void 0:c.params)?void 0:d.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=c.params.apikey,this.endPoint=`${b}/${di.websocket}`,this.httpEndpoint=V(b),this._initializeOptions(c),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==c?void 0:c.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=J.createWebSocket(this.endpointURL())}catch(b){this._setConnectionState("disconnected");let a=b.message;if(a.includes("Node.js"))throw Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(a,b){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let c=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(c),this._setConnectionState("disconnected")},a?this.conn.close(a,null!=b?b:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(a){let b=await a.unsubscribe();return 0===this.channels.length&&this.disconnect(),b}async removeAllChannels(){let a=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),a}log(a,b,c){this.logger(a,b,c)}connectionState(){switch(this.conn&&this.conn.readyState){case df.connecting:return dj.Connecting;case df.open:return dj.Open;case df.closing:return dj.Closing;default:return dj.Closed}}isConnected(){return this.connectionState()===dj.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(a,b={config:{}}){let c=`realtime:${a}`,d=this.getChannels().find(a=>a.topic===c);if(d)return d;{let c=new Y(`realtime:${a}`,b,this);return this.channels.push(c),c}}push(a){let{topic:b,event:c,payload:d,ref:e}=a,f=()=>{this.encode(a,a=>{var b;null==(b=this.conn)||b.send(a)})};this.log("push",`${b} ${c} (${e})`,d),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(a=null){this._authPromise=this._performAuth(a);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var a;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,null==(a=this.conn)||a.close(1e3,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||null==(a=this.reconnectTimer)||a.scheduleTimeout()},100);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(a){this.heartbeatCallback=a}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(a=>a()),this.sendBuffer=[])}_makeRef(){let a=this.ref+1;return a===this.ref?this.ref=0:this.ref=a,this.ref.toString()}_leaveOpenTopic(a){let b=this.channels.find(b=>b.topic===a&&(b._isJoined()||b._isJoining()));b&&(this.log("transport",`leaving duplicate topic "${a}"`),b.unsubscribe())}_remove(a){this.channels=this.channels.filter(b=>b.topic!==a.topic)}_onConnMessage(a){this.decode(a.data,a=>{if("phoenix"===a.topic&&"phx_reply"===a.event)try{this.heartbeatCallback("ok"===a.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:b,event:c,payload:d,ref:e}=a,f=e?`(${e})`:"",g=d.status||"";this.log("receive",`${g} ${b} ${c} ${f}`.trim(),d),this.channels.filter(a=>a._isMember(b)).forEach(a=>a._trigger(c,d,e)),this._triggerStateCallbacks("message",a)})}_clearTimer(a){var b;"heartbeat"===a&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===a&&(null==(b=this.reconnectTimer)||b.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=a=>this._onConnError(a),this.conn.onmessage=a=>this._onConnMessage(a),this.conn.onclose=a=>this._onConnClose(a))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(a=>a.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let a=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(a),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{"keepAlive"===a.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(a){var b;this._setConnectionState("disconnected"),this.log("transport","close",a),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(b=this.reconnectTimer)||b.scheduleTimeout(),this._triggerStateCallbacks("close",a)}_onConnError(a){this._setConnectionState("disconnected"),this.log("transport",`${a}`),this._triggerChanError(),this._triggerStateCallbacks("error",a)}_triggerChanError(){this.channels.forEach(a=>a._trigger(dh.error))}_appendParams(a,b){if(0===Object.keys(b).length)return a;let c=a.match(/\?/)?"&":"?",d=new URLSearchParams(b);return`${a}${c}${d}`}_workerObjectUrl(a){let b;if(a)b=a;else{let a=new Blob([_],{type:"application/javascript"});b=URL.createObjectURL(a)}return b}_setConnectionState(a,b=!1){this._connectionState=a,"connecting"===a?this._wasManualDisconnect=!1:"disconnecting"===a&&(this._wasManualDisconnect=b)}async _performAuth(a=null){let b;b=a||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=b&&(this.accessTokenValue=b,this.channels.forEach(a=>{b&&a.updateJoinPayload({access_token:b,version:"realtime-js/2.78.0"}),a.joinedOnce&&a._isJoined()&&a._push(dh.access_token,{access_token:b})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(a="general"){this.setAuth().catch(b=>{this.log("error",`error setting auth in ${a}`,b)})}_triggerStateCallbacks(a,b){try{this.stateChangeCallbacks[a].forEach(c=>{try{c(b)}catch(b){this.log("error",`error in ${a} callback`,b)}})}catch(b){this.log("error",`error triggering ${a} callbacks`,b)}}_setupReconnectionTimer(){this.reconnectTimer=new L(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(a){var b,c,d,e,f,g,h,i,j;this.transport=null!=(b=null==a?void 0:a.transport)?b:null,this.timeout=null!=(c=null==a?void 0:a.timeout)?c:1e4,this.heartbeatIntervalMs=null!=(d=null==a?void 0:a.heartbeatIntervalMs)?d:25e3,this.worker=null!=(e=null==a?void 0:a.worker)&&e,this.accessToken=null!=(f=null==a?void 0:a.accessToken)?f:null,this.heartbeatCallback=null!=(g=null==a?void 0:a.heartbeatCallback)?g:Z,(null==a?void 0:a.params)&&(this.params=a.params),(null==a?void 0:a.logger)&&(this.logger=a.logger),((null==a?void 0:a.logLevel)||(null==a?void 0:a.log_level))&&(this.logLevel=a.logLevel||a.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(h=null==a?void 0:a.reconnectAfterMs)?h:a=>$[a-1]||1e4,this.encode=null!=(i=null==a?void 0:a.encode)?i:(a,b)=>b(JSON.stringify(a)),this.decode=null!=(j=null==a?void 0:a.decode)?j:this.serializer.decode.bind(this.serializer),this.worker&&(this.workerUrl=null==a?void 0:a.workerUrl)}}class ab extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}}function ac(a){return"object"==typeof a&&null!==a&&"__isStorageError"in a}class ad extends ab{constructor(a,b,c){super(a),this.name="StorageApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ae extends ab{constructor(a,b){super(a),this.name="StorageUnknownError",this.originalError=b}}let af=b=>{let c;return c=b||("undefined"==typeof fetch?(...b)=>a.A(3062).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},ag=a=>{if(Array.isArray(a))return a.map(a=>ag(a));if("function"==typeof a||a!==Object(a))return a;let b={};return Object.entries(a).forEach(([a,c])=>{b[a.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""))]=ag(c)}),b},ah=a=>{var b;return a.msg||a.message||a.error_description||("string"==typeof a.error?a.error:null==(b=a.error)?void 0:b.message)||JSON.stringify(a)};function ai(b,c,d,e,f,g){return(0,w.__awaiter)(this,void 0,void 0,function*(){return new Promise((h,i)=>{let j;b(d,(j={method:c,headers:(null==e?void 0:e.headers)||{}},"GET"===c||!g?j:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(g)?(j.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),j.body=JSON.stringify(g)):j.body=g,(null==e?void 0:e.duplex)&&(j.duplex=e.duplex),Object.assign(Object.assign({},j),f)))).then(a=>{if(!a.ok)throw a;return(null==e?void 0:e.noResolveJson)?a:a.json()}).then(a=>h(a)).catch(b=>(0,w.__awaiter)(void 0,void 0,void 0,function*(){b instanceof(yield(0,w.__awaiter)(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield a.A(3062)).Response:Response}))&&!(null==e?void 0:e.noResolveJson)?b.json().then(a=>{let c=b.status||500,d=(null==a?void 0:a.statusCode)||c+"";i(new ad(ah(a),c,d))}).catch(a=>{i(new ae(ah(a),a))}):i(new ae(ah(b),b))}))})})}function aj(a,b,c,d){return(0,w.__awaiter)(this,void 0,void 0,function*(){return ai(a,"GET",b,c,d)})}function ak(a,b,c,d,e){return(0,w.__awaiter)(this,void 0,void 0,function*(){return ai(a,"POST",b,d,e,c)})}function al(a,b,c,d,e){return(0,w.__awaiter)(this,void 0,void 0,function*(){return ai(a,"PUT",b,d,e,c)})}function am(a,b,c,d,e){return(0,w.__awaiter)(this,void 0,void 0,function*(){return ai(a,"DELETE",b,d,e,c)})}class an{constructor(a,b){this.downloadFn=a,this.shouldThrowOnError=b}then(a,b){return this.execute().then(a,b)}execute(){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}}dq=Symbol.toStringTag;let ao=class{constructor(a,b){this.downloadFn=a,this.shouldThrowOnError=b,this[dq]="BlobDownloadBuilder",this.promise=null}asStream(){return new an(this.downloadFn,this.shouldThrowOnError)}then(a,b){return this.getPromise().then(a,b)}catch(a){return this.getPromise().catch(a)}finally(a){return this.getPromise().finally(a)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let a=yield this.downloadFn();return{data:yield a.blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}},ap={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},aq={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ar{constructor(a,b={},c,d){this.shouldThrowOnError=!1,this.url=a,this.headers=b,this.bucketId=c,this.fetch=af(d)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(a,b,c,d){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let e,f=Object.assign(Object.assign({},aq),d),g=Object.assign(Object.assign({},this.headers),"POST"===a&&{"x-upsert":String(f.upsert)}),h=f.metadata;"undefined"!=typeof Blob&&c instanceof Blob?((e=new FormData).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h)),e.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?((e=c).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h))):(e=c,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,h&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(h)))),(null==d?void 0:d.headers)&&(g=Object.assign(Object.assign({},g),d.headers));let i=this._removeEmptyFolders(b),j=this._getFinalPath(i),k=yield("PUT"==a?al:ak)(this.fetch,`${this.url}/object/${j}`,e,Object.assign({headers:g},(null==f?void 0:f.duplex)?{duplex:f.duplex}:{}));return{data:{path:i,id:k.Id,fullPath:k.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}upload(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",a,b,c)})}uploadToSignedUrl(a,b,c,d){return(0,w.__awaiter)(this,void 0,void 0,function*(){let e=this._removeEmptyFolders(a),f=this._getFinalPath(e),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",b);try{let a,b=Object.assign({upsert:aq.upsert},d),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(b.upsert)});"undefined"!=typeof Blob&&c instanceof Blob?((a=new FormData).append("cacheControl",b.cacheControl),a.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?(a=c).append("cacheControl",b.cacheControl):(a=c,f["cache-control"]=`max-age=${b.cacheControl}`,f["content-type"]=b.contentType);let h=yield al(this.fetch,g.toString(),a,{headers:f});return{data:{path:e,fullPath:h.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(a,b){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let c=this._getFinalPath(a),d=Object.assign({},this.headers);(null==b?void 0:b.upsert)&&(d["x-upsert"]="true");let e=yield ak(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:d}),f=new URL(this.url+e.url),g=f.searchParams.get("token");if(!g)throw new ab("No token returned by API");return{data:{signedUrl:f.toString(),path:a,token:g},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}update(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",a,b,c)})}move(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ak(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}copy(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield ak(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}createSignedUrl(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let d=this._getFinalPath(a),e=yield ak(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:b},(null==c?void 0:c.transform)?{transform:c.transform}:{}),{headers:this.headers}),f=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:e={signedUrl:encodeURI(`${this.url}${e.signedURL}${f}`)},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}createSignedUrls(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let d=yield ak(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:b,paths:a},{headers:this.headers}),e=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:d.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${e}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}download(a,b){let c=void 0!==(null==b?void 0:b.transform)?"render/image/authenticated":"object",d=this.transformOptsToQueryString((null==b?void 0:b.transform)||{}),e=d?`?${d}`:"",f=this._getFinalPath(a);return new ao(()=>aj(this.fetch,`${this.url}/${c}/${f}${e}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{let a=yield aj(this.fetch,`${this.url}/object/info/${b}`,{headers:this.headers});return{data:ag(a),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}exists(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{return yield function(a,b,c,d){return(0,w.__awaiter)(this,void 0,void 0,function*(){return ai(a,"HEAD",b,Object.assign(Object.assign({},c),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${b}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a)&&a instanceof ae){let b=a.originalError;if([400,404].includes(null==b?void 0:b.status))return{data:!1,error:a}}throw a}})}getPublicUrl(a,b){let c=this._getFinalPath(a),d=[],e=(null==b?void 0:b.download)?`download=${!0===b.download?"":b.download}`:"";""!==e&&d.push(e);let f=void 0!==(null==b?void 0:b.transform),g=this.transformOptsToQueryString((null==b?void 0:b.transform)||{});""!==g&&d.push(g);let h=d.join("&");return""!==h&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${f?"render/image":"object"}/public/${c}${h}`)}}}remove(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield am(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}list(a,b,c){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let d=Object.assign(Object.assign(Object.assign({},ap),b),{prefix:a||""});return{data:yield ak(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},c),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}listV2(a,b){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let c=Object.assign({},a);return{data:yield ak(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,c,{headers:this.headers},b),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return"undefined"!=typeof Buffer?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a.replace(/^\/+/,"")}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){let b=[];return a.width&&b.push(`width=${a.width}`),a.height&&b.push(`height=${a.height}`),a.resize&&b.push(`resize=${a.resize}`),a.format&&b.push(`format=${a.format}`),a.quality&&b.push(`quality=${a.quality}`),b.join("&")}}let as="2.78.0",at={"X-Client-Info":`storage-js/${as}`};class au{constructor(a,b={},c,d){this.shouldThrowOnError=!1;const e=new URL(a);(null==d?void 0:d.useNewHostname)&&/supabase\.(co|in|red)$/.test(e.hostname)&&!e.hostname.includes("storage.supabase.")&&(e.hostname=e.hostname.replace("supabase.","storage.supabase.")),this.url=e.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},at),b),this.fetch=af(c)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let b=this.listBucketOptionsToQueryString(a);return{data:yield aj(this.fetch,`${this.url}/bucket${b}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}getBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/bucket/${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}createBucket(a){return(0,w.__awaiter)(this,arguments,void 0,function*(a,b={public:!1}){try{return{data:yield ak(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:b.type,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}updateBucket(a,b){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield al(this.fetch,`${this.url}/bucket/${a}`,{id:a,name:a,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}emptyBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ak(this.fetch,`${this.url}/bucket/${a}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield am(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(a){let b={};return a&&("limit"in a&&(b.limit=String(a.limit)),"offset"in a&&(b.offset=String(a.offset)),a.search&&(b.search=a.search),a.sortColumn&&(b.sortColumn=a.sortColumn),a.sortOrder&&(b.sortOrder=a.sortOrder)),Object.keys(b).length>0?"?"+new URLSearchParams(b).toString():""}}class av{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},at),b),this.fetch=af(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield ak(this.fetch,`${this.url}/bucket`,{name:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}listBuckets(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{let b=new URLSearchParams;(null==a?void 0:a.limit)!==void 0&&b.set("limit",a.limit.toString()),(null==a?void 0:a.offset)!==void 0&&b.set("offset",a.offset.toString()),(null==a?void 0:a.sortColumn)&&b.set("sortColumn",a.sortColumn),(null==a?void 0:a.sortOrder)&&b.set("sortOrder",a.sortOrder),(null==a?void 0:a.search)&&b.set("search",a.search);let c=b.toString(),d=c?`${this.url}/bucket?${c}`:`${this.url}/bucket`;return{data:yield aj(this.fetch,d,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield am(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ac(a))return{data:null,error:a};throw a}})}}let aw={"X-Client-Info":`storage-js/${as}`,"Content-Type":"application/json"};class ax extends Error{constructor(a){super(a),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ay(a){return"object"==typeof a&&null!==a&&"__isStorageVectorsError"in a}class az extends ax{constructor(a,b,c){super(a),this.name="StorageVectorsApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class aA extends ax{constructor(a,b){super(a),this.name="StorageVectorsUnknownError",this.originalError=b}}(dd=dr||(dr={})).InternalError="InternalError",dd.S3VectorConflictException="S3VectorConflictException",dd.S3VectorNotFoundException="S3VectorNotFoundException",dd.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",dd.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",dd.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded";let aB=b=>{let c;return c=b||("undefined"==typeof fetch?(...b)=>a.A(3062).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},aC=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a);function aD(a,b,c,d,e){return(0,w.__awaiter)(this,void 0,void 0,function*(){return function(a,b,c,d,e,f){return(0,w.__awaiter)(this,void 0,void 0,function*(){return new Promise((g,h)=>{let i;a(c,(i={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b||!f?i:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(f)?(i.headers=Object.assign({"Content-Type":"application/json"},null==d?void 0:d.headers),i.body=JSON.stringify(f)):i.body=f,Object.assign(Object.assign({},i),e)))).then(a=>{if(!a.ok)throw a;if(null==d?void 0:d.noResolveJson)return a;let b=a.headers.get("content-type");return b&&b.includes("application/json")?a.json():{}}).then(a=>g(a)).catch(a=>(0,w.__awaiter)(void 0,void 0,void 0,function*(){if(!(a&&"object"==typeof a&&"status"in a&&"ok"in a&&"number"==typeof a.status)||(null==d?void 0:d.noResolveJson))h(new aA(aC(a),a));else{let b=a.status||500;"function"==typeof a.json?a.json().then(a=>{let c=(null==a?void 0:a.statusCode)||(null==a?void 0:a.code)||b+"";h(new az(aC(a),b,c))}).catch(()=>{h(new az(a.statusText||`HTTP ${b} error`,b,b+""))}):h(new az(a.statusText||`HTTP ${b} error`,b,b+""))}}))})})}(a,"POST",b,d,e,c)})}class aE{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},aw),b),this.fetch=aB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield aD(this.fetch,`${this.url}/CreateIndex`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}getIndex(a,b){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aD(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}listIndexes(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aD(this.fetch,`${this.url}/ListIndexes`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}deleteIndex(a,b){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield aD(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}}class aF{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},aw),b),this.fetch=aB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{if(a.vectors.length<1||a.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:(yield aD(this.fetch,`${this.url}/PutVectors`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}getVectors(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aD(this.fetch,`${this.url}/GetVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}listVectors(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==a.segmentCount){if(a.segmentCount<1||a.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==a.segmentIndex&&(a.segmentIndex<0||a.segmentIndex>=a.segmentCount))throw Error(`segmentIndex must be between 0 and ${a.segmentCount-1}`)}return{data:yield aD(this.fetch,`${this.url}/ListVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}queryVectors(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aD(this.fetch,`${this.url}/QueryVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}deleteVectors(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{if(a.keys.length<1||a.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:(yield aD(this.fetch,`${this.url}/DeleteVectors`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}}class aG{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},aw),b),this.fetch=aB(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield aD(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:a},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}getBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield aD(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}listBuckets(){return(0,w.__awaiter)(this,arguments,void 0,function*(a={}){try{return{data:yield aD(this.fetch,`${this.url}/ListVectorBuckets`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,w.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield aD(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:a},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ay(a))return{data:null,error:a};throw a}})}}class aH extends aG{constructor(a,b={}){super(a,b.headers||{},b.fetch)}from(a){return new aI(this.url,this.headers,a,this.fetch)}}class aI extends aE{constructor(a,b,c,d){super(a,b,d),this.vectorBucketName=c}createIndex(a){let b=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.createIndex.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let a=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,w.__awaiter)(this,arguments,void 0,function*(b={}){return a.listIndexes.call(this,Object.assign(Object.assign({},b),{vectorBucketName:this.vectorBucketName}))})}getIndex(a){let b=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.getIndex.call(this,this.vectorBucketName,a)})}deleteIndex(a){let b=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.deleteIndex.call(this,this.vectorBucketName,a)})}index(a){return new aJ(this.url,this.headers,this.vectorBucketName,a,this.fetch)}}class aJ extends aF{constructor(a,b,c,d,e){super(a,b,e),this.vectorBucketName=c,this.indexName=d}putVectors(a){let b=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.putVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(a){let b=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.getVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let a=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,w.__awaiter)(this,arguments,void 0,function*(b={}){return a.listVectors.call(this,Object.assign(Object.assign({},b),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(a){let b=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.queryVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(a){let b=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,w.__awaiter)(this,void 0,void 0,function*(){return b.deleteVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class aK extends au{constructor(a,b={},c,d){super(a,b,c,d)}from(a){return new ar(this.url,this.headers,a,this.fetch)}get vectors(){return new aH(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new av(this.url+"/iceberg",this.headers,this.fetch)}}let aL="";aL="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let aM={headers:{"X-Client-Info":`supabase-js-${aL}/2.78.0`}},aN={schema:"public"},aO={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},aP={};var aQ=a.i(3328);let aR="2.78.0",aS={"X-Client-Info":`gotrue-js/${aR}`},aT="X-Supabase-Api-Version",aU={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},aV=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class aW extends Error{constructor(a,b,c){super(a),this.__isAuthError=!0,this.name="AuthError",this.status=b,this.code=c}}function aX(a){return"object"==typeof a&&null!==a&&"__isAuthError"in a}class aY extends aW{constructor(a,b,c){super(a,b,c),this.name="AuthApiError",this.status=b,this.code=c}}class aZ extends aW{constructor(a,b){super(a),this.name="AuthUnknownError",this.originalError=b}}class a$ extends aW{constructor(a,b,c,d){super(a,c,d),this.name=b,this.status=c}}class a_ extends a${constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class a0 extends a${constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class a1 extends a${constructor(a){super(a,"AuthInvalidCredentialsError",400,void 0)}}class a2 extends a${constructor(a,b=null){super(a,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=b}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class a3 extends a${constructor(a,b){super(a,"AuthRetryableFetchError",b,void 0)}}function a4(a){return aX(a)&&"AuthRetryableFetchError"===a.name}class a5 extends a${constructor(a,b,c){super(a,"AuthWeakPasswordError",b,"weak_password"),this.reasons=c}}class a6 extends a${constructor(a){super(a,"AuthInvalidJwtError",400,"invalid_jwt")}}let a7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),a8=" 	\n\r=".split(""),a9=(()=>{let a=Array(128);for(let b=0;b<a.length;b+=1)a[b]=-1;for(let b=0;b<a8.length;b+=1)a[a8[b].charCodeAt(0)]=-2;for(let b=0;b<a7.length;b+=1)a[a7[b].charCodeAt(0)]=b;return a})();function ba(a,b,c){if(null!==a)for(b.queue=b.queue<<8|a,b.queuedBits+=8;b.queuedBits>=6;)c(a7[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6;else if(b.queuedBits>0)for(b.queue=b.queue<<6-b.queuedBits,b.queuedBits=6;b.queuedBits>=6;)c(a7[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6}function bb(a,b,c){let d=a9[a];if(d>-1)for(b.queue=b.queue<<6|d,b.queuedBits+=6;b.queuedBits>=8;)c(b.queue>>b.queuedBits-8&255),b.queuedBits-=8;else if(-2===d)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}function bc(a){let b=[],c=a=>{b.push(String.fromCodePoint(a))},d={utf8seq:0,codepoint:0},e={queue:0,queuedBits:0},f=a=>{!function(a,b,c){if(0===b.utf8seq){if(a<=127)return c(a);for(let c=1;c<6;c+=1)if((a>>7-c&1)==0){b.utf8seq=c;break}if(2===b.utf8seq)b.codepoint=31&a;else if(3===b.utf8seq)b.codepoint=15&a;else if(4===b.utf8seq)b.codepoint=7&a;else throw Error("Invalid UTF-8 sequence");b.utf8seq-=1}else if(b.utf8seq>0){if(a<=127)throw Error("Invalid UTF-8 sequence");b.codepoint=b.codepoint<<6|63&a,b.utf8seq-=1,0===b.utf8seq&&c(b.codepoint)}}(a,d,c)};for(let b=0;b<a.length;b+=1)bb(a.charCodeAt(b),e,f);return b.join("")}function bd(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};for(let b=0;b<a.length;b+=1)bb(a.charCodeAt(b),c,d);return new Uint8Array(b)}function be(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};return a.forEach(a=>ba(a,c,d)),ba(null,c,d),b.join("")}let bf=b=>{let c;return c=b||("undefined"==typeof fetch?(...b)=>a.A(3062).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},bg=async(a,b,c)=>{await a.setItem(b,JSON.stringify(c))},bh=async(a,b)=>{let c=await a.getItem(b);if(!c)return null;try{return JSON.parse(c)}catch(a){return c}},bi=async(a,b)=>{await a.removeItem(b)};class bj{constructor(){this.promise=new bj.promiseConstructor((a,b)=>{this.resolve=a,this.reject=b})}}function bk(a){let b=a.split(".");if(3!==b.length)throw new a6("Invalid JWT structure");for(let a=0;a<b.length;a++)if(!aV.test(b[a]))throw new a6("JWT not in base64url format");return{header:JSON.parse(bc(b[0])),payload:JSON.parse(bc(b[1])),signature:bd(b[2]),raw:{header:b[0],payload:b[1]}}}async function bl(a){return await new Promise(b=>{setTimeout(()=>b(null),a)})}function bm(a){return("0"+a.toString(16)).substr(-2)}async function bn(a){let b=new TextEncoder().encode(a);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",b))).map(a=>String.fromCharCode(a)).join("")}async function bo(a){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a):btoa(await bn(a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bp(a,b,c=!1){let d=function(){let a=new Uint32Array(56);if("undefined"==typeof crypto){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",b=a.length,c="";for(let d=0;d<56;d++)c+=a.charAt(Math.floor(Math.random()*b));return c}return crypto.getRandomValues(a),Array.from(a,bm).join("")}(),e=d;c&&(e+="/PASSWORD_RECOVERY"),await bg(a,`${b}-code-verifier`,e);let f=await bo(d),g=d===f?"plain":"s256";return[f,g]}bj.promiseConstructor=Promise;let bq=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,br=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bs(a){if(!br.test(a))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function bt(){return new Proxy({},{get:(a,b)=>{if("__isUserNotAvailableProxy"===b)return!0;if("symbol"==typeof b){let a=b.toString();if("Symbol(Symbol.toPrimitive)"===a||"Symbol(Symbol.toStringTag)"===a||"Symbol(util.inspect.custom)"===a)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${b}" property of the session object is not supported. Please use getUser() instead.`)},set:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bu(a){return JSON.parse(JSON.stringify(a))}let bv=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),bw=[502,503,504];async function bx(a){var b;let c,d;if(!("object"==typeof a&&null!==a&&"status"in a&&"ok"in a&&"json"in a&&"function"==typeof a.json))throw new a3(bv(a),0);if(bw.includes(a.status))throw new a3(bv(a),a.status);try{c=await a.json()}catch(a){throw new aZ(bv(a),a)}let e=function(a){let b=a.headers.get(aT);if(!b||!b.match(bq))return null;try{return new Date(`${b}T00:00:00.0Z`)}catch(a){return null}}(a);if(e&&e.getTime()>=aU["2024-01-01"].timestamp&&"object"==typeof c&&c&&"string"==typeof c.code?d=c.code:"object"==typeof c&&c&&"string"==typeof c.error_code&&(d=c.error_code),d){if("weak_password"===d)throw new a5(bv(c),a.status,(null==(b=c.weak_password)?void 0:b.reasons)||[]);else if("session_not_found"===d)throw new a_}else if("object"==typeof c&&c&&"object"==typeof c.weak_password&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0))throw new a5(bv(c),a.status,c.weak_password.reasons);throw new aY(bv(c),a.status||500,d)}async function by(a,b,c,d){var e;let f=Object.assign({},null==d?void 0:d.headers);f[aT]||(f[aT]=aU["2024-01-01"].name),(null==d?void 0:d.jwt)&&(f.Authorization=`Bearer ${d.jwt}`);let g=null!=(e=null==d?void 0:d.query)?e:{};(null==d?void 0:d.redirectTo)&&(g.redirect_to=d.redirectTo);let h=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",i=await bz(a,b,c+h,{headers:f,noResolveJson:null==d?void 0:d.noResolveJson},{},null==d?void 0:d.body);return(null==d?void 0:d.xform)?null==d?void 0:d.xform(i):{data:Object.assign({},i),error:null}}async function bz(a,b,c,d,e,f){let g,h,i=(h={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b?h:(h.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==d?void 0:d.headers),h.body=JSON.stringify(f),Object.assign(Object.assign({},h),e)));try{g=await a(c,Object.assign({},i))}catch(a){throw console.error(a),new a3(bv(a),0)}if(g.ok||await bx(g),null==d?void 0:d.noResolveJson)return g;try{return await g.json()}catch(a){await bx(a)}}function bA(a){var b,c,d;let e=null;(d=a).access_token&&d.refresh_token&&d.expires_in&&(e=Object.assign({},a),a.expires_at||(e.expires_at=(c=a.expires_in,Math.round(Date.now()/1e3)+c)));return{data:{session:e,user:null!=(b=a.user)?b:a},error:null}}function bB(a){let b=bA(a);return!b.error&&a.weak_password&&"object"==typeof a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&"string"==typeof a.weak_password.message&&a.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0)&&(b.data.weak_password=a.weak_password),b}function bC(a){var b;return{data:{user:null!=(b=a.user)?b:a},error:null}}function bD(a){return{data:a,error:null}}function bE(a){let{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f}=a;return{data:{properties:{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f},user:Object.assign({},(0,w.__rest)(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function bF(a){return a}let bG=["global","local","others"];class bH{constructor({url:a="",headers:b={},fetch:c}){this.url=a,this.headers=b,this.fetch=bf(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(a,b=bG[0]){if(0>bG.indexOf(b))throw Error(`@supabase/auth-js: Parameter scope must be one of ${bG.join(", ")}`);try{return await by(this.fetch,"POST",`${this.url}/logout?scope=${b}`,{headers:this.headers,jwt:a,noResolveJson:!0}),{data:null,error:null}}catch(a){if(aX(a))return{data:null,error:a};throw a}}async inviteUserByEmail(a,b={}){try{return await by(this.fetch,"POST",`${this.url}/invite`,{body:{email:a,data:b.data},headers:this.headers,redirectTo:b.redirectTo,xform:bC})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async generateLink(a){try{let{options:b}=a,c=(0,w.__rest)(a,["options"]),d=Object.assign(Object.assign({},c),b);return"newEmail"in c&&(d.new_email=null==c?void 0:c.newEmail,delete d.newEmail),await by(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:bE,redirectTo:null==b?void 0:b.redirectTo})}catch(a){if(aX(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(a){try{return await by(this.fetch,"POST",`${this.url}/admin/users`,{body:a,headers:this.headers,xform:bC})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async listUsers(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await by(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:bF});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(aX(a))return{data:{users:[]},error:a};throw a}}async getUserById(a){bs(a);try{return await by(this.fetch,"GET",`${this.url}/admin/users/${a}`,{headers:this.headers,xform:bC})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async updateUserById(a,b){bs(a);try{return await by(this.fetch,"PUT",`${this.url}/admin/users/${a}`,{body:b,headers:this.headers,xform:bC})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async deleteUser(a,b=!1){bs(a);try{return await by(this.fetch,"DELETE",`${this.url}/admin/users/${a}`,{headers:this.headers,body:{should_soft_delete:b},xform:bC})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async _listFactors(a){bs(a.userId);try{let{data:b,error:c}=await by(this.fetch,"GET",`${this.url}/admin/users/${a.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:b,error:c}}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _deleteFactor(a){bs(a.userId),bs(a.id);try{return{data:await by(this.fetch,"DELETE",`${this.url}/admin/users/${a.userId}/factors/${a.id}`,{headers:this.headers}),error:null}}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _listOAuthClients(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await by(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:bF});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(aX(a))return{data:{clients:[]},error:a};throw a}}async _createOAuthClient(a){try{return await by(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:a,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _getOAuthClient(a){try{return await by(this.fetch,"GET",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _updateOAuthClient(a,b){try{return await by(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${a}`,{body:b,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(a){try{return await by(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(a){try{return await by(this.fetch,"POST",`${this.url}/admin/oauth/clients/${a}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}}function bI(a={}){return{getItem:b=>a[b]||null,setItem:(b,c)=>{a[b]=c},removeItem:b=>{delete a[b]}}}globalThis;class bJ extends Error{constructor(a){super(a),this.isAcquireTimeout=!0}}function bK(a){if(!/^0x[a-fA-F0-9]{40}$/.test(a))throw Error(`@supabase/auth-js: Address "${a}" is invalid.`);return a.toLowerCase()}class bL extends Error{constructor({message:a,code:b,cause:c,name:d}){var e;super(a,{cause:c}),this.__isWebAuthnError=!0,this.name=null!=(e=null!=d?d:c instanceof Error?c.name:void 0)?e:"Unknown Error",this.code=b}}class bM extends bL{constructor(a,b){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:b,message:a}),this.name="WebAuthnUnknownError",this.originalError=b}}let bN=new class{createNewAbortSignal(){if(this.controller){let a=Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}let a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){let a=Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}};function bO(a){return"localhost"===a||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}async function bP(a){try{let b=await navigator.credentials.create(a);if(!b)return{data:null,error:new bM("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new bM("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){var c,d,e;let{publicKey:f}=b;if(!f)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new bL({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("ConstraintError"===a.name){if((null==(c=f.authenticatorSelection)?void 0:c.requireResidentKey)===!0)return new bL({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});else if("conditional"===b.mediation&&(null==(d=f.authenticatorSelection)?void 0:d.userVerification)==="required")return new bL({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});else if((null==(e=f.authenticatorSelection)?void 0:e.userVerification)==="required")return new bL({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else if("InvalidStateError"===a.name)return new bL({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});else if("NotAllowedError"===a.name)return new bL({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("NotSupportedError"===a.name)return new bL(0===f.pubKeyCredParams.filter(a=>"public-key"===a.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!bO(b))return new bL({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(f.rp.id!==b)return new bL({message:`The RP ID "${f.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("TypeError"===a.name){if(f.user.id.byteLength<1||f.user.id.byteLength>64)return new bL({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if("UnknownError"===a.name)return new bL({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new bL({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}async function bQ(a){try{let b=await navigator.credentials.get(a);if(!b)return{data:null,error:new bM("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new bM("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new bL({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("NotAllowedError"===a.name)return new bL({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!bO(b))return new bL({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rpId!==b)return new bL({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("UnknownError"===a.name)return new bL({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new bL({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}let bR={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},bS={userVerification:"preferred",hints:["security-key"]};function bT(...a){let b=a=>null!==a&&"object"==typeof a&&!Array.isArray(a),c=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),d={};for(let e of a)if(e)for(let a in e){let f=e[a];if(void 0!==f)if(Array.isArray(f))d[a]=f;else if(c(f))d[a]=f;else if(b(f)){let c=d[a];b(c)?d[a]=bT(c,f):d[a]=bT(f)}else d[a]=f}return d}class bU{constructor(a){this.client=a,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(a){return this.client.mfa.enroll(Object.assign(Object.assign({},a),{factorType:"webauthn"}))}async _challenge({factorId:a,webauthn:b,friendlyName:c,signal:d},e){try{var f,g,h,i;let{data:j,error:k}=await this.client.mfa.challenge({factorId:a,webauthn:b});if(!j)return{data:null,error:k};let l=null!=d?d:bN.createNewAbortSignal();if("create"===j.webauthn.type){let{user:a}=j.webauthn.credential_options.publicKey;a.name||(a.name=`${a.id}:${c}`),a.displayName||(a.displayName=a.name)}switch(j.webauthn.type){case"create":{let b=(f=j.webauthn.credential_options.publicKey,g=null==e?void 0:e.create,bT(bR,f,g||{})),{data:c,error:d}=await bP({publicKey:b,signal:l});if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}case"request":{let b=(h=j.webauthn.credential_options.publicKey,i=null==e?void 0:e.request,bT(bS,h,i||{})),{data:c,error:d}=await bQ(Object.assign(Object.assign({},j.webauthn.credential_options),{publicKey:b,signal:l}));if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}}}catch(a){if(aX(a))return{data:null,error:a};return{data:null,error:new aZ("Unexpected error in challenge",a)}}}async _verify({challengeId:a,factorId:b,webauthn:c}){return this.client.mfa.verify({factorId:b,challengeId:a,webauthn:c})}async _authenticate({factorId:a,webauthn:{rpId:b,rpOrigins:c,signal:d}},e){if(!b)return{data:null,error:new aW("rpId is required for WebAuthn authentication")};try{1;return{data:null,error:new aZ("Browser does not support WebAuthn",null)}}catch(a){if(aX(a))return{data:null,error:a};return{data:null,error:new aZ("Unexpected error in authenticate",a)}}}async _register({friendlyName:a,rpId:b,rpOrigins:c,signal:d},e){if(!b)return{data:null,error:new aW("rpId is required for WebAuthn registration")};try{1;return{data:null,error:new aZ("Browser does not support WebAuthn",null)}}catch(a){if(aX(a))return{data:null,error:a};return{data:null,error:new aZ("Unexpected error in register",a)}}}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(a){"undefined"!=typeof self&&(self.globalThis=self)}let bV={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:aS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function bW(a,b,c){return await c()}let bX={};class bY{get jwks(){var a,b;return null!=(b=null==(a=bX[this.storageKey])?void 0:a.jwks)?b:{keys:[]}}set jwks(a){bX[this.storageKey]=Object.assign(Object.assign({},bX[this.storageKey]),{jwks:a})}get jwks_cached_at(){var a,b;return null!=(b=null==(a=bX[this.storageKey])?void 0:a.cachedAt)?b:Number.MIN_SAFE_INTEGER}set jwks_cached_at(a){bX[this.storageKey]=Object.assign(Object.assign({},bX[this.storageKey]),{cachedAt:a})}constructor(a){this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=bY.nextInstanceID,bY.nextInstanceID+=1,this.instanceID;const b=Object.assign(Object.assign({},bV),a);this.logDebugMessages=!!b.debug,"function"==typeof b.debug&&(this.logger=b.debug),this.persistSession=b.persistSession,this.storageKey=b.storageKey,this.autoRefreshToken=b.autoRefreshToken,this.admin=new bH({url:b.url,headers:b.headers,fetch:b.fetch}),this.url=b.url,this.headers=b.headers,this.fetch=bf(b.fetch),this.lock=b.lock||bW,this.detectSessionInUrl=b.detectSessionInUrl,this.flowType=b.flowType,this.hasCustomAuthorizationHeader=b.hasCustomAuthorizationHeader,b.lock?this.lock=b.lock:this.lock=bW,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new bU(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(b.storage?this.storage=b.storage:(this.memoryStorage={},this.storage=bI(this.memoryStorage)),b.userStorage&&(this.userStorage=b.userStorage)):(this.memoryStorage={},this.storage=bI(this.memoryStorage)),this.initialize()}_debug(...a){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${aR}) ${new Date().toISOString()}`,...a),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{let a=function(a){let b={},c=new URL(a);if(c.hash&&"#"===c.hash[0])try{new URLSearchParams(c.hash.substring(1)).forEach((a,c)=>{b[c]=a})}catch(a){}return c.searchParams.forEach((a,c)=>{b[c]=a}),b}(window.location.href);return this._isImplicitGrantCallback(a)||await this._isPKCECallback(a),await this._recoverAndRefresh(),{error:null}}catch(a){if(aX(a))return{error:a};return{error:new aZ("Unexpected error during initialization",a)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(a){var b,c,d;try{let{data:e,error:f}=await by(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(c=null==(b=null==a?void 0:a.options)?void 0:b.data)?c:{},gotrue_meta_security:{captcha_token:null==(d=null==a?void 0:a.options)?void 0:d.captchaToken}},xform:bA});if(f||!e)return{data:{user:null,session:null},error:f};let g=e.session,h=e.user;return e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",g)),{data:{user:h,session:g},error:null}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(a){var b,c,d;try{let e;if("email"in a){let{email:c,password:d,options:f}=a,g=null,h=null;"pkce"===this.flowType&&([g,h]=await bp(this.storage,this.storageKey)),e=await by(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:c,password:d,data:null!=(b=null==f?void 0:f.data)?b:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:g,code_challenge_method:h},xform:bA})}else if("phone"in a){let{phone:b,password:f,options:g}=a;e=await by(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:f,data:null!=(c=null==g?void 0:g.data)?c:{},channel:null!=(d=null==g?void 0:g.channel)?d:"sms",gotrue_meta_security:{captcha_token:null==g?void 0:g.captchaToken}},xform:bA})}else throw new a1("You must provide either an email or phone number and a password");let{data:f,error:g}=e;if(g||!f)return{data:{user:null,session:null},error:g};let h=f.session,i=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:i,session:h},error:null}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(a){try{let b;if("email"in a){let{email:c,password:d,options:e}=a;b=await by(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:bB})}else if("phone"in a){let{phone:c,password:d,options:e}=a;b=await by(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:bB})}else throw new a1("You must provide either an email or phone number and a password");let{data:c,error:d}=b;if(d)return{data:{user:null,session:null},error:d};if(!c||!c.session||!c.user)return{data:{user:null,session:null},error:new a0};return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:d}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOAuth(a){var b,c,d,e;return await this._handleProviderSignIn(a.provider,{redirectTo:null==(b=a.options)?void 0:b.redirectTo,scopes:null==(c=a.options)?void 0:c.scopes,queryParams:null==(d=a.options)?void 0:d.queryParams,skipBrowserRedirect:null==(e=a.options)?void 0:e.skipBrowserRedirect})}async exchangeCodeForSession(a){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(a))}async signInWithWeb3(a){let{chain:b}=a;switch(b){case"ethereum":return await this.signInWithEthereum(a);case"solana":return await this.signInWithSolana(a);default:throw Error(`@supabase/auth-js: Unsupported chain "${b}"`)}}async signInWithEthereum(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:k,wallet:l,statement:p,options:q}=a;if("object"!=typeof l||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href),s=await l.request({method:"eth_requestAccounts"}).then(a=>a).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!s||0===s.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let t=bK(s[0]),u=null==(c=null==q?void 0:q.signInWithEthereum)?void 0:c.chainId;u||(u=parseInt(await l.request({method:"eth_chainId"}),16)),n=function(a){var b;let{chainId:c,domain:d,expirationTime:e,issuedAt:f=new Date,nonce:g,notBefore:h,requestId:i,resources:j,scheme:k,uri:l,version:m}=a;if(!Number.isInteger(c))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${c}`);if(!d)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(g&&g.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${g}`);if(!l)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==m)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(null==(b=a.statement)?void 0:b.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${a.statement}`);let n=bK(a.address),o=k?`${k}://${d}`:d,p=a.statement?`${a.statement}
`:"",q=`${o} wants you to sign in with your Ethereum account:
${n}

${p}`,r=`URI: ${l}
Version: ${m}
Chain ID: ${c}${g?`
Nonce: ${g}`:""}
Issued At: ${f.toISOString()}`;if(e&&(r+=`
Expiration Time: ${e.toISOString()}`),h&&(r+=`
Not Before: ${h.toISOString()}`),i&&(r+=`
Request ID: ${i}`),j){let a="\nResources:";for(let b of j){if(!b||"string"!=typeof b)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);a+=`
- ${b}`}r+=a}return`${q}
${r}`}({domain:r.host,address:t,statement:p,uri:r.href,version:"1",chainId:u,nonce:null==(d=null==q?void 0:q.signInWithEthereum)?void 0:d.nonce,issuedAt:null!=(f=null==(e=null==q?void 0:q.signInWithEthereum)?void 0:e.issuedAt)?f:new Date,expirationTime:null==(g=null==q?void 0:q.signInWithEthereum)?void 0:g.expirationTime,notBefore:null==(h=null==q?void 0:q.signInWithEthereum)?void 0:h.notBefore,requestId:null==(i=null==q?void 0:q.signInWithEthereum)?void 0:i.requestId,resources:null==(j=null==q?void 0:q.signInWithEthereum)?void 0:j.resources}),o=await l.request({method:"personal_sign",params:[(m=n,"0x"+Array.from(new TextEncoder().encode(m),a=>a.toString(16).padStart(2,"0")).join("")),t]})}try{let{data:b,error:c}=await by(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:n,signature:o},(null==(k=a.options)?void 0:k.captchaToken)?{gotrue_meta_security:{captcha_token:null==(l=a.options)?void 0:l.captchaToken}}:null),xform:bA});if(c)throw c;if(!b||!b.session||!b.user)return{data:{user:null,session:null},error:new a0};return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:c}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSolana(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:l,wallet:m,statement:p,options:q}=a;if("object"!=typeof m||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href);if("signIn"in m&&m.signIn){let a,b=await m.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==q?void 0:q.signInWithSolana),{version:"1",domain:r.host,uri:r.href}),p?{statement:p}:null));if(Array.isArray(b)&&b[0]&&"object"==typeof b[0])a=b[0];else if(b&&"object"==typeof b&&"signedMessage"in b&&"signature"in b)a=b;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in a&&"signature"in a&&("string"==typeof a.signedMessage||a.signedMessage instanceof Uint8Array)&&a.signature instanceof Uint8Array)n="string"==typeof a.signedMessage?a.signedMessage:new TextDecoder().decode(a.signedMessage),o=a.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in m)||"function"!=typeof m.signMessage||!("publicKey"in m)||"object"!=typeof m||!m.publicKey||!("toBase58"in m.publicKey)||"function"!=typeof m.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");n=[`${r.host} wants you to sign in with your Solana account:`,m.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${r.href}`,`Issued At: ${null!=(d=null==(c=null==q?void 0:q.signInWithSolana)?void 0:c.issuedAt)?d:new Date().toISOString()}`,...(null==(e=null==q?void 0:q.signInWithSolana)?void 0:e.notBefore)?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...(null==(f=null==q?void 0:q.signInWithSolana)?void 0:f.expirationTime)?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...(null==(g=null==q?void 0:q.signInWithSolana)?void 0:g.chainId)?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...(null==(h=null==q?void 0:q.signInWithSolana)?void 0:h.nonce)?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...(null==(i=null==q?void 0:q.signInWithSolana)?void 0:i.requestId)?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...(null==(k=null==(j=null==q?void 0:q.signInWithSolana)?void 0:j.resources)?void 0:k.length)?["Resources",...q.signInWithSolana.resources.map(a=>`- ${a}`)]:[]].join("\n");let a=await m.signMessage(new TextEncoder().encode(n),"utf8");if(!a||!(a instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");o=a}}try{let{data:b,error:c}=await by(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:n,signature:be(o)},(null==(l=a.options)?void 0:l.captchaToken)?{gotrue_meta_security:{captcha_token:null==(m=a.options)?void 0:m.captchaToken}}:null),xform:bA});if(c)throw c;if(!b||!b.session||!b.user)return{data:{user:null,session:null},error:new a0};return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:c}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async _exchangeCodeForSession(a){let b=await bh(this.storage,`${this.storageKey}-code-verifier`),[c,d]=(null!=b?b:"").split("/");try{let{data:b,error:e}=await by(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:a,code_verifier:c},xform:bA});if(await bi(this.storage,`${this.storageKey}-code-verifier`),e)throw e;if(!b||!b.session||!b.user)return{data:{user:null,session:null,redirectType:null},error:new a0};return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign(Object.assign({},b),{redirectType:null!=d?d:null}),error:e}}catch(a){if(aX(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(a){try{let{options:b,provider:c,token:d,access_token:e,nonce:f}=a,{data:g,error:h}=await by(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:d,access_token:e,nonce:f,gotrue_meta_security:{captcha_token:null==b?void 0:b.captchaToken}},xform:bA});if(h)return{data:{user:null,session:null},error:h};if(!g||!g.session||!g.user)return{data:{user:null,session:null},error:new a0};return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:g,error:h}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOtp(a){var b,c,d,e,f;try{if("email"in a){let{email:d,options:e}=a,f=null,g=null;"pkce"===this.flowType&&([f,g]=await bp(this.storage,this.storageKey));let{error:h}=await by(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:null!=(b=null==e?void 0:e.data)?b:{},create_user:null==(c=null==e?void 0:e.shouldCreateUser)||c,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:null==e?void 0:e.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in a){let{phone:b,options:c}=a,{data:g,error:h}=await by(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:b,data:null!=(d=null==c?void 0:c.data)?d:{},create_user:null==(e=null==c?void 0:c.shouldCreateUser)||e,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!=(f=null==c?void 0:c.channel)?f:"sms"}});return{data:{user:null,session:null,messageId:null==g?void 0:g.message_id},error:h}}throw new a1("You must provide either an email or phone number.")}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(a){var b,c;try{let d,e;"options"in a&&(d=null==(b=a.options)?void 0:b.redirectTo,e=null==(c=a.options)?void 0:c.captchaToken);let{data:f,error:g}=await by(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},a),{gotrue_meta_security:{captcha_token:e}}),redirectTo:d,xform:bA});if(g)throw g;if(!f)throw Error("An error occurred on token verification.");let h=f.session,i=f.user;return(null==h?void 0:h.access_token)&&(await this._saveSession(h),await this._notifyAllSubscribers("recovery"==a.type?"PASSWORD_RECOVERY":"SIGNED_IN",h)),{data:{user:i,session:h},error:null}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(a){var b,c,d;try{let e=null,f=null;return"pkce"===this.flowType&&([e,f]=await bp(this.storage,this.storageKey)),await by(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in a?{provider_id:a.providerId}:null),"domain"in a?{domain:a.domain}:null),{redirect_to:null!=(c=null==(b=a.options)?void 0:b.redirectTo)?c:void 0}),(null==(d=null==a?void 0:a.options)?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:a.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:e,code_challenge_method:f}),headers:this.headers,xform:bD})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async a=>{let{data:{session:b},error:c}=a;if(c)throw c;if(!b)throw new a_;let{error:d}=await by(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:b.access_token});return{data:{user:null,session:null},error:d}})}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async resend(a){try{let b=`${this.url}/resend`;if("email"in a){let{email:c,type:d,options:e}=a,{error:f}=await by(this.fetch,"POST",b,{headers:this.headers,body:{email:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},redirectTo:null==e?void 0:e.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in a){let{phone:c,type:d,options:e}=a,{data:f,error:g}=await by(this.fetch,"POST",b,{headers:this.headers,body:{phone:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}}});return{data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:g}}throw new a1("You must provide either an email or phone number and a type")}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(a,b){this._debug("#_acquireLock","begin",a);try{if(this.lockAcquired){let a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await a,await b()))();return this.pendingInLock.push((async()=>{try{await c}catch(a){}})()),c}return await this.lock(`lock:${this.storageKey}`,a,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let a=b();for(this.pendingInLock.push((async()=>{try{await a}catch(a){}})()),await a;this.pendingInLock.length;){let a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(a){this._debug("#_useSession","begin");try{let b=await this.__loadSession();return await a(b)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let b=null,c=await bh(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",c),null!==c&&(this._isValidSession(c)?b=c:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!b)return{data:{session:null},error:null};let d=!!b.expires_at&&1e3*b.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${d?"":" not"} expired`,"expires_at",b.expires_at),!d){if(this.userStorage){let a=await bh(this.userStorage,this.storageKey+"-user");(null==a?void 0:a.user)?b.user=a.user:b.user=bt()}if(this.storage.isServer&&b.user&&!b.user.__isUserNotAvailableProxy){var a;let c={value:this.suppressGetSessionWarning};b.user=(a=b.user,new Proxy(a,{get:(a,b,d)=>{if("__isInsecureUserWarningProxy"===b)return!0;if("symbol"==typeof b){let c=b.toString();if("Symbol(Symbol.toPrimitive)"===c||"Symbol(Symbol.toStringTag)"===c||"Symbol(util.inspect.custom)"===c||"Symbol(nodejs.util.inspect.custom)"===c)return Reflect.get(a,b,d)}return c.value||"string"!=typeof b||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c.value=!0),Reflect.get(a,b,d)}})),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:b},error:null}}let{data:e,error:f}=await this._callRefreshToken(b.refresh_token);if(f)return{data:{session:null},error:f};return{data:{session:e},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(a){return a?await this._getUser(a):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(a){try{if(a)return await by(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:a,xform:bC});return await this._useSession(async a=>{var b,c,d;let{data:e,error:f}=a;if(f)throw f;return(null==(b=e.session)?void 0:b.access_token)||this.hasCustomAuthorizationHeader?await by(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0,xform:bC}):{data:{user:null},error:new a_}})}catch(a){if(aX(a))return aX(a)&&"AuthSessionMissingError"===a.name&&(await this._removeSession(),await bi(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:a};throw a}}async updateUser(a,b={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(a,b))}async _updateUser(a,b={}){try{return await this._useSession(async c=>{let{data:d,error:e}=c;if(e)throw e;if(!d.session)throw new a_;let f=d.session,g=null,h=null;"pkce"===this.flowType&&null!=a.email&&([g,h]=await bp(this.storage,this.storageKey));let{data:i,error:j}=await by(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==b?void 0:b.emailRedirectTo,body:Object.assign(Object.assign({},a),{code_challenge:g,code_challenge_method:h}),jwt:f.access_token,xform:bC});if(j)throw j;return f.user=i.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),{data:{user:f.user},error:null}})}catch(a){if(aX(a))return{data:{user:null},error:a};throw a}}async setSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(a))}async _setSession(a){try{if(!a.access_token||!a.refresh_token)throw new a_;let b=Date.now()/1e3,c=b,d=!0,e=null,{payload:f}=bk(a.access_token);if(f.exp&&(d=(c=f.exp)<=b),d){let{data:b,error:c}=await this._callRefreshToken(a.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!b)return{data:{user:null,session:null},error:null};e=b}else{let{data:d,error:f}=await this._getUser(a.access_token);if(f)throw f;e={access_token:a.access_token,refresh_token:a.refresh_token,user:d.user,token_type:"bearer",expires_in:c-b,expires_at:c},await this._saveSession(e),await this._notifyAllSubscribers("SIGNED_IN",e)}return{data:{user:e.user,session:e},error:null}}catch(a){if(aX(a))return{data:{session:null,user:null},error:a};throw a}}async refreshSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(a))}async _refreshSession(a){try{return await this._useSession(async b=>{var c;if(!a){let{data:d,error:e}=b;if(e)throw e;a=null!=(c=d.session)?c:void 0}if(!(null==a?void 0:a.refresh_token))throw new a_;let{data:d,error:e}=await this._callRefreshToken(a.refresh_token);return e?{data:{user:null,session:null},error:e}:d?{data:{user:d.user,session:d},error:null}:{data:{user:null,session:null},error:null}})}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}}async _getSessionFromURL(a,b){try{throw new a2("No browser detected.")}catch(a){if(aX(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(a){return!!(a.access_token||a.error_description)}async _isPKCECallback(a){let b=await bh(this.storage,`${this.storageKey}-code-verifier`);return!!(a.code&&b)}async signOut(a={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(a))}async _signOut({scope:a}={scope:"global"}){return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return{error:e};let f=null==(c=d.session)?void 0:c.access_token;if(f){let{error:b}=await this.admin.signOut(f,a);if(b&&!(aX(b)&&"AuthApiError"===b.name&&(404===b.status||401===b.status||403===b.status)))return{error:b}}return"others"!==a&&(await this._removeSession(),await bi(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(a){let b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){let b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)}),c={id:b,callback:a,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",b),this.stateChangeEmitters.delete(b)}};return this._debug("#onAuthStateChange()","registered callback with id",b),this.stateChangeEmitters.set(b,c),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(b)})})(),{data:{subscription:c}}}async _emitInitialSession(a){return await this._useSession(async b=>{var c,d;try{let{data:{session:d},error:e}=b;if(e)throw e;await (null==(c=this.stateChangeEmitters.get(a))?void 0:c.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",a,"session",d)}catch(b){await (null==(d=this.stateChangeEmitters.get(a))?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",a,"error",b),console.error(b)}})}async resetPasswordForEmail(a,b={}){let c=null,d=null;"pkce"===this.flowType&&([c,d]=await bp(this.storage,this.storageKey,!0));try{return await by(this.fetch,"POST",`${this.url}/recover`,{body:{email:a,code_challenge:c,code_challenge_method:d,gotrue_meta_security:{captcha_token:b.captchaToken}},headers:this.headers,redirectTo:b.redirectTo})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async getUserIdentities(){var a;try{let{data:b,error:c}=await this.getUser();if(c)throw c;return{data:{identities:null!=(a=b.user.identities)?a:[]},error:null}}catch(a){if(aX(a))return{data:null,error:a};throw a}}async linkIdentity(a){return"token"in a?this.linkIdentityIdToken(a):this.linkIdentityOAuth(a)}async linkIdentityOAuth(a){try{let{data:b,error:c}=await this._useSession(async b=>{var c,d,e,f,g;let{data:h,error:i}=b;if(i)throw i;let j=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,a.provider,{redirectTo:null==(c=a.options)?void 0:c.redirectTo,scopes:null==(d=a.options)?void 0:d.scopes,queryParams:null==(e=a.options)?void 0:e.queryParams,skipBrowserRedirect:!0});return await by(this.fetch,"GET",j,{headers:this.headers,jwt:null!=(g=null==(f=h.session)?void 0:f.access_token)?g:void 0})});if(c)throw c;return{data:{provider:a.provider,url:null==b?void 0:b.url},error:null}}catch(b){if(aX(b))return{data:{provider:a.provider,url:null},error:b};throw b}}async linkIdentityIdToken(a){return await this._useSession(async b=>{var c;try{let{error:d,data:{session:e}}=b;if(d)throw d;let{options:f,provider:g,token:h,access_token:i,nonce:j}=a,{data:k,error:l}=await by(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!=(c=null==e?void 0:e.access_token)?c:void 0,body:{provider:g,id_token:h,access_token:i,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken}},xform:bA});if(l)return{data:{user:null,session:null},error:l};if(!k||!k.session||!k.user)return{data:{user:null,session:null},error:new a0};return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("USER_UPDATED",k.session)),{data:k,error:l}}catch(a){if(aX(a))return{data:{user:null,session:null},error:a};throw a}})}async unlinkIdentity(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)throw f;return await by(this.fetch,"DELETE",`${this.url}/user/identities/${a.identity_id}`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _refreshAccessToken(a){let b=`#_refreshAccessToken(${a.substring(0,5)}...)`;this._debug(b,"begin");try{var c,d;let e=Date.now();return await (c=async c=>(c>0&&await bl(200*Math.pow(2,c-1)),this._debug(b,"refreshing attempt",c),await by(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:a},headers:this.headers,xform:bA})),d=(a,b)=>{let c=200*Math.pow(2,a);return b&&a4(b)&&Date.now()+c-e<3e4},new Promise((a,b)=>{(async()=>{for(let e=0;e<1/0;e++)try{let b=await c(e);if(!d(e,null,b))return void a(b)}catch(a){if(!d(e,a))return void b(a)}})()}))}catch(a){if(this._debug(b,"error",a),aX(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(b,"end")}}_isValidSession(a){return"object"==typeof a&&null!==a&&"access_token"in a&&"refresh_token"in a&&"expires_at"in a}async _handleProviderSignIn(a,b){let c=await this._getUrlForProvider(`${this.url}/authorize`,a,{redirectTo:b.redirectTo,scopes:b.scopes,queryParams:b.queryParams});return this._debug("#_handleProviderSignIn()","provider",a,"options",b,"url",c),{data:{provider:a,url:c},error:null}}async _recoverAndRefresh(){var a,b;let c="#_recoverAndRefresh()";this._debug(c,"begin");try{let d=await bh(this.storage,this.storageKey);if(d&&this.userStorage){let b=await bh(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!b&&(b={user:d.user},await bg(this.userStorage,this.storageKey+"-user",b)),d.user=null!=(a=null==b?void 0:b.user)?a:bt()}else if(d&&!d.user&&!d.user){let a=await bh(this.storage,this.storageKey+"-user");a&&(null==a?void 0:a.user)?(d.user=a.user,await bi(this.storage,this.storageKey+"-user"),await bg(this.storage,this.storageKey,d)):d.user=bt()}if(this._debug(c,"session from storage",d),!this._isValidSession(d)){this._debug(c,"session is not valid"),null!==d&&await this._removeSession();return}let e=(null!=(b=d.expires_at)?b:1/0)*1e3-Date.now()<9e4;if(this._debug(c,`session has${e?"":" not"} expired with margin of 90000s`),e){if(this.autoRefreshToken&&d.refresh_token){let{error:a}=await this._callRefreshToken(d.refresh_token);a&&(console.error(a),a4(a)||(this._debug(c,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(d.user&&!0===d.user.__isUserNotAvailableProxy)try{let{data:a,error:b}=await this._getUser(d.access_token);!b&&(null==a?void 0:a.user)?(d.user=a.user,await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)):this._debug(c,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(c,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",d)}catch(a){this._debug(c,"error",a),console.error(a);return}finally{this._debug(c,"end")}}async _callRefreshToken(a){var b,c;if(!a)throw new a_;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let d=`#_callRefreshToken(${a.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new bj;let{data:b,error:c}=await this._refreshAccessToken(a);if(c)throw c;if(!b.session)throw new a_;await this._saveSession(b.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",b.session);let d={data:b.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(a){if(this._debug(d,"error",a),aX(a)){let c={data:null,error:a};return a4(a)||await this._removeSession(),null==(b=this.refreshingDeferred)||b.resolve(c),c}throw null==(c=this.refreshingDeferred)||c.reject(a),a}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(a,b,c=!0){let d=`#_notifyAllSubscribers(${a})`;this._debug(d,"begin",b,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:a,session:b});let d=[],e=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(a,b)}catch(a){d.push(a)}});if(await Promise.all(e),d.length>0){for(let a=0;a<d.length;a+=1)console.error(d[a]);throw d[0]}}finally{this._debug(d,"end")}}async _saveSession(a){this._debug("#_saveSession()",a),this.suppressGetSessionWarning=!0;let b=Object.assign({},a),c=b.user&&!0===b.user.__isUserNotAvailableProxy;if(this.userStorage){!c&&b.user&&await bg(this.userStorage,this.storageKey+"-user",{user:b.user});let a=Object.assign({},b);delete a.user;let d=bu(a);await bg(this.storage,this.storageKey,d)}else{let a=bu(b);await bg(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await bi(this.storage,this.storageKey),await bi(this.storage,this.storageKey+"-code-verifier"),await bi(this.storage,this.storageKey+"-user"),this.userStorage&&await bi(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()"),this.visibilityChangedCallback,this.visibilityChangedCallback=null}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let a=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=a,a&&"object"==typeof a&&"function"==typeof a.unref?a.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(a),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let a=this.autoRefreshTicker;this.autoRefreshTicker=null,a&&clearInterval(a)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let a=Date.now();try{return await this._useSession(async b=>{let{data:{session:c}}=b;if(!c||!c.refresh_token||!c.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let d=Math.floor((1e3*c.expires_at-a)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),d<=3&&await this._callRefreshToken(c.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(a){if(a.isAcquireTimeout||a instanceof bJ)this._debug("auto refresh token tick lock not available");else throw a}}async _handleVisibilityChange(){return this._debug("#_handleVisibilityChange()"),this.autoRefreshToken&&this.startAutoRefresh(),!1}async _onVisibilityChanged(a){let b=`#_onVisibilityChanged(${a})`;this._debug(b,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),a||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(b,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(a,b,c){let d=[`provider=${encodeURIComponent(b)}`];if((null==c?void 0:c.redirectTo)&&d.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),(null==c?void 0:c.scopes)&&d.push(`scopes=${encodeURIComponent(c.scopes)}`),"pkce"===this.flowType){let[a,b]=await bp(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(b)}`});d.push(c.toString())}if(null==c?void 0:c.queryParams){let a=new URLSearchParams(c.queryParams);d.push(a.toString())}return(null==c?void 0:c.skipBrowserRedirect)&&d.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${a}?${d.join("&")}`}async _unenroll(a){try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;return e?{data:null,error:e}:await by(this.fetch,"DELETE",`${this.url}/factors/${a.factorId}`,{headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _enroll(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)return{data:null,error:f};let g=Object.assign({friendly_name:a.friendlyName,factor_type:a.factorType},"phone"===a.factorType?{phone:a.phone}:"totp"===a.factorType?{issuer:a.issuer}:{}),{data:h,error:i}=await by(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:null==(c=null==e?void 0:e.session)?void 0:c.access_token});return i?{data:null,error:i}:("totp"===a.factorType&&"totp"===h.type&&(null==(d=null==h?void 0:h.totp)?void 0:d.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),{data:h,error:null})})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _verify(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c,d,e;let{data:f,error:g}=b;if(g)return{data:null,error:g};let h=Object.assign({challenge_id:a.challengeId},"webauthn"in a?{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_response:"create"===a.webauthn.type?(d=a.webauthn.credential_response,"toJSON"in d&&"function"==typeof d.toJSON?d.toJSON():{id:d.id,rawId:d.id,response:{attestationObject:be(new Uint8Array(d.response.attestationObject)),clientDataJSON:be(new Uint8Array(d.response.clientDataJSON))},type:"public-key",clientExtensionResults:d.getClientExtensionResults(),authenticatorAttachment:null!=(e=d.authenticatorAttachment)?e:void 0}):function(a){var b;if("toJSON"in a&&"function"==typeof a.toJSON)return a.toJSON();let c=a.getClientExtensionResults(),d=a.response;return{id:a.id,rawId:a.id,response:{authenticatorData:be(new Uint8Array(d.authenticatorData)),clientDataJSON:be(new Uint8Array(d.clientDataJSON)),signature:be(new Uint8Array(d.signature)),userHandle:d.userHandle?be(new Uint8Array(d.userHandle)):void 0},type:"public-key",clientExtensionResults:c,authenticatorAttachment:null!=(b=a.authenticatorAttachment)?b:void 0}}(a.webauthn.credential_response)})}:{code:a.code}),{data:i,error:j}=await by(this.fetch,"POST",`${this.url}/factors/${a.factorId}/verify`,{body:h,headers:this.headers,jwt:null==(c=null==f?void 0:f.session)?void 0:c.access_token});return j?{data:null,error:j}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:j})})}catch(a){if(aX(a))return{data:null,error:a};throw a}})}async _challenge(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return{data:null,error:e};let f=await by(this.fetch,"POST",`${this.url}/factors/${a.factorId}/challenge`,{body:a,headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token});if(f.error)return f;let{data:g}=f;if("webauthn"!==g.type)return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(a);let{challenge:b,user:c,excludeCredentials:d}=a,e=(0,w.__rest)(a,["challenge","user","excludeCredentials"]),f=bd(b).buffer,g=Object.assign(Object.assign({},c),{id:bd(c.id).buffer}),h=Object.assign(Object.assign({},e),{challenge:f,user:g});if(d&&d.length>0){h.excludeCredentials=Array(d.length);for(let a=0;a<d.length;a++){let b=d[a];h.excludeCredentials[a]=Object.assign(Object.assign({},b),{id:bd(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return h}(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(a);let{challenge:b,allowCredentials:c}=a,d=(0,w.__rest)(a,["challenge","allowCredentials"]),e=bd(b).buffer,f=Object.assign(Object.assign({},d),{challenge:e});if(c&&c.length>0){f.allowCredentials=Array(c.length);for(let a=0;a<c.length;a++){let b=c[a];f.allowCredentials[a]=Object.assign(Object.assign({},b),{id:bd(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return f}(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(aX(a))return{data:null,error:a};throw a}})}async _challengeAndVerify(a){let{data:b,error:c}=await this._challenge({factorId:a.factorId});return c?{data:null,error:c}:await this._verify({factorId:a.factorId,challengeId:b.id,code:a.code})}async _listFactors(){var a;let{data:{user:b},error:c}=await this.getUser();if(c)return{data:null,error:c};let d={all:[],phone:[],totp:[],webauthn:[]};for(let c of null!=(a=null==b?void 0:b.factors)?a:[])d.all.push(c),"verified"===c.status&&d[c.factor_type].push(c);return{data:d,error:null}}async _getAuthenticatorAssuranceLevel(){var a,b;let{data:{session:c},error:d}=await this.getSession();if(d)return{data:null,error:d};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:e}=bk(c.access_token),f=null;e.aal&&(f=e.aal);let g=f;return(null!=(b=null==(a=c.user.factors)?void 0:a.filter(a=>"verified"===a.status))?b:[]).length>0&&(g="aal2"),{data:{currentLevel:f,nextLevel:g,currentAuthenticationMethods:e.amr||[]},error:null}}async _getAuthorizationDetails(a){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;return d?{data:null,error:d}:c?await by(this.fetch,"GET",`${this.url}/oauth/authorizations/${a}`,{headers:this.headers,jwt:c.access_token,xform:a=>({data:a,error:null})}):{data:null,error:new a_}})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _approveAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return{data:null,error:d};if(!c)return{data:null,error:new a_};let e=await by(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async _denyAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return{data:null,error:d};if(!c)return{data:null,error:new a_};let e=await by(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(aX(a))return{data:null,error:a};throw a}}async fetchJwk(a,b={keys:[]}){let c=b.keys.find(b=>b.kid===a);if(c)return c;let d=Date.now();if((c=this.jwks.keys.find(b=>b.kid===a))&&this.jwks_cached_at+6e5>d)return c;let{data:e,error:f}=await by(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return e.keys&&0!==e.keys.length&&(this.jwks=e,this.jwks_cached_at=d,c=e.keys.find(b=>b.kid===a))?c:null}async getClaims(a,b={}){try{var c;let d,e=a;if(!e){let{data:a,error:b}=await this.getSession();if(b||!a.session)return{data:null,error:b};e=a.session.access_token}let{header:f,payload:g,signature:h,raw:{header:i,payload:j}}=bk(e);(null==b?void 0:b.allowExpired)||function(a){if(!a)throw Error("Missing exp claim");if(a<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(g.exp);let k=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,(null==b?void 0:b.keys)?{keys:b.keys}:null==b?void 0:b.jwks);if(!k){let{error:a}=await this.getUser(e);if(a)throw a;return{data:{claims:g,header:f,signature:h},error:null}}let l=function(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(f.alg),m=await crypto.subtle.importKey("jwk",k,l,!0,["verify"]);if(!await crypto.subtle.verify(l,m,h,(c=`${i}.${j}`,d=[],!function(a,b){for(let c=0;c<a.length;c+=1){let d=a.charCodeAt(c);if(d>55295&&d<=56319){let b=(d-55296)*1024&65535;d=(a.charCodeAt(c+1)-56320&65535|b)+65536,c+=1}!function(a,b){if(a<=127)return b(a);if(a<=2047){b(192|a>>6),b(128|63&a);return}if(a<=65535){b(224|a>>12),b(128|a>>6&63),b(128|63&a);return}if(a<=1114111){b(240|a>>18),b(128|a>>12&63),b(128|a>>6&63),b(128|63&a);return}throw Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}(d,b)}}(c,a=>d.push(a)),new Uint8Array(d))))throw new a6("Invalid JWT signature");return{data:{claims:g,header:f,signature:h},error:null}}catch(a){if(aX(a))return{data:null,error:a};throw a}}}bY.nextInstanceID=0;let bZ=bY;class b$ extends bZ{constructor(a){super(a)}}class b_{constructor(a,b,c){var d,e,f;this.supabaseUrl=a,this.supabaseKey=b;const g=function(a){let b=null==a?void 0:a.trim();if(!b)throw Error("supabaseUrl is required.");if(!b.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(b.endsWith("/")?b:b+"/")}catch(a){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(a);if(!b)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const h=`sb-${g.hostname.split(".")[0]}-auth-token`,i=function(a,b){var c,d;let{db:e,auth:f,realtime:g,global:h}=a,{db:i,auth:j,realtime:k,global:l}=b,m={db:Object.assign(Object.assign({},i),e),auth:Object.assign(Object.assign({},j),f),realtime:Object.assign(Object.assign({},k),g),storage:{},global:Object.assign(Object.assign(Object.assign({},l),h),{headers:Object.assign(Object.assign({},null!=(c=null==l?void 0:l.headers)?c:{}),null!=(d=null==h?void 0:h.headers)?d:{})}),accessToken:async()=>""};return a.accessToken?m.accessToken=a.accessToken:delete m.accessToken,m}(null!=c?c:{},{db:aN,realtime:aP,auth:Object.assign(Object.assign({},aO),{storageKey:h}),global:aM});this.storageKey=null!=(d=i.auth.storageKey)?d:"",this.headers=null!=(e=i.global.headers)?e:{},i.accessToken?(this.accessToken=i.accessToken,this.auth=new Proxy({},{get:(a,b)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(f=i.auth)?f:{},this.headers,i.global.fetch),this.fetch=((a,b,c)=>{let d,e=(d=c||("undefined"==typeof fetch?aQ.default:fetch),(...a)=>d(...a)),f="undefined"==typeof Headers?aQ.Headers:Headers;return async(c,d)=>{var g;let h=null!=(g=await b())?g:a,i=new f(null==d?void 0:d.headers);return i.has("apikey")||i.set("apikey",a),i.has("Authorization")||i.set("Authorization",`Bearer ${h}`),e(c,Object.assign(Object.assign({},d),{headers:i}))}})(b,this._getAccessToken.bind(this),i.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},i.realtime)),this.rest=new D(new URL("rest/v1",g).href,{headers:this.headers,schema:i.db.schema,fetch:this.fetch}),this.storage=new aK(this.storageUrl.href,this.headers,this.fetch,null==c?void 0:c.storage),i.accessToken||this._listenForAuthEvents()}get functions(){return new B(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,b={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(a,b,c)}channel(a,b={config:{}}){return this.realtime.channel(a,b)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var a,b;if(this.accessToken)return await this.accessToken();let{data:c}=await this.auth.getSession();return null!=(b=null==(a=c.session)?void 0:a.access_token)?b:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,storageKey:f,flowType:g,lock:h,debug:i},j,k){let l={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new b$({url:this.authUrl.href,headers:Object.assign(Object.assign({},l),j),storageKey:f,autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,flowType:g,lock:h,debug:i,fetch:k,hasCustomAuthorizationHeader:Object.keys(this.headers).some(a=>"authorization"===a.toLowerCase())})}_initRealtimeClient(a){return new aa(this.realtimeUrl.href,Object.assign(Object.assign({},a),{params:Object.assign({apikey:this.supabaseKey},null==a?void 0:a.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,b)=>{this._handleTokenChanged(a,"CLIENT",null==b?void 0:b.access_token)})}_handleTokenChanged(a,b,c){("TOKEN_REFRESHED"===a||"SIGNED_IN"===a)&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):"SIGNED_OUT"===a&&(this.realtime.setAuth(),"STORAGE"==b&&this.auth.signOut(),this.changedAccessToken=void 0)}}let b0=(a,b,c)=>new b_(a,b,c);(function(){if("undefined"==typeof process)return!1;let a=process.version;if(null==a)return!1;let b=a.match(/^v(\d+)\./);return!!b&&18>=parseInt(b[1],10)})()&&console.warn(`  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217`);let b1=process.env.NEXT_PUBLIC_SUPABASE_URL||"",b2=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",b3=process.env.SUPABASE_URL||"",b4=process.env.SUPABASE_SERVICE_ROLE_KEY||"";process.env.SUPABASE_ANON_KEY,b1&&b2?b0(b1,b2):b0("https://placeholder.supabase.co","placeholder-key"),b3&&b4?b0(b3,b4,{auth:{autoRefreshToken:!1,persistSession:!1}}):b1&&(b4||b2)?b0(b1,b4||b2,{auth:{autoRefreshToken:!1,persistSession:!1}}):b0("https://placeholder.supabase.co","placeholder-key",{auth:{autoRefreshToken:!1,persistSession:!1}});var b5=a.i(25657);b5.parse,b5.serialize;let b6={path:"/",sameSite:"lax",httpOnly:!1,maxAge:3456e4},b7=/^(.*)[.](0|[1-9][0-9]*)$/;function b8(a,b){if(a===b)return!0;let c=a.match(b7);return!!c&&c[1]===b}function b9(a,b,c){let d=c??3180,e=encodeURIComponent(b);if(e.length<=d)return[{name:a,value:b}];let f=[];for(;e.length>0;){let a=e.slice(0,d),b=a.lastIndexOf("%");b>d-3&&(a=a.slice(0,b));let c="";for(;a.length>0;)try{c=decodeURIComponent(a);break}catch(b){if(b instanceof URIError&&"%"===a.at(-3)&&a.length>3)a=a.slice(0,a.length-3);else throw b}f.push(c),e=e.slice(a.length)}return f.map((b,c)=>({name:`${a}.${c}`,value:b}))}async function ca(a,b){let c=await b(a);if(c)return c;let d=[];for(let c=0;;c++){let e=`${a}.${c}`,f=await b(e);if(!f)break;d.push(f)}return d.length>0?d.join(""):null}let cb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),cc=" 	\n\r=".split(""),cd=(()=>{let a=Array(128);for(let b=0;b<a.length;b+=1)a[b]=-1;for(let b=0;b<cc.length;b+=1)a[cc[b].charCodeAt(0)]=-2;for(let b=0;b<cb.length;b+=1)a[cb[b].charCodeAt(0)]=b;return a})();function ce(a){let b=[],c=0,d=0;if(function(a,b){for(let c=0;c<a.length;c+=1){let d=a.charCodeAt(c);if(d>55295&&d<=56319){let b=(d-55296)*1024&65535;d=(a.charCodeAt(c+1)-56320&65535|b)+65536,c+=1}!function(a,b){if(a<=127)return b(a);if(a<=2047){b(192|a>>6),b(128|63&a);return}if(a<=65535){b(224|a>>12),b(128|a>>6&63),b(128|63&a);return}if(a<=1114111){b(240|a>>18),b(128|a>>12&63),b(128|a>>6&63),b(128|63&a);return}throw Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}(d,b)}}(a,a=>{for(c=c<<8|a,d+=8;d>=6;){let a=c>>d-6&63;b.push(cb[a]),d-=6}}),d>0)for(c<<=6-d,d=6;d>=6;){let a=c>>d-6&63;b.push(cb[a]),d-=6}return b.join("")}function cf(a){let b=[],c=a=>{b.push(String.fromCodePoint(a))},d={utf8seq:0,codepoint:0},e=0,f=0;for(let b=0;b<a.length;b+=1){let g=cd[a.charCodeAt(b)];if(g>-1)for(e=e<<6|g,f+=6;f>=8;)(function(a,b,c){if(0===b.utf8seq){if(a<=127)return c(a);for(let c=1;c<6;c+=1)if((a>>7-c&1)==0){b.utf8seq=c;break}if(2===b.utf8seq)b.codepoint=31&a;else if(3===b.utf8seq)b.codepoint=15&a;else if(4===b.utf8seq)b.codepoint=7&a;else throw Error("Invalid UTF-8 sequence");b.utf8seq-=1}else if(b.utf8seq>0){if(a<=127)throw Error("Invalid UTF-8 sequence");b.codepoint=b.codepoint<<6|63&a,b.utf8seq-=1,0===b.utf8seq&&c(b.codepoint)}})(e>>f-8&255,d,c),f-=8;else if(-2===g)continue;else throw Error(`Invalid Base64-URL character "${a.at(b)}" at position ${b}`)}return b.join("")}let cg="base64-";async function ch({getAll:a,setAll:b,setItems:c,removedItems:d},e){let f=e.cookieEncoding,g=e.cookieOptions??null,h=await a([...c?Object.keys(c):[],...d?Object.keys(d):[]]),i=h?.map(({name:a})=>a)||[],j=Object.keys(d).flatMap(a=>i.filter(b=>b8(b,a))),k=Object.keys(c).flatMap(a=>{let b=new Set(i.filter(b=>b8(b,a))),d=c[a];"base64url"===f&&(d=cg+ce(d));let e=b9(a,d);return e.forEach(a=>{b.delete(a.name)}),j.push(...b),e}),l={...b6,...g,maxAge:0},m={...b6,...g,maxAge:b6.maxAge};delete l.name,delete m.name,await b([...j.map(a=>({name:a,value:"",options:l})),...k.map(({name:a,value:b})=>({name:a,value:b,options:m}))])}a.i(5211);var ci=a.i(22997);async function cj(){try{let a=await (0,ci.cookies)(),b=function(a,b,c){if(!a||!b)throw Error(`Your project's URL and Key are required to create a Supabase client!

Check your Supabase project's API settings to find these values

https://supabase.com/dashboard/project/_/settings/api`);let{storage:d,getAll:e,setAll:f,setItems:g,removedItems:h}=function(a,b){let c,d,e=a.cookies??null,f=a.cookieEncoding,g={},h={};if(e)if("get"in e){let a=async a=>{let b=a.flatMap(a=>[a,...Array.from({length:5}).map((b,c)=>`${a}.${c}`)]),c=[];for(let a=0;a<b.length;a+=1){let d=await e.get(b[a]);(d||"string"==typeof d)&&c.push({name:b[a],value:d})}return c};if(c=async b=>await a(b),"set"in e&&"remove"in e)d=async a=>{for(let b=0;b<a.length;b+=1){let{name:c,value:d,options:f}=a[b];d?await e.set(c,d,f):await e.remove(c,f)}};else if(b)d=async()=>{console.warn("@supabase/ssr: createServerClient was configured without set and remove cookie methods, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness. Consider switching to the getAll and setAll cookie methods instead of get, set and remove which are deprecated and can be difficult to use correctly.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring a getAll and setAll cookie method (deprecated: alternatively both get, set and remove can be used)")}else if("getAll"in e)if(c=async()=>await e.getAll(),"setAll"in e)d=e.setAll;else if(b)d=async()=>{console.warn("@supabase/ssr: createServerClient was configured without the setAll cookie method, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring both getAll and setAll cookie methods (deprecated: alternatively both get, set and remove can be used)");else throw Error(`@supabase/ssr: ${b?"createServerClient":"createBrowserClient"} requires configuring getAll and setAll cookie methods (deprecated: alternatively use get, set and remove).`);else if(b||1)if(b)throw Error("@supabase/ssr: createServerClient must be initialized with cookie options that specify getAll and setAll functions (deprecated, not recommended: alternatively use get, set and remove)");else c=()=>[],d=()=>{throw Error("@supabase/ssr: createBrowserClient in non-browser runtimes (including Next.js pre-rendering mode) was not initialized cookie options that specify getAll and setAll functions (deprecated: alternatively use get, set and remove), but they were needed")};else c=()=>{let a;return a=(0,b5.parse)(document.cookie),Object.keys(a).map(b=>({name:b,value:a[b]??""}))},d=a=>{a.forEach(({name:a,value:b,options:c})=>{document.cookie=(0,b5.serialize)(a,b,c)})};return b?{getAll:c,setAll:d,setItems:g,removedItems:h,storage:{isServer:!0,getItem:async a=>{if("string"==typeof g[a])return g[a];if(h[a])return null;let b=await c([a]),d=await ca(a,async a=>{let c=b?.find(({name:b})=>b===a)||null;return c?c.value:null});if(!d)return null;let e=d;return"string"==typeof d&&d.startsWith(cg)&&(e=cf(d.substring(cg.length))),e},setItem:async(b,e)=>{b.endsWith("-code-verifier")&&await ch({getAll:c,setAll:d,setItems:{[b]:e},removedItems:{}},{cookieOptions:a?.cookieOptions??null,cookieEncoding:f}),g[b]=e,delete h[b]},removeItem:async a=>{delete g[a],h[a]=!0}}}:{getAll:c,setAll:d,setItems:g,removedItems:h,storage:{isServer:!1,getItem:async a=>{let b=await c([a]),d=await ca(a,async a=>{let c=b?.find(({name:b})=>b===a)||null;return c?c.value:null});if(!d)return null;let e=d;return d.startsWith(cg)&&(e=cf(d.substring(cg.length))),e},setItem:async(b,e)=>{let g=await c([b]),h=new Set((g?.map(({name:a})=>a)||[]).filter(a=>b8(a,b))),i=e;"base64url"===f&&(i=cg+ce(e));let j=b9(b,i);j.forEach(({name:a})=>{h.delete(a)});let k={...b6,...a?.cookieOptions,maxAge:0},l={...b6,...a?.cookieOptions,maxAge:b6.maxAge};delete k.name,delete l.name;let m=[...[...h].map(a=>({name:a,value:"",options:k})),...j.map(({name:a,value:b})=>({name:a,value:b,options:l}))];m.length>0&&await d(m)},removeItem:async b=>{let e=await c([b]),f=(e?.map(({name:a})=>a)||[]).filter(a=>b8(a,b)),g={...b6,...a?.cookieOptions,maxAge:0};delete g.name,f.length>0&&await d(f.map(a=>({name:a,value:"",options:g})))}}}}({...c,cookieEncoding:c?.cookieEncoding??"base64url"},!0),i=b0(a,b,{...c,global:{...c?.global,headers:{...c?.global?.headers,"X-Client-Info":"supabase-ssr/0.7.0 createServerClient"}},auth:{...c?.cookieOptions?.name?{storageKey:c.cookieOptions.name}:null,...c?.auth,flowType:"pkce",autoRefreshToken:!1,detectSessionInUrl:!1,persistSession:!0,storage:d}});return i.auth.onAuthStateChange(async a=>{(Object.keys(g).length>0||Object.keys(h).length>0)&&("SIGNED_IN"===a||"TOKEN_REFRESHED"===a||"USER_UPDATED"===a||"PASSWORD_RECOVERY"===a||"SIGNED_OUT"===a||"MFA_CHALLENGE_VERIFIED"===a)&&await ch({getAll:e,setAll:f,setItems:g,removedItems:h},{cookieOptions:c?.cookieOptions??null,cookieEncoding:c?.cookieEncoding??"base64url"})}),i}(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>a.getAll().map(a=>({name:a.name,value:a.value})),setAll(b){b.forEach(({name:b,value:c,options:d})=>{a.set(b,c,d)})}}}),{data:{user:c},error:d}=await b.auth.getUser();if(d||!c)return null;return{id:c.id,email:c.email||"unknown@example.com"}}catch(a){return null}}var ck=void 0,cl="undefined"!=typeof globalThis?globalThis:ck,cm=Array.prototype,cn=cm.forEach,co=cm.indexOf,cp=null==cl?void 0:cl.navigator,cq=null==cl?void 0:cl.document,cr=null==cl?void 0:cl.location,cs=null==cl?void 0:cl.fetch,ct=null!=cl&&cl.XMLHttpRequest&&"withCredentials"in new cl.XMLHttpRequest?cl.XMLHttpRequest:void 0,cu=null==cl?void 0:cl.AbortController,cv=null==cp?void 0:cp.userAgent,cw=null!=ck?ck:{},cx={DEBUG:!1,LIB_VERSION:"1.290.0"};function cy(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function cz(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){cy(f,d,e,g,h,"next",a)}function h(a){cy(f,d,e,g,h,"throw",a)}g(void 0)})}}function cA(){return(cA=Object.assign.bind()).apply(null,arguments)}function cB(a,b){if(null==a)return{};var c={};for(var d in a)if(({}).hasOwnProperty.call(a,d)){if(-1!==b.indexOf(d))continue;c[d]=a[d]}return c}var cC=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","leikibot","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercel-screenshot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleother","google-cloudvertexbot","googleweblight","mediapartners-google","storebot-google","google-inspectiontool","bytespider"],cD=function(a,b){if(void 0===b&&(b=[]),!a)return!1;var c=a.toLowerCase();return cC.concat(b).some(a=>{var b=a.toLowerCase();return -1!==c.indexOf(b)})},cE=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];function cF(a,b){return -1!==a.indexOf(b)}var cG=function(a){return a.trim()},cH=function(a){return a.replace(/^\$/,"")},cI=Array.isArray,cJ=Object.prototype,cK=cJ.hasOwnProperty,cL=cJ.toString,cM=cI||function(a){return"[object Array]"===cL.call(a)},cN=a=>"function"==typeof a,cO=a=>a===Object(a)&&!cM(a),cP=a=>{if(cO(a)){for(var b in a)if(cK.call(a,b))return!1;return!0}return!1},cQ=a=>void 0===a,cR=a=>"[object String]"==cL.call(a),cS=a=>cR(a)&&0===a.trim().length,cT=a=>null===a,cU=a=>cQ(a)||cT(a),cV=a=>"[object Number]"==cL.call(a),cW=a=>"[object Boolean]"===cL.call(a),cX=a=>cF(cE,a);function cY(a){return null===a||"object"!=typeof a}function cZ(a,b){return Object.prototype.toString.call(a)==="[object "+b+"]"}function c$(a){return!cQ(Event)&&function(a,b){try{return a instanceof b}catch(a){return!1}}(a,Event)}var c_=[!0,"true",1,"1","yes"],c0=[!1,"false",0,"0","no"];function c1(a,b,c,d,e){return b>c&&(d.warn("min cannot be greater than max."),b=c),cV(a)?a>c?(d.warn(" cannot be  greater than max: "+c+". Using max value instead."),c):a<b?(d.warn(" cannot be less than min: "+b+". Using min value instead."),b):a:(d.warn(" must be a number. using max or fallback. max: "+c+", fallback: "+e),c1(e||c,b,c,d))}class c2{constructor(a){this.t={},this.i=a.i,this.o=c1(a.bucketSize,0,100,a.h),this.m=c1(a.refillRate,0,this.o,a.h),this.$=c1(a.refillInterval,0,864e5,a.h)}S(a,b){var c=Math.floor((b-a.lastAccess)/this.$);if(c>0){var d=c*this.m;a.tokens=Math.min(a.tokens+d,this.o),a.lastAccess=a.lastAccess+c*this.$}}consumeRateLimit(a){var b,c=Date.now(),d=String(a),e=this.t[d];return e?this.S(e,c):(e={tokens:this.o,lastAccess:c},this.t[d]=e),0===e.tokens||(e.tokens--,0===e.tokens&&(null==(b=this.i)||b.call(this,a)),0===e.tokens)}stop(){this.t={}}}var c3,c4,c5,c6,c7,c8,c9,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,dp,dq,dr,ds,dt,du,dv=a=>a instanceof Error;function dw(a,b,c,d){var e={platform:"web:javascript",filename:a,function:"<anonymous>"===b?"?":b,in_app:!0};return cQ(c)||(e.lineno=c),cQ(d)||(e.colno=d),e}var dx=(a,b)=>{var c=-1!==a.indexOf("safari-extension"),d=-1!==a.indexOf("safari-web-extension");return c||d?[-1!==a.indexOf("@")?a.split("@")[0]:"?",c?"safari-extension:"+b:"safari-web-extension:"+b]:[a,b]},dy=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,dz=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,dA=/\((\S*)(?::(\d+))(?::(\d+))\)/,dB=a=>{var b=dy.exec(a);if(b){var[,c,d,e]=b;return dw(c,"?",+d,+e)}var f=dz.exec(a);if(f){if(f[2]&&0===f[2].indexOf("eval")){var g=dA.exec(f[2]);g&&(f[2]=g[1],f[3]=g[2],f[4]=g[3])}var[h,i]=dx(f[1]||"?",f[2]);return dw(i,h,f[3]?+f[3]:void 0,f[4]?+f[4]:void 0)}},dC=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,dD=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,dE=a=>{var b=dC.exec(a);if(b){if(b[3]&&b[3].indexOf(" > eval")>-1){var c=dD.exec(b[3]);c&&(b[1]=b[1]||"eval",b[3]=c[1],b[4]=c[2],b[5]="")}var d=b[3],e=b[1]||"?";return[e,d]=dx(e,d),dw(d,e,b[4]?+b[4]:void 0,b[5]?+b[5]:void 0)}},dF=/\(error: (.*)\)/;class dG{constructor(a,b,c){void 0===a&&(a=[]),void 0===b&&(b=[]),void 0===c&&(c=[]),this.coercers=a,this.modifiers=c,this.stackParser=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a,c){void 0===c&&(c=0);for(var d=[],e=a.split("\n"),f=c;f<e.length;f++){var g=e[f];if(!(g.length>1024)){var h=dF.test(g)?g.replace(dF,"$1"):g;if(!h.match(/\S*Error: /)){for(var i of b){var j=i(h);if(j){d.push(j);break}}if(d.length>=50)break}}}if(!d.length)return[];var k=Array.from(d);return k.reverse(),k.slice(0,50).map(a=>cA({},a,{filename:a.filename||(k[k.length-1]||{}).filename,function:a.function||"?"}))}}(...b)}buildFromUnknown(a,b){void 0===b&&(b={});var c=b&&b.mechanism||{handled:!0,type:"generic"},d=this.buildCoercingContext(c,b,0).apply(a),e=this.buildParsingContext(),f=this.parseStacktrace(d,e);return{$exception_list:this.convertToExceptionList(f,c),$exception_level:"error"}}modifyFrames(a){var b=this;return cz(function*(){for(var c of a)c.stacktrace&&c.stacktrace.frames&&cM(c.stacktrace.frames)&&(c.stacktrace.frames=yield b.applyModifiers(c.stacktrace.frames));return a})()}coerceFallback(a){var b;return{type:"Error",value:"Unknown error",stack:null==(b=a.syntheticException)?void 0:b.stack,synthetic:!0}}parseStacktrace(a,b){var c,d;return null!=a.cause&&(c=this.parseStacktrace(a.cause,b)),""!=a.stack&&null!=a.stack&&(d=this.applyChunkIds(this.stackParser(a.stack,+!!a.synthetic),b.chunkIdMap)),cA({},a,{cause:c,stack:d})}applyChunkIds(a,b){return a.map(a=>(a.filename&&b&&(a.chunk_id=b[a.filename]),a))}applyCoercers(a,b){for(var c of this.coercers)if(c.match(a))return c.coerce(a,b);return this.coerceFallback(b)}applyModifiers(a){var b=this;return cz(function*(){var c=a;for(var d of b.modifiers)c=yield d(c);return c})()}convertToExceptionList(a,b){var c,d,e,f={type:a.type,value:a.value,mechanism:{type:null!=(c=b.type)?c:"generic",handled:null==(d=b.handled)||d,synthetic:null!=(e=a.synthetic)&&e}};a.stack&&(f.stacktrace={type:"raw",frames:a.stack});var g=[f];return null!=a.cause&&g.push(...this.convertToExceptionList(a.cause,cA({},b,{handled:!0}))),g}buildParsingContext(){return{chunkIdMap:function(a){var b=globalThis._posthogChunkIds;if(b){var c=Object.keys(b);return du&&c.length===dt||(dt=c.length,du=c.reduce((c,d)=>{ds||(ds={});var e=ds[d];if(e)c[e[0]]=e[1];else for(var f=a(d),g=f.length-1;g>=0;g--){var h=f[g],i=null==h?void 0:h.filename,j=b[d];if(i&&j){c[i]=j,ds[d]=[i,j];break}}return c},{})),du}}(this.stackParser)}}buildCoercingContext(a,b,c){void 0===c&&(c=0);var d=(c,d)=>{if(d<=4){var e=this.buildCoercingContext(a,b,d);return this.applyCoercers(c,e)}};return cA({},b,{syntheticException:0==c?b.syntheticException:void 0,mechanism:a,apply:a=>d(a,c),next:a=>d(a,c+1)})}}class dH{match(a){return this.isDOMException(a)||this.isDOMError(a)}coerce(a,b){var c=cR(a.stack);return{type:this.getType(a),value:this.getValue(a),stack:c?a.stack:void 0,cause:a.cause?b.next(a.cause):void 0,synthetic:!1}}getType(a){return this.isDOMError(a)?"DOMError":"DOMException"}getValue(a){var b=a.name||(this.isDOMError(a)?"DOMError":"DOMException");return a.message?b+": "+a.message:b}isDOMException(a){return cZ(a,"DOMException")}isDOMError(a){return cZ(a,"DOMError")}}class dI{match(a){return a instanceof Error}coerce(a,b){return{type:this.getType(a),value:this.getMessage(a,b),stack:this.getStack(a),cause:a.cause?b.next(a.cause):void 0,synthetic:!1}}getType(a){return a.name||a.constructor.name}getMessage(a,b){var c=a.message;return c.error&&"string"==typeof c.error.message?String(c.error.message):String(c)}getStack(a){return a.stacktrace||a.stack||void 0}}class dJ{constructor(){}match(a){return cZ(a,"ErrorEvent")&&null!=a.error}coerce(a,b){var c;return b.apply(a.error)||{type:"ErrorEvent",value:a.message,stack:null==(c=b.syntheticException)?void 0:c.stack,synthetic:!0}}}var dK=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class dL{match(a){return"string"==typeof a}coerce(a,b){var c,[d,e]=this.getInfos(a);return{type:null!=d?d:"Error",value:null!=e?e:a,stack:null==(c=b.syntheticException)?void 0:c.stack,synthetic:!0}}getInfos(a){var b="Error",c=a,d=a.match(dK);return d&&(b=d[1],c=d[2]),[b,c]}}var dM=["fatal","error","warning","log","info","debug"];function dN(a,b){void 0===b&&(b=40);var c=Object.keys(a);if(c.sort(),!c.length)return"[object has no keys]";for(var d=c.length;d>0;d--){var e=c.slice(0,d).join(", ");if(!(e.length>b))return d===c.length||e.length<=b?e:e.slice(0,b)+"..."}return""}class dO{match(a){return"object"==typeof a&&null!==a}coerce(a,b){var c,d=this.getErrorPropertyFromObject(a);return d?b.apply(d):{type:this.getType(a),value:this.getValue(a),stack:null==(c=b.syntheticException)?void 0:c.stack,level:this.isSeverityLevel(a.level)?a.level:"error",synthetic:!0}}getType(a){return c$(a)?a.constructor.name:"Error"}getValue(a){if("name"in a&&"string"==typeof a.name){var b="'"+a.name+"' captured as exception";return"message"in a&&"string"==typeof a.message&&(b+=" with message: '"+a.message+"'"),b}if("message"in a&&"string"==typeof a.message)return a.message;var c=this.getObjectClassName(a);return(c&&"Object"!==c?"'"+c+"'":"Object")+" captured as exception with keys: "+dN(a)}isSeverityLevel(a){return cR(a)&&!cS(a)&&dM.indexOf(a)>=0}getErrorPropertyFromObject(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b)){var c=a[b];if(dv(c))return c}}getObjectClassName(a){try{var b=Object.getPrototypeOf(a);return b?b.constructor.name:void 0}catch(a){return}}}class dP{match(a){return c$(a)}coerce(a,b){var c,d=a.constructor.name;return{type:d,value:d+" captured as exception with keys: "+dN(a),stack:null==(c=b.syntheticException)?void 0:c.stack,synthetic:!0}}}class dQ{match(a){return cY(a)}coerce(a,b){var c;return{type:"Error",value:"Primitive value captured as exception: "+String(a),stack:null==(c=b.syntheticException)?void 0:c.stack,synthetic:!0}}}class dR{match(a){return cZ(a,"PromiseRejectionEvent")}coerce(a,b){var c,d=this.getUnhandledRejectionReason(a);return cY(d)?{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(d),stack:null==(c=b.syntheticException)?void 0:c.stack,synthetic:!0}:b.apply(d)}getUnhandledRejectionReason(a){if(cY(a))return a;try{if("reason"in a)return a.reason;if("detail"in a&&"reason"in a.detail)return a.detail.reason}catch(a){}return a}}var dS=a=>{var b={k:function(a){ck&&(cx.DEBUG||cw.POSTHOG_DEBUG)&&!cQ(ck.console)&&ck.console},info:function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];b.k("log",...c)},warn:function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];b.k("warn",...c)},error:function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];b.k("error",...c)},critical:function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];console.error(a,...c)},uninitializedWarning:a=>{b.error("You must initialize PostHog before calling "+a)},createLogger:b=>dS(a+" "+b)};return b},dT=dS("[PostHog.js]"),dU=dT.createLogger,dV=dU("[ExternalScriptsLoader]"),dW=(a,b,c)=>{if(a.config.disable_external_dependency_loading)return dV.warn(b+" was requested but loading of external scripts is disabled."),c("Loading of external scripts is disabled");var d=null==cq?void 0:cq.querySelectorAll("script");if(d){for(var e,f=0;f<d.length;f++)if(e=function(){if(d[f].src===b){var a=d[f];return a.__posthog_loading_callback_fired?{v:c()}:(a.addEventListener("load",b=>{a.__posthog_loading_callback_fired=!0,c(void 0,b)}),a.onerror=a=>c(a),{v:void 0})}}())return e.v}var g=()=>{if(!cq)return c("document not found");var d=cq.createElement("script");if(d.type="text/javascript",d.crossOrigin="anonymous",d.src=b,d.onload=a=>{d.__posthog_loading_callback_fired=!0,c(void 0,a)},d.onerror=a=>c(a),a.config.prepare_external_dependency_script&&(d=a.config.prepare_external_dependency_script(d)),!d)return c("prepare_external_dependency_script returned null");var e,f=cq.querySelectorAll("body > script");f.length>0?null==(e=f[0].parentNode)||e.insertBefore(d,f[0]):cq.body.appendChild(d)};null!=cq&&cq.body?g():null==cq||cq.addEventListener("DOMContentLoaded",g)};cw.__PosthogExtensions__=cw.__PosthogExtensions__||{},cw.__PosthogExtensions__.loadExternalDependency=(a,b,c)=>{var d="/static/"+b+".js?v="+a.version;"remote-config"===b&&(d="/array/"+a.config.token+"/config.js"),"toolbar"===b&&(d=d+"&t="+3e5*Math.floor(Date.now()/3e5));var e=a.requestRouter.endpointFor("assets",d);dW(a,e,c)},cw.__PosthogExtensions__.loadSiteApp=(a,b,c)=>{var d=a.requestRouter.endpointFor("api",b);dW(a,d,c)};var dX={};function dY(a,b,c){if(cM(a)){if(cn&&a.forEach===cn)a.forEach(b,c);else if("length"in a&&a.length===+a.length){for(var d=0,e=a.length;d<e;d++)if(d in a&&b.call(c,a[d],d)===dX)return}}}function dZ(a,b,c){if(!cU(a)){if(cM(a))return dY(a,b,c);if(a instanceof FormData){for(var d of a.entries())if(b.call(c,d[1],d[0])===dX)return}else for(var e in a)if(cK.call(a,e)&&b.call(c,a[e],e)===dX)return}}var d$=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return dY(c,function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},d_=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return dY(c,function(b){dY(b,function(b){a.push(b)})}),a};function d0(a){for(var b=Object.keys(a),c=b.length,d=Array(c);c--;)d[c]=[b[c],a[b[c]]];return d}var d1=function(a){return function(){try{for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return a.apply(this,c)}catch(a){dT.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),dT.critical(a)}}},d2=function(a){var b={};return dZ(a,function(a,c){(cR(a)&&a.length>0||cV(a))&&(b[c]=a)}),b},d3=["herokuapp.com","vercel.app","netlify.app"];function d4(a,b){for(var c=0;c<a.length;c++)if(b(a[c]))return a[c]}function d5(a,b,c,d){var{capture:e=!1,passive:f=!0}=null!=d?d:{};null==a||a.addEventListener(b,c,{capture:e,passive:f})}var d6="$people_distinct_id",d7="__alias",d8="__timers",d9="$autocapture_disabled_server_side",ea="$heatmaps_enabled_server_side",eb="$exception_capture_enabled_server_side",ec="$error_tracking_suppression_rules",ed="$error_tracking_capture_extension_exceptions",ee="$web_vitals_enabled_server_side",ef="$dead_clicks_enabled_server_side",eg="$web_vitals_allowed_metrics",eh="$session_recording_remote_config",ei="$sesid",ej="$session_is_sampled",ek="$enabled_feature_flags",el="$early_access_features",em="$feature_flag_details",en="$stored_person_properties",eo="$stored_group_properties",ep="$surveys",eq="$surveys_activated",er="$flag_call_reported",es="$user_state",et="$client_session_props",eu="$capture_rate_limit",ev="$initial_campaign_params",ew="$initial_referrer_info",ex="$initial_person_info",ey="$epp",ez="__POSTHOG_TOOLBAR__",eA="$posthog_cookieless",eB=[d6,d7,"__cmpns",d8,"$session_recording_enabled_server_side",ea,ei,ek,ec,es,el,em,eo,en,ep,er,et,eu,ev,ew,ey,ex];function eC(a){return a instanceof Element&&(a.id===ez||!(null==a.closest||!a.closest(".toolbar-global-fade-container")))}function eD(a){return!!a&&1===a.nodeType}function eE(a,b){return!!a&&!!a.tagName&&a.tagName.toLowerCase()===b.toLowerCase()}function eF(a){return!!a&&3===a.nodeType}function eG(a){return a?cG(a).split(/\s+/):[]}function eH(a){var b="";switch(typeof a.className){case"string":b=a.className;break;case"object":b=(a.className&&"baseVal"in a.className?a.className.baseVal:null)||a.getAttribute("class")||"";break;default:b=""}return eG(b)}function eI(a){return cU(a)?null:cG(a).split(/(\s+)/).filter(a=>eV(a)).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function eJ(a){var b="";return eN(a)&&!eO(a)&&a.childNodes&&a.childNodes.length&&dZ(a.childNodes,function(a){var c;eF(a)&&a.textContent&&(b+=null!=(c=eI(a.textContent))?c:"")}),cG(b)}function eK(a){var b;return cQ(a.target)?a.srcElement||null:null!=(b=a.target)&&b.shadowRoot?a.composedPath()[0]||null:a.target||null}var eL=["a","button","form","input","select","textarea","label"],eM=a=>!a||eE(a,"html")||!eD(a);function eN(a){for(var b=a;b.parentNode&&!eE(b,"body");b=b.parentNode){var c=eH(b);if(cF(c,"ph-sensitive")||cF(c,"ph-no-capture"))return!1}if(cF(eH(a),"ph-include"))return!0;var d=a.type||"";if(cR(d))switch(d.toLowerCase()){case"hidden":case"password":return!1}var e=a.name||a.id||"";return!(cR(e)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(e.replace(/[^a-zA-Z0-9]/g,"")))}function eO(a){return!!(eE(a,"input")&&!["button","checkbox","submit","reset"].includes(a.type)||eE(a,"select")||eE(a,"textarea")||"true"===a.getAttribute("contenteditable"))}var eP="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",eQ=RegExp("^(?:"+eP+")$"),eR=new RegExp(eP),eS="\\d{3}-?\\d{2}-?\\d{4}",eT=RegExp("^("+eS+")$"),eU=RegExp("("+eS+")");function eV(a,b){return void 0===b&&(b=!0),!(cU(a)||cR(a)&&(a=cG(a),(b?eQ:eR).test((a||"").replace(/[- ]/g,""))||(b?eT:eU).test(a)))&&!0}function eW(a){var b=eJ(a);return eV(b=(b+" "+function a(b){var c="";return b&&b.childNodes&&b.childNodes.length&&dZ(b.childNodes,function(b){var d;if(b&&"span"===(null==(d=b.tagName)?void 0:d.toLowerCase()))try{var e=eJ(b);c=(c+" "+e).trim(),b.childNodes&&b.childNodes.length&&(c=(c+" "+a(b)).trim())}catch(a){dT.error("[AutoCapture]",a)}}),c}(a)).trim())?b:""}function eX(a){return a.replace(/"|\\"/g,'\\"')}class eY{constructor(){this.clicks=[]}isRageClick(a,b,c){var d=this.clicks[this.clicks.length-1];if(d&&Math.abs(a-d.x)+Math.abs(b-d.y)<30&&c-d.timestamp<1e3){if(this.clicks.push({x:a,y:b,timestamp:c}),3===this.clicks.length)return!0}else this.clicks=[{x:a,y:b,timestamp:c}];return!1}}var eZ="$copy_autocapture",e$=((fa={}).GZipJS="gzip-js",fa.Base64="base64",fa),e_=a=>{var b=null==cq?void 0:cq.createElement("a");return cQ(b)?null:(b.href=a,b)},e0=function(a,b){void 0===b&&(b="&");var c,d,e=[];return dZ(a,function(a,b){cQ(a)||cQ(b)||"undefined"===b||(c=encodeURIComponent(a instanceof File?a.name:a.toString()),d=encodeURIComponent(b),e[e.length]=d+"="+c)}),e.join(b)},e1=function(a,b){for(var c,d=((a.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]===b){c=f;break}}if(!cM(c)||c.length<2)return"";var g=c[1];try{g=decodeURIComponent(g)}catch(a){dT.error("Skipping decoding for malformed query param: "+g)}return g.replace(/\+/g," ")},e2=function(a,b,c){if(!a||!b||!b.length)return a;for(var d=a.split("#"),e=d[0]||"",f=d[1],g=e.split("?"),h=g[1],i=g[0],j=(h||"").split("&"),k=[],l=0;l<j.length;l++){var m=j[l].split("=");cM(m)&&(b.includes(m[0])?k.push(m[0]+"="+c):k.push(j[l]))}var n=i;return null!=h&&(n+="?"+k.join("&")),null!=f&&(n+="#"+f),n},e3=function(a,b){var c=a.match(RegExp(b+"=([^&]*)"));return c?c[1]:null},e4=dU("[AutoCapture]");function e5(a,b){return b.length>a?b.slice(0,a)+"...":b}class e6{constructor(a){this.P=!1,this.T=null,this.rageclicks=new eY,this.I=!1,this.instance=a,this.R=null}get C(){var a,b,c=cO(this.instance.config.autocapture)?this.instance.config.autocapture:{};return c.url_allowlist=null==(a=c.url_allowlist)?void 0:a.map(a=>new RegExp(a)),c.url_ignorelist=null==(b=c.url_ignorelist)?void 0:b.map(a=>new RegExp(a)),c}O(){this.isBrowserSupported()||e4.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.P&&(this.O(),this.P=!0)}onRemoteConfig(a){a.elementsChainAsString&&(this.I=a.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[d9]:!!a.autocapture_opt_out}),this.T=!!a.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(a){this.R=a}getElementSelectors(a){var b,c=[];return null==(b=this.R)||b.forEach(b=>{var d=null==cq?void 0:cq.querySelectorAll(b);null==d||d.forEach(d=>{a===d&&c.push(b)})}),c}get isEnabled(){var a,b,c=null==(a=this.instance.persistence)?void 0:a.props[d9];if(cT(this.T)&&!cW(c)&&!this.instance.M())return!1;var d=null!=(b=this.T)?b:!!c;return!!this.instance.config.autocapture&&!d}F(a,b){if(void 0===b&&(b="$autocapture"),this.isEnabled){var c,d=eK(a);eF(d)&&(d=d.parentNode||null),"$autocapture"===b&&"click"===a.type&&a instanceof MouseEvent&&this.instance.config.rageclick&&null!=(c=this.rageclicks)&&c.isRageClick(a.clientX,a.clientY,(new Date).getTime())&&function(a,b){if(!ck||eM(a))return!1}(d,this.instance.config.rageclick)&&this.F(a,"$rageclick");if(d&&function(a,b,c,d,e){if(void 0===c&&(c=void 0),!ck||eM(a))return!1}(d,0,this.C,0,0)){var{props:e,explicitNoCapture:f}=function(a,b){for(var c,d,{e:e,maskAllElementAttributes:f,maskAllText:g,elementAttributeIgnoreList:h,elementsChainAsString:i}=b,j=[a],k=a;k.parentNode&&!eE(k,"body");)(l=k.parentNode)&&11===l.nodeType?(j.push(k.parentNode.host),k=k.parentNode.host):(j.push(k.parentNode),k=k.parentNode);var l,m,n=[],o={},p=!1,q=!1;if(dZ(j,a=>{var b=eN(a);"a"===a.tagName.toLowerCase()&&(p=a.getAttribute("href"),p=b&&p&&eV(p)&&p),cF(eH(a),"ph-no-capture")&&(q=!0),n.push(function(a,b,c,d){var e=a.tagName.toLowerCase(),f={tag_name:e};eL.indexOf(e)>-1&&!c&&("a"===e.toLowerCase()||"button"===e.toLowerCase()?f.$el_text=e5(1024,eW(a)):f.$el_text=e5(1024,eJ(a)));var g=eH(a);g.length>0&&(f.classes=g.filter(function(a){return""!==a})),dZ(a.attributes,function(c){var e;if((!eO(a)||-1!==["name","id","class","aria-label"].indexOf(c.name))&&(null==d||!d.includes(c.name))&&!b&&eV(c.value)&&(!cR(e=c.name)||"_ngcontent"!==e.substring(0,10)&&"_nghost"!==e.substring(0,7))){var g=c.value;"class"===c.name&&(g=eG(g).join(" ")),f["attr__"+c.name]=e5(1024,g)}});for(var h=1,i=1,j=a;j=function(a){if(a.previousElementSibling)return a.previousElementSibling;var b=a;do b=b.previousSibling;while(b&&!eD(b))return b}(j);)h++,j.tagName===a.tagName&&i++;return f.nth_child=h,f.nth_of_type=i,f}(a,f,g,h)),d$(o,function(a){if(!eN(a))return{};var b={};return dZ(a.attributes,function(a){if(a.name&&0===a.name.indexOf("data-ph-capture-attribute")){var c=a.name.replace("data-ph-capture-attribute-",""),d=a.value;c&&d&&eV(d)&&(b[c]=d)}}),b}(a))}),q)return{props:{},explicitNoCapture:q};if(g||("a"===a.tagName.toLowerCase()||"button"===a.tagName.toLowerCase()?n[0].$el_text=eW(a):n[0].$el_text=eJ(a)),p){n[0].attr__href=p;var r,s,t=null==(r=e_(p))?void 0:r.host,u=null==ck||null==(s=ck.location)?void 0:s.host;t&&u&&t!==u&&(m=p)}return{props:d$({$event_type:e.type,$ce_version:1},i?{}:{$elements:n},{$elements_chain:n.map(a=>{var b,c,d,e={text:null==(c=a.$el_text)?void 0:c.slice(0,400),tag_name:a.tag_name,href:null==(d=a.attr__href)?void 0:d.slice(0,2048),attr_class:(b=a.attr__class)?cM(b)?b:eG(b):void 0,attr_id:a.attr__id,nth_child:a.nth_child,nth_of_type:a.nth_of_type,attributes:{}};return d0(a).filter(a=>{var[b]=a;return 0===b.indexOf("attr__")}).forEach(a=>{var[b,c]=a;return e.attributes[b]=c}),e}).map(a=>{var b,c,d="";if(a.tag_name&&(d+=a.tag_name),a.attr_class)for(var e of(a.attr_class.sort(),a.attr_class))d+="."+e.replace(/"/g,"");var f=cA({},a.text?{text:a.text}:{},{"nth-child":null!=(b=a.nth_child)?b:0,"nth-of-type":null!=(c=a.nth_of_type)?c:0},a.href?{href:a.href}:{},a.attr_id?{attr_id:a.attr_id}:{},a.attributes),g={};return d0(f).sort((a,b)=>{var[c]=a,[d]=b;return c.localeCompare(d)}).forEach(a=>{var[b,c]=a;return g[eX(b.toString())]=eX(c.toString())}),d+=":",d+=d0(g).map(a=>{var[b,c]=a;return b+'="'+c+'"'}).join("")}).join(";")},null!=(c=n[0])&&c.$el_text?{$el_text:null==(d=n[0])?void 0:d.$el_text}:{},m&&"click"===e.type?{$external_click_url:m}:{},o)}}(d,{e:a,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.C.element_attribute_ignorelist,elementsChainAsString:this.I});if(f)return!1;var g=this.getElementSelectors(d);if(g&&g.length>0&&(e.$element_selectors=g),b===eZ){var h,i=eI(null==ck||null==(h=ck.getSelection())?void 0:h.toString()),j=a.type||"clipboard";if(!i)return!1;e.$selected_content=i,e.$copy_type=j}return this.instance.capture(b,e),!0}}}isBrowserSupported(){return cN(null==cq?void 0:cq.querySelectorAll)}}Math.trunc||(Math.trunc=function(a){return a<0?Math.ceil(a):Math.floor(a)}),Number.isInteger||(Number.isInteger=function(a){return cV(a)&&isFinite(a)&&Math.floor(a)===a});var e7="0123456789abcdef";class e8{constructor(a){if(this.bytes=a,16!==a.length)throw TypeError("not 128-bit length")}static fromFieldsV7(a,b,c,d){if(!Number.isInteger(a)||!Number.isInteger(b)||!Number.isInteger(c)||!Number.isInteger(d)||a<0||b<0||c<0||d<0||a>0xffffffffffff||b>4095||c>0x3fffffff||d>0xffffffff)throw RangeError("invalid field value");var e=new Uint8Array(16);return e[0]=a/0x10000000000,e[1]=a/0x100000000,e[2]=a/0x1000000,e[3]=a/65536,e[4]=a/256,e[5]=a,e[6]=112|b>>>8,e[7]=b,e[8]=128|c>>>24,e[9]=c>>>16,e[10]=c>>>8,e[11]=c,e[12]=d>>>24,e[13]=d>>>16,e[14]=d>>>8,e[15]=d,new e8(e)}toString(){for(var a="",b=0;b<this.bytes.length;b++)a=a+e7.charAt(this.bytes[b]>>>4)+e7.charAt(15&this.bytes[b]),3!==b&&5!==b&&7!==b&&9!==b||(a+="-");if(36!==a.length)throw Error("Invalid UUIDv7 was generated");return a}clone(){return new e8(this.bytes.slice(0))}equals(a){return 0===this.compareTo(a)}compareTo(a){for(var b=0;b<16;b++){var c=this.bytes[b]-a.bytes[b];if(0!==c)return Math.sign(c)}return 0}}class e9{constructor(){this.A=0,this.D=0,this.j=new fd}generate(){var a=this.generateOrAbort();if(cQ(a)){this.A=0;var b=this.generateOrAbort();if(cQ(b))throw Error("Could not generate UUID after timestamp reset");return b}return a}generateOrAbort(){var a=Date.now();if(a>this.A)this.A=a,this.L();else{if(!(a+1e4>this.A))return;this.D++,this.D>0x3ffffffffff&&(this.A++,this.L())}return e8.fromFieldsV7(this.A,Math.trunc(this.D/0x40000000),0x3fffffff&this.D,this.j.nextUint32())}L(){this.D=1024*this.j.nextUint32()+(1023&this.j.nextUint32())}}var fa,fb,fc=a=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw Error("no cryptographically strong RNG available");for(var b=0;b<a.length;b++)a[b]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return a};ck&&!cQ(ck.crypto)&&crypto.getRandomValues&&(fc=a=>crypto.getRandomValues(a));class fd{constructor(){this.N=new Uint32Array(8),this.U=1/0}nextUint32(){return this.U>=this.N.length&&(fc(this.N),this.U=0),this.N[this.U++]}}var fe=()=>ff().toString(),ff=()=>(fb||(fb=new e9)).generate(),fg="",fh=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i,fi={H:()=>!!cq,B:function(a){dT.error("cookieStore error: "+a)},q:function(a){if(cq){try{for(var b=a+"=",c=cq.cookie.split(";").filter(a=>a.length),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}}catch(a){}return null}},W:function(a){var b;try{b=JSON.parse(fi.q(a))||{}}catch(a){}return b},G:function(a,b,c,d,e){if(cq)try{var f="",g="",h=function(a,b){if(b){var c=function(a,b){if(void 0===b&&(b=cq),fg)return fg;if(!b||["localhost","127.0.0.1"].includes(a))return"";for(var c=a.split("."),d=Math.min(c.length,8),e="dmn_chk_"+fe();!fg&&d--;){var f=c.slice(d).join("."),g=e+"=1;domain=."+f+";path=/";b.cookie=g+";max-age=3",b.cookie.includes(e)&&(b.cookie=g+";max-age=0",fg=f)}return fg}(a);if(!c){var d,e=(d=a.match(fh))?d[0]:"";e!==c&&dT.info("Warning: cookie subdomain discovery mismatch",e,c),c=e}return c?"; domain=."+c:""}return""}(cq.location.hostname,d);if(c){var i=new Date;i.setTime(i.getTime()+24*c*36e5),f="; expires="+i.toUTCString()}e&&(g="; secure");var j=a+"="+encodeURIComponent(JSON.stringify(b))+f+"; SameSite=Lax; path=/"+h+g;return j.length>3686.4&&dT.warn("cookieStore warning: large cookie, len="+j.length),cq.cookie=j,j}catch(a){return}},V:function(a,b){if(null!=cq&&cq.cookie)try{fi.G(a,"",-1,b)}catch(a){return}}},fj=null,fk={H:function(){if(!cT(fj))return fj;var a=!0;return cQ(ck)&&(a=!1),a||dT.error("localStorage unsupported; falling back to cookie store"),fj=a,a},B:function(a){dT.error("localStorage error: "+a)},q:function(a){try{return null==ck?void 0:ck.localStorage.getItem(a)}catch(a){fk.B(a)}return null},W:function(a){try{return JSON.parse(fk.q(a))||{}}catch(a){}return null},G:function(a,b){try{null==ck||ck.localStorage.setItem(a,JSON.stringify(b))}catch(a){fk.B(a)}},V:function(a){try{null==ck||ck.localStorage.removeItem(a)}catch(a){fk.B(a)}}},fl=["distinct_id",ei,ej,ey,ex],fm=cA({},fk,{W:function(a){try{var b={};try{b=fi.W(a)||{}}catch(a){}var c=d$(b,JSON.parse(fk.q(a)||"{}"));return fk.G(a,c),c}catch(a){}return null},G:function(a,b,c,d,e,f){try{fk.G(a,b,void 0,void 0,f);var g={};fl.forEach(a=>{b[a]&&(g[a]=b[a])}),Object.keys(g).length&&fi.G(a,g,c,d,e,f)}catch(a){fk.B(a)}},V:function(a,b){try{null==ck||ck.localStorage.removeItem(a),fi.V(a,b)}catch(a){fk.B(a)}}}),fn={},fo={H:function(){return!0},B:function(a){dT.error("memoryStorage error: "+a)},q:function(a){return fn[a]||null},W:function(a){return fn[a]||null},G:function(a,b){fn[a]=b},V:function(a){delete fn[a]}},fp=null,fq={H:function(){return cT(fp)&&(fp=!0,cQ(ck)&&(fp=!1)),fp},B:function(a){dT.error("sessionStorage error: ",a)},q:function(a){try{return null==ck?void 0:ck.sessionStorage.getItem(a)}catch(a){fq.B(a)}return null},W:function(a){try{return JSON.parse(fq.q(a))||null}catch(a){}return null},G:function(a,b){try{null==ck||ck.sessionStorage.setItem(a,JSON.stringify(b))}catch(a){fq.B(a)}},V:function(a){try{null==ck||ck.sessionStorage.removeItem(a)}catch(a){fq.B(a)}}},fr=((g={})[g.PENDING=-1]="PENDING",g[g.DENIED=0]="DENIED",g[g.GRANTED=1]="GRANTED",g);class fs{constructor(a){this._instance=a}get C(){return this._instance.config}get consent(){return this.J()?fr.DENIED:this.K}isOptedOut(){return"always"===this.C.cookieless_mode||this.consent===fr.DENIED||this.consent===fr.PENDING&&(this.C.opt_out_capturing_by_default||"on_reject"===this.C.cookieless_mode)}isOptedIn(){return!this.isOptedOut()}isExplicitlyOptedOut(){return this.consent===fr.DENIED}optInOut(a){this.Y.G(this.X,+!!a,this.C.cookie_expiration,this.C.cross_subdomain_cookie,this.C.secure_cookie)}reset(){this.Y.V(this.X,this.C.cross_subdomain_cookie)}get X(){var{token:a,opt_out_capturing_cookie_prefix:b,consent_persistence_name:c}=this._instance.config;return c||(b?b+a:"__ph_opt_in_out_"+a)}get K(){var a=this.Y.q(this.X);return cF(c_,a)?fr.GRANTED:cF(c0,a)?fr.DENIED:fr.PENDING}get Y(){if(!this.Z){var a=this.C.opt_out_capturing_persistence_type;this.Z="localStorage"===a?fk:fi;var b="localStorage"===a?fi:fk;b.q(this.X)&&(this.Z.q(this.X)||this.optInOut(cF(c_,b.q(this.X))),b.V(this.X,this.C.cross_subdomain_cookie))}return this.Z}J(){return!!this.C.respect_dnt&&!!d4([null==cp?void 0:cp.doNotTrack,null==cp?void 0:cp.msDoNotTrack,cw.doNotTrack],a=>cF(c_,a))}}var ft=dU("[Dead Clicks]"),fu=()=>!0,fv=a=>{var b,c=!(null==(b=a.instance.persistence)||!b.get_property(ef)),d=a.instance.config.capture_dead_clicks;return cW(d)?d:c};class fw{get lazyLoadedDeadClicksAutocapture(){return this.tt}constructor(a,b,c){this.instance=a,this.isEnabled=b,this.onCapture=c,this.startIfEnabled()}onRemoteConfig(a){this.instance.persistence&&this.instance.persistence.register({[ef]:null==a?void 0:a.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.it(()=>{this.et()})}it(a){var b,c;null!=(b=cw.__PosthogExtensions__)&&b.initDeadClicksAutocapture&&a(),null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this.instance,"dead-clicks-autocapture",b=>{b?ft.error("failed to load script",b):a()})}et(){var a;if(cq){if(!this.tt&&null!=(a=cw.__PosthogExtensions__)&&a.initDeadClicksAutocapture){var b=cO(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};b.__onCapture=this.onCapture,this.tt=cw.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,b),this.tt.start(cq),ft.info("starting...")}}else ft.error("`document` not found. Cannot start.")}stop(){this.tt&&(this.tt.stop(),this.tt=void 0,ft.info("stopping..."))}}var fx=dU("[ExceptionAutocapture]");class fy{constructor(a){var b,c,d;this.rt=()=>{var a;ck&&this.isEnabled&&null!=(a=cw.__PosthogExtensions__)&&a.errorWrappingFunctions},this._instance=a,this.ut=!(null==(b=this._instance.persistence)||!b.props[eb]),this.C=this.ht(),this.dt=new c2({refillRate:null!=(c=this._instance.config.error_tracking.__exceptionRateLimiterRefillRate)?c:1,bucketSize:null!=(d=this._instance.config.error_tracking.__exceptionRateLimiterBucketSize)?d:10,refillInterval:1e4,h:fx}),this.startIfEnabled()}ht(){var a=this._instance.config.capture_exceptions,b={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return cO(a)?b=cA({},b,a):(cQ(a)?this.ut:a)&&(b=cA({},b,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),b}get isEnabled(){return this.C.capture_console_errors||this.C.capture_unhandled_errors||this.C.capture_unhandled_rejections}startIfEnabled(){this.isEnabled&&(fx.info("enabled"),this.it(this.rt))}it(a){var b,c;null!=(b=cw.__PosthogExtensions__)&&b.errorWrappingFunctions&&a(),null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this._instance,"exception-autocapture",b=>{if(b)return fx.error("failed to load script",b);a()})}lt(){var a,b,c;null==(a=this.st)||a.call(this),this.st=void 0,null==(b=this.nt)||b.call(this),this.nt=void 0,null==(c=this.ot)||c.call(this),this.ot=void 0}onRemoteConfig(a){var b=a.autocaptureExceptions;this.ut=!!b,this.C=this.ht(),this._instance.persistence&&this._instance.persistence.register({[eb]:this.ut}),this.startIfEnabled()}captureException(a){var b,c,d=null!=(b=null==a||null==(c=a.$exception_list)||null==(c=c[0])?void 0:c.type)?b:"Exception";this.dt.consumeRateLimit(d)?fx.info("Skipping exception capture because of client rate limiting.",{exception:d}):this._instance.exceptions.sendExceptionEvent(a)}}class fz{constructor(a){var b;this._instance=a,this.vt=(null==ck||null==(b=ck.location)?void 0:b.pathname)||""}get isEnabled(){return"history_change"===this._instance.config.capture_pageview}startIfEnabled(){this.isEnabled&&(dT.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.ct&&this.ct(),this.ct=void 0,dT.info("History API monitoring stopped")}monitorHistoryChanges(){}ft(a){try{var b,c=null==ck||null==(b=ck.location)?void 0:b.pathname;if(!c)return;c!==this.vt&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:a}),this.vt=c}catch(b){dT.error("Error capturing "+a+" pageview",b)}}gt(){if(!this.ct){var a=()=>{this.ft("popstate")};d5(ck,"popstate",a),this.ct=()=>{ck&&ck.removeEventListener("popstate",a)}}}}var fA=dU("[SegmentIntegration]"),fB="posthog-js";function fC(a,b){var{organization:c,projectId:d,prefix:e,severityAllowList:f=["error"],sendExceptionsToPostHog:g=!0}=void 0===b?{}:b;return b=>{if(!("*"===f||f.includes(b.level))||!a.__loaded)return b;b.tags||(b.tags={});var h,i,j,k,l,m=a.requestRouter.endpointFor("ui","/project/"+a.config.token+"/person/"+a.get_distinct_id());b.tags["PostHog Person URL"]=m,a.sessionRecordingStarted()&&(b.tags["PostHog Recording URL"]=a.get_session_replay_url({withTimestamp:!0}));var n=(null==(h=b.exception)?void 0:h.values)||[],o=n.map(a=>cA({},a,{stacktrace:a.stacktrace?cA({},a.stacktrace,{type:"raw",frames:(a.stacktrace.frames||[]).map(a=>cA({},a,{platform:"web:javascript"}))}):void 0})),p={$exception_message:(null==(i=n[0])?void 0:i.value)||b.message,$exception_type:null==(j=n[0])?void 0:j.type,$exception_level:b.level,$exception_list:o,$sentry_event_id:b.event_id,$sentry_exception:b.exception,$sentry_exception_message:(null==(k=n[0])?void 0:k.value)||b.message,$sentry_exception_type:null==(l=n[0])?void 0:l.type,$sentry_tags:b.tags};return c&&d&&(p.$sentry_url=(e||"https://sentry.io/organizations/")+c+"/issues/?project="+d+"&query="+b.event_id),g&&a.exceptions.sendExceptionEvent(p),b}}class fD{constructor(a,b,c,d,e,f){this.name=fB,this.setupOnce=function(g){g(fC(a,{organization:b,projectId:c,prefix:d,severityAllowList:e,sendExceptionsToPostHog:null==f||f}))}}}null!=ck&&ck.location&&(e3(ck.location.hash,"__posthog")||e3(location.hash,"state"));var fE=dU("[Toolbar]"),fF=((h=fF||{})[h.UNINITIALIZED=0]="UNINITIALIZED",h[h.LOADING=1]="LOADING",h[h.LOADED=2]="LOADED",h);class fG{constructor(a){this.instance=a}_t(a){cw.ph_toolbar_state=a}yt(){var a;return null!=(a=cw.ph_toolbar_state)?a:fF.UNINITIALIZED}maybeLoadToolbar(a,b,c){return!1}bt(a){var b=cw.ph_load_toolbar||cw.ph_load_editor;!cU(b)&&cN(b)?b(a,this.instance):fE.warn("No toolbar load function found")}loadToolbar(a){return null!=cq&&cq.getElementById(ez),!1}wt(a){return this.loadToolbar(a)}maybeLoadEditor(a,b,c){return void 0===a&&(a=void 0),void 0===b&&(b=void 0),void 0===c&&(c=void 0),this.maybeLoadToolbar(a,b,c)}}var fH=dU("[TracingHeaders]");class fI{constructor(a){this.xt=void 0,this.$t=void 0,this.rt=()=>{var a,b;cQ(this.xt)&&(null==(a=cw.__PosthogExtensions__)||null==(a=a.tracingHeadersPatchFns)||a._patchXHR(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager)),cQ(this.$t)&&(null==(b=cw.__PosthogExtensions__)||null==(b=b.tracingHeadersPatchFns)||b._patchFetch(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager))},this._instance=a}it(a){var b,c;null!=(b=cw.__PosthogExtensions__)&&b.tracingHeadersPatchFns&&a(),null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this._instance,"tracing-headers",b=>{if(b)return fH.error("failed to load script",b);a()})}startIfEnabledOrStop(){var a,b;this._instance.config.__add_tracing_headers?this.it(this.rt):(null==(a=this.xt)||a.call(this),null==(b=this.$t)||b.call(this),this.xt=void 0,this.$t=void 0)}}var fJ="Mobile",fK="Android",fL="Tablet",fM=fK+" "+fL,fN="iPad",fO="Apple",fP=fO+" Watch",fQ="Safari",fR="BlackBerry",fS="Samsung",fT=fS+"Browser",fU=fS+" Internet",fV="Chrome",fW=fV+" OS",fX=fV+" iOS",fY="Internet Explorer",fZ=fY+" "+fJ,f$="Opera",f_=f$+" Mini",f0="Edge",f1="Microsoft "+f0,f2="Firefox",f3=f2+" iOS",f4="Nintendo",f5="PlayStation",f6="Xbox",f7=fK+" "+fJ,f8=fJ+" "+fQ,f9="Windows",ga=f9+" Phone",gb="Nokia",gc="Ouya",gd="Generic",ge=gd+" "+fJ.toLowerCase(),gf=gd+" "+fL.toLowerCase(),gg="Konqueror",gh="(\\d+(\\.\\d+)?)",gi=RegExp("Version/"+gh),gj=RegExp(f6,"i"),gk=RegExp(f5+" \\w+","i"),gl=RegExp(f4+" \\w+","i"),gm=RegExp(fR+"|PlayBook|BB10","i"),gn={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},go=function(a,b){var c;return b=b||"",cF(a," OPR/")&&cF(a,"Mini")?f_:cF(a," OPR/")?f$:gm.test(a)?fR:cF(a,"IE"+fJ)||cF(a,"WPDesktop")?fZ:cF(a,fT)?fU:cF(a,f0)||cF(a,"Edg/")?f1:cF(a,"FBIOS")?"Facebook "+fJ:cF(a,"UCWEB")||cF(a,"UCBrowser")?"UC Browser":cF(a,"CriOS")?fX:cF(a,"CrMo")||cF(a,fV)?fV:cF(a,fK)&&cF(a,fQ)?f7:cF(a,"FxiOS")?f3:cF(a.toLowerCase(),gg.toLowerCase())?gg:(c=b)&&cF(c,fO)||cF(a,fQ)&&!cF(a,fV)&&!cF(a,fK)?cF(a,fJ)?f8:fQ:cF(a,f2)?f2:cF(a,"MSIE")||cF(a,"Trident/")?fY:cF(a,"Gecko")?f2:""},gp={[fZ]:[RegExp("rv:"+gh)],[f1]:[RegExp(f0+"?\\/"+gh)],[fV]:[RegExp("("+fV+"|CrMo)\\/"+gh)],[fX]:[RegExp("CriOS\\/"+gh)],"UC Browser":[RegExp("(UCBrowser|UCWEB)\\/"+gh)],[fQ]:[gi],[f8]:[gi],[f$]:[RegExp("(Opera|OPR)\\/"+gh)],[f2]:[RegExp(f2+"\\/"+gh)],[f3]:[RegExp("FxiOS\\/"+gh)],[gg]:[RegExp("Konqueror[:/]?"+gh,"i")],[fR]:[RegExp(fR+" "+gh),gi],[f7]:[RegExp("android\\s"+gh,"i")],[fU]:[RegExp(fT+"\\/"+gh)],[fY]:[RegExp("(rv:|MSIE )"+gh)],Mozilla:[RegExp("rv:"+gh)]},gq=function(a,b){var c=gp[go(a,b)];if(cQ(c))return null;for(var d=0;d<c.length;d++){var e=c[d],f=a.match(e);if(f)return parseFloat(f[f.length-2])}return null},gr=[[RegExp(f6+"; "+f6+" (.*?)[);]","i"),a=>[f6,a&&a[1]||""]],[RegExp(f4,"i"),[f4,""]],[RegExp(f5,"i"),[f5,""]],[gm,[fR,""]],[RegExp(f9,"i"),(a,b)=>{if(/Phone/.test(b)||/WPDesktop/.test(b))return[ga,""];if(new RegExp(fJ).test(b)&&!/IEMobile\b/.test(b))return[f9+" "+fJ,""];var c=/Windows NT ([0-9.]+)/i.exec(b);if(c&&c[1]){var d=gn[c[1]]||"";return/arm/i.test(b)&&(d="RT"),[f9,d]}return[f9,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,a=>a&&a[3]?["iOS",[a[3],a[4],a[5]||"0"].join(".")]:["iOS",""]],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,a=>{var b="";return a&&a.length>=3&&(b=cQ(a[2])?a[3]:a[2]),["watchOS",b]}],[RegExp("("+fK+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+fK+")","i"),a=>a&&a[2]?[fK,[a[2],a[3],a[4]||"0"].join(".")]:[fK,""]],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,a=>{var b=["Mac OS X",""];if(a&&a[1]){var c=[a[1],a[2],a[3]||"0"];b[1]=c.join(".")}return b}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[fW,""]],[/Linux|debian/i,["Linux",""]]],gs=function(a){return gl.test(a)?f4:gk.test(a)?f5:gj.test(a)?f6:RegExp(gc,"i").test(a)?gc:RegExp("("+ga+"|WPDesktop)","i").test(a)?ga:/iPad/.test(a)?fN:/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(a)?fP:gm.test(a)?fR:/(kobo)\s(ereader|touch)/i.test(a)?"Kobo":RegExp(gb,"i").test(a)?gb:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(a)||/(kf[a-z]+)( bui|\)).+silk\//i.test(a)?"Kindle Fire":/(Android|ZTE)/i.test(a)?!new RegExp(fJ).test(a)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(a)?/pixel[\daxl ]{1,6}/i.test(a)&&!/pixel c/i.test(a)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(a)||/lmy47v/i.test(a)&&!/QTAQZ3/i.test(a)?fK:fM:fK:RegExp("(pda|"+fJ+")","i").test(a)?ge:RegExp(fL,"i").test(a)&&!RegExp(fL+" pc","i").test(a)?gf:""},gt="https?://(.*)",gu=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],gv=d_(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],gu),gw="<masked>",gx=["li_fat_id"];function gy(a,b,c){if(!cq)return{};var d,e=b?d_([],gu,c||[]):[],f=gz(e2(cq.URL,e,gw),a);return d$((d={},dZ(gx,function(a){var b=fi.q(a);d[a]=b||null}),d),f)}function gz(a,b){var c=gv.concat(b||[]),d={};return dZ(c,function(b){var c=e1(a,b);d[b]=c||null}),d}function gA(a){var b=a?0===a.search(gt+"google.([^/?]*)")?"google":0===a.search(gt+"bing.com")?"bing":0===a.search(gt+"yahoo.com")?"yahoo":0===a.search(gt+"duckduckgo.com")?"duckduckgo":null:null,c={};if(!cT(b)){c.$search_engine=b;var d=cq?e1(cq.referrer,"yahoo"!=b?"q":"p"):"";d.length&&(c.ph_keyword=d)}return c}function gB(){return navigator.language||navigator.userLanguage}function gC(){return(null==cq?void 0:cq.referrer)||"$direct"}function gD(a,b){var c=a?d_([],gu,b||[]):[],d=null==cr?void 0:cr.href.substring(0,1e3);return{r:gC().substring(0,1e3),u:d?e2(d,c,gw):void 0}}function gE(a){var b,{r:c,u:d}=a,e={$referrer:c,$referring_domain:null==c?void 0:"$direct"==c?"$direct":null==(b=e_(c))?void 0:b.host};if(d){e.$current_url=d;var f=e_(d);e.$host=null==f?void 0:f.host,e.$pathname=null==f?void 0:f.pathname,d$(e,gz(d))}return c&&d$(e,gA(c)),e}function gF(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(a){return}}var gG=dU("[Web Vitals]");class gH{constructor(a){var b;this.St=!1,this.P=!1,this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.Et=()=>{clearTimeout(this.kt),0!==this.N.metrics.length&&(this._instance.capture("$web_vitals",this.N.metrics.reduce((a,b)=>cA({},a,{["$web_vitals_"+b.name+"_event"]:cA({},b),["$web_vitals_"+b.name+"_value"]:b.value}),{})),this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.Pt=a=>{var b,c=null==(b=this._instance.sessionManager)?void 0:b.checkAndGetSessionAndWindowId(!0);if(cQ(c))gG.error("Could not read session ID. Dropping metrics!");else{this.N=this.N||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var d=this.Tt();cQ(d)||(cU(null==a?void 0:a.name)||cU(null==a?void 0:a.value)?gG.error("Invalid metric received",a):this.It&&a.value>=this.It?gG.error("Ignoring metric with value >= "+this.It,a):(this.N.url!==d&&(this.Et(),this.kt=setTimeout(this.Et,this.flushToCaptureTimeoutMs)),cQ(this.N.url)&&(this.N.url=d),this.N.firstMetricTimestamp=cQ(this.N.firstMetricTimestamp)?Date.now():this.N.firstMetricTimestamp,a.attribution&&a.attribution.interactionTargetElement&&(a.attribution.interactionTargetElement=void 0),this.N.metrics.push(cA({},a,{$current_url:d,$session_id:c.sessionId,$window_id:c.windowId,timestamp:Date.now()})),this.N.metrics.length===this.allowedMetrics.length&&this.Et()))}},this.rt=()=>{var a,b,c,d,e=cw.__PosthogExtensions__;cQ(e)||cQ(e.postHogWebVitalsCallbacks)||({onLCP:a,onCLS:b,onFCP:c,onINP:d}=e.postHogWebVitalsCallbacks),a&&b&&c&&d?(this.allowedMetrics.indexOf("LCP")>-1&&a(this.Pt.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&b(this.Pt.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&c(this.Pt.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&d(this.Pt.bind(this)),this.P=!0):gG.error("web vitals callbacks not loaded - not starting")},this._instance=a,this.St=!(null==(b=this._instance.persistence)||!b.props[ee]),this.startIfEnabled()}get allowedMetrics(){var a,b,c=cO(this._instance.config.capture_performance)?null==(a=this._instance.config.capture_performance)?void 0:a.web_vitals_allowed_metrics:void 0;return cQ(c)?(null==(b=this._instance.persistence)?void 0:b.props[eg])||["CLS","FCP","INP","LCP"]:c}get flushToCaptureTimeoutMs(){return(cO(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get It(){var a=cO(this._instance.config.capture_performance)&&cV(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:9e5;return 0<a&&a<=6e4?9e5:a}get isEnabled(){var a=null==cr?void 0:cr.protocol;if("http:"!==a&&"https:"!==a)return gG.info("Web Vitals are disabled on non-http/https protocols"),!1;var b=cO(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:cW(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return cW(b)?b:this.St}startIfEnabled(){this.isEnabled&&!this.P&&(gG.info("enabled, starting..."),this.it(this.rt))}onRemoteConfig(a){var b=cO(a.capturePerformance)&&!!a.capturePerformance.web_vitals,c=cO(a.capturePerformance)?a.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[ee]:b}),this._instance.persistence.register({[eg]:c})),this.St=b,this.startIfEnabled()}it(a){var b,c;null!=(b=cw.__PosthogExtensions__)&&b.postHogWebVitalsCallbacks&&a(),null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this._instance,"web-vitals",b=>{b?gG.error("failed to load script",b):a()})}Tt(){gG.error("Could not determine current URL")}}var gI=dU("[Heatmaps]");function gJ(a){return cO(a)&&"clientX"in a&&"clientY"in a&&cV(a.clientX)&&cV(a.clientY)}class gK{constructor(a){var b;this.rageclicks=new eY,this.St=!1,this.P=!1,this.Rt=null,this.instance=a,this.St=!(null==(b=this.instance.persistence)||!b.props[ea])}get flushIntervalMilliseconds(){var a=5e3;return cO(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(a=this.instance.config.capture_heatmaps.flush_interval_milliseconds),a}get isEnabled(){return cQ(this.instance.config.capture_heatmaps)?cQ(this.instance.config.enable_heatmaps)?this.St:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}startIfEnabled(){if(this.isEnabled)this.P||(gI.info("starting..."),this.Ct(),this.Ot());else{var a;clearInterval(null!=(a=this.Rt)?a:void 0),this.Ft(),this.getAndClearBuffer()}}onRemoteConfig(a){var b=!!a.heatmaps;this.instance.persistence&&this.instance.persistence.register({[ea]:b}),this.St=b,this.startIfEnabled()}getAndClearBuffer(){var a=this.N;return this.N=void 0,a}Mt(a){this.At(a.originalEvent,"deadclick")}Ot(){this.Rt&&clearInterval(this.Rt),this.Rt="visible"===(null==cq?void 0:cq.visibilityState)?setInterval(this.Dt.bind(this),this.flushIntervalMilliseconds):null}Ct(){ck&&cq&&(this.jt=this.Dt.bind(this),d5(ck,"beforeunload",this.jt),this.Lt=a=>this.At(a||(null==ck?void 0:ck.event)),d5(cq,"click",this.Lt,{capture:!0}),this.Nt=a=>this.Ut(a||(null==ck?void 0:ck.event)),d5(cq,"mousemove",this.Nt,{capture:!0}),this.zt=new fw(this.instance,fu,this.Mt.bind(this)),this.zt.startIfEnabled(),this.Ht=this.Ot.bind(this),d5(cq,"visibilitychange",this.Ht),this.P=!0)}Ft(){var a;ck&&cq&&(this.jt&&ck.removeEventListener("beforeunload",this.jt),this.Lt&&cq.removeEventListener("click",this.Lt,{capture:!0}),this.Nt&&cq.removeEventListener("mousemove",this.Nt,{capture:!0}),this.Ht&&cq.removeEventListener("visibilitychange",this.Ht),clearTimeout(this.Bt),null==(a=this.zt)||a.stop(),this.P=!1)}qt(a,b){var c=this.instance.scrollManager.scrollY(),d=this.instance.scrollManager.scrollX(),e=this.instance.scrollManager.scrollElement(),f=function(a,b,c){for(var d=a;d&&eD(d)&&!eE(d,"body")&&d!==c;){if(cF(b,null==ck?void 0:ck.getComputedStyle(d).position))return!0;d=function(a){var b=a.parentNode;return!(!b||!eD(b))&&b}(d)}return!1}(eK(a),["fixed","sticky"],e);return{x:a.clientX+(f?0:d),y:a.clientY+(f?0:c),target_fixed:f,type:b}}At(a,b){var c;if(void 0===b&&(b="click"),!eC(a.target)&&gJ(a)){var d=this.qt(a,b);null!=(c=this.rageclicks)&&c.isRageClick(a.clientX,a.clientY,(new Date).getTime())&&this.Wt(cA({},d,{type:"rageclick"})),this.Wt(d)}}Ut(a){!eC(a.target)&&gJ(a)&&(clearTimeout(this.Bt),this.Bt=setTimeout(()=>{this.Wt(this.qt(a,"mousemove"))},500))}Wt(a){}Dt(){this.N&&!cP(this.N)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class gL{constructor(a){this._instance=a}doPageView(a,b){var c,d=this.Gt(a,b);return this.Vt={pathname:null!=(c=null==ck?void 0:ck.location.pathname)?c:"",pageViewId:b,timestamp:a},this._instance.scrollManager.resetContext(),d}doPageLeave(a){var b;return this.Gt(a,null==(b=this.Vt)?void 0:b.pageViewId)}doEvent(){var a;return{$pageview_id:null==(a=this.Vt)?void 0:a.pageViewId}}Gt(a,b){var c=this.Vt;if(!c)return{$pageview_id:b};var d={$pageview_id:b,$prev_pageview_id:c.pageViewId},e=this._instance.scrollManager.getContext();if(e&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:f,lastScrollY:g,maxScrollY:h,maxContentHeight:i,lastContentY:j,maxContentY:k}=e;if(!(cQ(f)||cQ(g)||cQ(h)||cQ(i)||cQ(j)||cQ(k))){f=Math.ceil(f),g=Math.ceil(g),h=Math.ceil(h),i=Math.ceil(i),j=Math.ceil(j),k=Math.ceil(k);var l=f<=1?1:c1(g/f,0,1,dT),m=f<=1?1:c1(h/f,0,1,dT),n=i<=1?1:c1(j/i,0,1,dT),o=i<=1?1:c1(k/i,0,1,dT);d=d$(d,{$prev_pageview_last_scroll:g,$prev_pageview_last_scroll_percentage:l,$prev_pageview_max_scroll:h,$prev_pageview_max_scroll_percentage:m,$prev_pageview_last_content:j,$prev_pageview_last_content_percentage:n,$prev_pageview_max_content:k,$prev_pageview_max_content_percentage:o})}}return c.pathname&&(d.$prev_pageview_pathname=c.pathname),c.timestamp&&(d.$prev_pageview_duration=(a.getTime()-c.timestamp.getTime())/1e3),d}}var gM=Uint8Array,gN=Uint16Array,gO=Uint32Array,gP=new gM([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gQ=new gM([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gR=new gM([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gS=function(a,b){for(var c=new gN(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];var e=new gO(c[30]);for(d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return[c,e]},gT=gS(gP,2),gU=gT[0],gV=gT[1];gU[28]=258,gV[258]=28;for(var gW=gS(gQ,0)[1],gX=new gN(32768),gY=0;gY<32768;++gY){var gZ=(43690&gY)>>>1|(21845&gY)<<1;gZ=(61680&(gZ=(52428&gZ)>>>2|(13107&gZ)<<2))>>>4|(3855&gZ)<<4,gX[gY]=((65280&gZ)>>>8|(255&gZ)<<8)>>>1}var g$=function(a,b,c){for(var d=a.length,e=0,f=new gN(b);e<d;++e)++f[a[e]-1];var g,h=new gN(b);for(e=0;e<b;++e)h[e]=h[e-1]+f[e-1]<<1;if(c){g=new gN(1<<b);var i=15-b;for(e=0;e<d;++e)if(a[e])for(var j=e<<4|a[e],k=b-a[e],l=h[a[e]-1]++<<k,m=l|(1<<k)-1;l<=m;++l)g[gX[l]>>>i]=j}else for(g=new gN(d),e=0;e<d;++e)g[e]=gX[h[a[e]-1]++]>>>15-a[e];return g},g_=new gM(288);for(gY=0;gY<144;++gY)g_[gY]=8;for(gY=144;gY<256;++gY)g_[gY]=9;for(gY=256;gY<280;++gY)g_[gY]=7;for(gY=280;gY<288;++gY)g_[gY]=8;var g0=new gM(32);for(gY=0;gY<32;++gY)g0[gY]=5;var g1=g$(g_,9,0),g2=g$(g0,5,0),g3=function(a){return(a/8|0)+(7&a&&1)},g4=function(a,b,c){(null==c||c>a.length)&&(c=a.length);var d=new(a instanceof gN?gN:a instanceof gO?gO:gM)(c-b);return d.set(a.subarray(b,c)),d},g5=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8},g6=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8,a[d+2]|=c>>>16},g7=function(a,b){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var e=c.length,f=c.slice();if(!e)return[new gM(0),0];if(1==e){var g=new gM(c[0].s+1);return g[c[0].s]=1,[g,1]}c.sort(function(a,b){return a.f-b.f}),c.push({s:-1,f:25001});var h=c[0],i=c[1],j=0,k=1,l=2;for(c[0]={s:-1,f:h.f+i.f,l:h,r:i};k!=e-1;)h=c[c[j].f<c[l].f?j++:l++],i=c[j!=k&&c[j].f<c[l].f?j++:l++],c[k++]={s:-1,f:h.f+i.f,l:h,r:i};var m=f[0].s;for(d=1;d<e;++d)f[d].s>m&&(m=f[d].s);var n=new gN(m+1),o=g8(c[k-1],n,0);if(o>b){d=0;var p=0,q=o-b,r=1<<q;for(f.sort(function(a,b){return n[b.s]-n[a.s]||a.f-b.f});d<e;++d){var s=f[d].s;if(!(n[s]>b))break;p+=r-(1<<o-n[s]),n[s]=b}for(p>>>=q;p>0;){var t=f[d].s;n[t]<b?p-=1<<b-n[t]++-1:++d}for(;d>=0&&p;--d){var u=f[d].s;n[u]==b&&(--n[u],++p)}o=b}return[new gM(n),o]},g8=function(a,b,c){return -1==a.s?Math.max(g8(a.l,b,c+1),g8(a.r,b,c+1)):b[a.s]=c},g9=function(a){for(var b=a.length;b&&!a[--b];);for(var c=new gN(++b),d=0,e=a[0],f=1,g=function(a){c[d++]=a},h=1;h<=b;++h)if(a[h]==e&&h!=b)++f;else{if(!e&&f>2){for(;f>138;f-=138)g(32754);f>2&&(g(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(g(e),--f;f>6;f-=6)g(8304);f>2&&(g(f-3<<5|8208),f=0)}for(;f--;)g(e);f=1,e=a[h]}return[c.subarray(0,d),b]},ha=function(a,b){for(var c=0,d=0;d<b.length;++d)c+=a[d]*b[d];return c},hb=function(a,b,c){var d=c.length,e=g3(b+2);a[e]=255&d,a[e+1]=d>>>8,a[e+2]=255^a[e],a[e+3]=255^a[e+1];for(var f=0;f<d;++f)a[e+f+4]=c[f];return 8*(e+4+d)},hc=function(a,b,c,d,e,f,g,h,i,j,k){g5(b,k++,c),++e[256];for(var l=g7(e,15),m=l[0],n=l[1],o=g7(f,15),p=o[0],q=o[1],r=g9(m),s=r[0],t=r[1],u=g9(p),v=u[0],w=u[1],x=new gN(19),y=0;y<s.length;++y)x[31&s[y]]++;for(y=0;y<v.length;++y)x[31&v[y]]++;for(var z=g7(x,7),A=z[0],B=z[1],C=19;C>4&&!A[gR[C-1]];--C);var D,E,F,G,H=j+5<<3,I=ha(e,g_)+ha(f,g0)+g,J=ha(e,m)+ha(f,p)+g+14+3*C+ha(x,A)+(2*x[16]+3*x[17]+7*x[18]);if(H<=I&&H<=J)return hb(b,k,a.subarray(i,i+j));if(g5(b,k,1+(J<I)),k+=2,J<I){D=g$(m,n,0),E=m,F=g$(p,q,0),G=p;var K=g$(A,B,0);for(g5(b,k,t-257),g5(b,k+5,w-1),g5(b,k+10,C-4),k+=14,y=0;y<C;++y)g5(b,k+3*y,A[gR[y]]);k+=3*C;for(var L=[s,v],M=0;M<2;++M){var N=L[M];for(y=0;y<N.length;++y){var O=31&N[y];g5(b,k,K[O]),k+=A[O],O>15&&(g5(b,k,N[y]>>>5&127),k+=N[y]>>>12)}}}else D=g1,E=g_,F=g2,G=g0;for(y=0;y<h;++y)if(d[y]>255){g6(b,k,D[(O=d[y]>>>18&31)+257]),k+=E[O+257],O>7&&(g5(b,k,d[y]>>>23&31),k+=gP[O]);var P=31&d[y];g6(b,k,F[P]),k+=G[P],P>3&&(g6(b,k,d[y]>>>5&8191),k+=gQ[P])}else g6(b,k,D[d[y]]),k+=E[d[y]];return g6(b,k,D[256]),k+E[256]},hd=new gO([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),he=function(){for(var a=new gO(256),b=0;b<256;++b){for(var c=b,d=9;--d;)c=(1&c&&0xedb88320)^c>>>1;a[b]=c}return a}(),hf=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},hg=function(a){var b,c,d,e,f="";for(b=c=0,d=(a=(a+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,e=0;e<d;e++){var g=a.charCodeAt(e),h=null;g<128?c++:h=g>127&&g<2048?String.fromCharCode(g>>6|192,63&g|128):String.fromCharCode(g>>12|224,g>>6&63|128,63&g|128),cT(h)||(c>b&&(f+=a.substring(b,c)),f+=h,b=c=e+1)}return c>b&&(f+=a.substring(b,a.length)),f},hh=!!ct||!!cs,hi="text/plain",hj=function(a,b,c){void 0===c&&(c=!0);var d,[e,f]=a.split("?"),g=cA({},b),h=null!=(d=null==f?void 0:f.split("&").map(a=>{var b,[d,e]=a.split("="),f=c&&null!=(b=g[d])?b:e;return delete g[d],d+"="+f}))?d:[],i=e0(g);return i&&h.push(i),e+"?"+h.join("&")},hk=(a,b)=>JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString():b,b),hl=a=>{var{data:b,compression:c}=a;if(b){if(c===e$.GZipJS){var d,e,f,g,h,i,j,k,l=new Blob([(d=function(a,b){var c=a.length;if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(a);for(var d=new gM(a.length+(a.length>>>1)),e=0,f=function(a){d[e++]=a},g=0;g<c;++g){if(e+5>d.length){var h=new gM(e+8+(c-g<<1));h.set(d),d=h}var i=a.charCodeAt(g);i<128?f(i):(i<2048?f(192|i>>>6):(i>55295&&i<57344?(f(240|(i=65536+(1047552&i)|1023&a.charCodeAt(++g))>>>18),f(128|i>>>12&63)):f(224|i>>>12),f(128|i>>>6&63)),f(128|63&i))}return g4(d,0,e)}(hk(b)),e={mtime:0},f=0xffffffff,g={p:function(a){for(var b=f,c=0;c<a.length;++c)b=he[255&b^a[c]]^b>>>8;f=b},d:function(){return 0xffffffff^f}},h=d.length,g.p(d),k=(i=10+(e.filename&&e.filename.length+1||0),j=function(a,b,c,d,e,f){var g=a.length,h=new gM(d+g+5*(1+Math.floor(g/7e3))+8),i=h.subarray(d,h.length-8),j=0;if(!b||g<8)for(var k=0;k<=g;k+=65535){var l=k+65535;l<g?j=hb(i,j,a.subarray(k,l)):(i[k]=f,j=hb(i,j,a.subarray(k,g)))}else{for(var m=hd[b-1],n=m>>>13,o=8191&m,p=(1<<c)-1,q=new gN(32768),r=new gN(p+1),s=Math.ceil(c/3),t=2*s,u=function(b){return(a[b]^a[b+1]<<s^a[b+2]<<t)&p},v=new gO(25e3),w=new gN(288),x=new gN(32),y=0,z=0,A=(k=0,0),B=0,C=0;k<g;++k){var D=u(k),E=32767&k,F=r[D];if(q[E]=F,r[D]=E,B<=k){var G=g-k;if((y>7e3||A>24576)&&G>423){j=hc(a,i,0,v,w,x,z,A,C,k-C,j),A=y=z=0,C=k;for(var H=0;H<286;++H)w[H]=0;for(H=0;H<30;++H)x[H]=0}var I=2,J=0,K=o,L=E-F&32767;if(G>2&&D==u(k-L))for(var M=Math.min(n,G)-1,N=Math.min(32767,k),O=Math.min(258,G);L<=N&&--K&&E!=F;){if(a[k+I]==a[k+I-L]){for(var P=0;P<O&&a[k+P]==a[k+P-L];++P);if(P>I){if(I=P,J=L,P>M)break;var Q=Math.min(L,P-2),R=0;for(H=0;H<Q;++H){var S=k-L+H+32768&32767,T=S-q[S]+32768&32767;T>R&&(R=T,F=S)}}}L+=(E=F)-(F=q[E])+32768&32767}if(J){v[A++]=0x10000000|gV[I]<<18|gW[J];var U=31&gV[I],V=31&gW[J];z+=gP[U]+gQ[V],++w[257+U],++x[V],B=k+I,++y}else v[A++]=a[k],++w[a[k]]}}j=hc(a,i,f,v,w,x,z,A,C,k-C,j)}return g4(h,0,d+g3(j)+8)}(d,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(d.length)))):12+e.mem,i,8,!0)).length,function(a,b){var c=b.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:2*(9==b.level),a[9]=3,0!=b.mtime&&hf(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3)),c){a[3]=8;for(var d=0;d<=c.length;++d)a[d+10]=c.charCodeAt(d)}}(j,e),hf(j,k-8,g.d()),hf(j,k-4,h),j)],{type:hi});return{contentType:hi,body:l,estimatedSize:l.size}}if(c===e$.Base64){let a;var m="data="+encodeURIComponent("string"==typeof(a=function(a){var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,i=0,j="",k=[];if(!a)return a;a=hg(a);do b=(f=a.charCodeAt(h++)<<16|a.charCodeAt(h++)<<8|a.charCodeAt(h++))>>18&63,c=f>>12&63,d=f>>6&63,e=63&f,k[i++]=g.charAt(b)+g.charAt(c)+g.charAt(d)+g.charAt(e);while(h<a.length)switch(j=k.join(""),a.length%3){case 1:j=j.slice(0,-2)+"==";break;case 2:j=j.slice(0,-1)+"="}return j}(hk(b)))?a:hk(a));return{contentType:"application/x-www-form-urlencoded",body:m,estimatedSize:new Blob([m]).size}}var n=hk(b);return{contentType:"application/json",body:n,estimatedSize:new Blob([n]).size}}},hm=[];cs&&hm.push({transport:"fetch",method:a=>{var b,c,{contentType:d,body:e,estimatedSize:f}=null!=(b=hl(a))?b:{},g=new Headers;dZ(a.headers,function(a,b){g.append(b,a)}),d&&g.append("Content-Type",d);var h=a.url,i=null;if(cu){var j=new cu;i={signal:j.signal,timeout:setTimeout(()=>j.abort(),a.timeout)}}cs(h,cA({method:(null==a?void 0:a.method)||"GET",headers:g,keepalive:"POST"===a.method&&52428.8>(f||0),body:e,signal:null==(c=i)?void 0:c.signal},a.fetchOptions)).then(b=>b.text().then(c=>{var d={statusCode:b.status,text:c};if(200===b.status)try{d.json=JSON.parse(c)}catch(a){dT.error(a)}null==a.callback||a.callback(d)})).catch(b=>{dT.error(b),null==a.callback||a.callback({statusCode:0,text:b})}).finally(()=>i?clearTimeout(i.timeout):null)}}),ct&&hm.push({transport:"XHR",method:a=>{var b,c=new ct;c.open(a.method||"GET",a.url,!0);var{contentType:d,body:e}=null!=(b=hl(a))?b:{};dZ(a.headers,function(a,b){c.setRequestHeader(b,a)}),d&&c.setRequestHeader("Content-Type",d),a.timeout&&(c.timeout=a.timeout),a.disableXHRCredentials||(c.withCredentials=!0),c.onreadystatechange=()=>{if(4===c.readyState){var b={statusCode:c.status,text:c.responseText};if(200===c.status)try{b.json=JSON.parse(c.responseText)}catch(a){}null==a.callback||a.callback(b)}},c.send(e)}}),null!=cp&&cp.sendBeacon&&hm.push({transport:"sendBeacon",method:a=>{var b=hj(a.url,{beacon:"1"});try{var c,{contentType:d,body:e}=null!=(c=hl(a))?c:{},f="string"==typeof e?new Blob([e],{type:d}):e;cp.sendBeacon(b,f)}catch(a){}}});var hn=function(a,b){if(!function(a){try{new RegExp(a)}catch(a){return!1}return!0}(b))return!1;try{return new RegExp(b).test(a)}catch(a){return!1}};function ho(a,b,c){return hk({distinct_id:a,userPropertiesToSet:b,userPropertiesToSetOnce:c})}var hp={exact:(a,b)=>b.some(b=>a.some(a=>b===a)),is_not:(a,b)=>b.every(b=>a.every(a=>b!==a)),regex:(a,b)=>b.some(b=>a.some(a=>hn(b,a))),not_regex:(a,b)=>b.every(b=>a.every(a=>!hn(b,a))),icontains:(a,b)=>b.map(hq).some(b=>a.map(hq).some(a=>b.includes(a))),not_icontains:(a,b)=>b.map(hq).every(b=>a.map(hq).every(a=>!b.includes(a)))},hq=a=>a.toLowerCase(),hr=dU("[Error tracking]");class hs{constructor(a){var b,c;this.Jt=[],this.Kt=new dG([new dH,new dR,new dJ,new dI,new dP,new dO,new dL,new dQ],[dB,dE]),this._instance=a,this.Jt=null!=(b=null==(c=this._instance.persistence)?void 0:c.get_property(ec))?b:[]}onRemoteConfig(a){var b,c,d,e=null!=(b=null==(c=a.errorTracking)?void 0:c.suppressionRules)?b:[],f=null==(d=a.errorTracking)?void 0:d.captureExtensionExceptions;this.Jt=e,this._instance.persistence&&this._instance.persistence.register({[ec]:this.Jt,[ed]:f})}get Yt(){var a,b=!!this._instance.get_property(ed),c=this._instance.config.error_tracking.captureExtensionExceptions;return null!=(a=null!=c?c:b)&&a}buildProperties(a,b){return this.Kt.buildFromUnknown(a,{syntheticException:null==b?void 0:b.syntheticException,mechanism:{handled:null==b?void 0:b.handled}})}sendExceptionEvent(a){var b=a.$exception_list;if(this.Xt(b)){if(this.Qt(b))return void hr.info("Skipping exception capture because a suppression rule matched");if(!this.Yt&&this.Zt(b))return void hr.info("Skipping exception capture because it was thrown by an extension");if(!this._instance.config.error_tracking.__capturePostHogExceptions&&this.ti(b))return void hr.info("Skipping exception capture because it was thrown by the PostHog SDK")}return this._instance.capture("$exception",a,{_noTruncate:!0,_batchKey:"exceptionEvent"})}Qt(a){if(0===a.length)return!1;var b=a.reduce((a,b)=>{var{type:c,value:d}=b;return cR(c)&&c.length>0&&a.$exception_types.push(c),cR(d)&&d.length>0&&a.$exception_values.push(d),a},{$exception_types:[],$exception_values:[]});return this.Jt.some(a=>{var c=a.values.map(a=>{var c,d=hp[a.operator],e=cM(a.value)?a.value:[a.value],f=null!=(c=b[a.key])?c:[];return e.length>0&&d(e,f)});return"OR"===a.type?c.some(Boolean):c.every(Boolean)})}Zt(a){return a.flatMap(a=>{var b,c;return null!=(b=null==(c=a.stacktrace)?void 0:c.frames)?b:[]}).some(a=>a.filename&&a.filename.startsWith("chrome-extension://"))}ti(a){if(a.length>0){var b,c,d,e,f=null!=(b=null==(c=a[0].stacktrace)?void 0:c.frames)?b:[],g=f[f.length-1];return null!=(d=null==g||null==(e=g.filename)?void 0:e.includes("posthog.com/static"))&&d}return!1}Xt(a){return!cU(a)&&cM(a)}}var ht=dU("[FeatureFlags]"),hu="$active_feature_flags",hv="$override_feature_flags",hw="$feature_flag_payloads",hx="$override_feature_flag_payloads",hy="$feature_flag_request_id",hz=a=>{var b={};for(var[c,d]of d0(a||{}))d&&(b[c]=d);return b},hA=((i={}).FeatureFlags="feature_flags",i.Recordings="recordings",i);class hB{constructor(a){this.ii=!1,this.ei=!1,this.ri=!1,this.si=!1,this.ni=!1,this.oi=!1,this.ai=!1,this._instance=a,this.featureFlagEventHandlers=[]}li(){var a=this._instance.config.evaluation_environments;return null!=a&&a.length?a.filter(a=>{var b=a&&"string"==typeof a&&a.trim().length>0;return b||ht.error("Invalid evaluation environment found:",a,"Expected non-empty string"),b}):[]}ui(){return this.li().length>0}flags(){if(this._instance.config.__preview_remote_config)this.oi=!0;else{var a=!this.hi&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.di({disableFlags:a})}}get hasLoadedFlags(){return this.ei}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var a=this._instance.get_property(em),b=this._instance.get_property(hv),c=this._instance.get_property(hx);if(!c&&!b)return a||{};var d=d$({},a||{});for(var e of[...new Set([...Object.keys(c||{}),...Object.keys(b||{})])]){var f,g,h=d[e],i=null==b?void 0:b[e],j=cQ(i)?null!=(f=null==h?void 0:h.enabled)&&f:!!i,k=cQ(i)?h.variant:"string"==typeof i?i:void 0,l=null==c?void 0:c[e],m=cA({},h,{enabled:j,variant:j?null!=k?k:null==h?void 0:h.variant:void 0});j!==(null==h?void 0:h.enabled)&&(m.original_enabled=null==h?void 0:h.enabled),k!==(null==h?void 0:h.variant)&&(m.original_variant=null==h?void 0:h.variant),l&&(m.metadata=cA({},null==h?void 0:h.metadata,{payload:l,original_payload:null==h||null==(g=h.metadata)?void 0:g.payload})),d[e]=m}return this.ii||(ht.warn(" Overriding feature flag details!",{flagDetails:a,overriddenPayloads:c,finalDetails:d}),this.ii=!0),d}getFlagVariants(){var a=this._instance.get_property(ek),b=this._instance.get_property(hv);if(!b)return a||{};for(var c=d$({},a),d=Object.keys(b),e=0;e<d.length;e++)c[d[e]]=b[d[e]];return this.ii||(ht.warn(" Overriding feature flags!",{enabledFlags:a,overriddenFlags:b,finalFlags:c}),this.ii=!0),c}getFlagPayloads(){var a=this._instance.get_property(hw),b=this._instance.get_property(hx);if(!b)return a||{};for(var c=d$({},a||{}),d=Object.keys(b),e=0;e<d.length;e++)c[d[e]]=b[d[e]];return this.ii||(ht.warn(" Overriding feature flag payloads!",{flagPayloads:a,overriddenPayloads:b,finalPayloads:c}),this.ii=!0),c}reloadFeatureFlags(){this.si||this._instance.config.advanced_disable_feature_flags||this.hi||(this.hi=setTimeout(()=>{this.di()},5))}vi(){clearTimeout(this.hi),this.hi=void 0}ensureFlagsLoaded(){this.ei||this.ri||this.hi||this.reloadFeatureFlags()}setAnonymousDistinctId(a){this.$anon_distinct_id=a}setReloadingPaused(a){this.si=a}di(a){var b;if(this.vi(),!this._instance.M())if(this.ri)this.ni=!0;else{var c={token:this._instance.config.token,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:cA({},(null==(b=this._instance.persistence)?void 0:b.get_initial_props())||{},this._instance.get_property(en)||{}),group_properties:this._instance.get_property(eo)};(null!=a&&a.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(c.disable_flags=!0),this.ui()&&(c.evaluation_environments=this.li());var d=this._instance.config.__preview_remote_config,e=this._instance.config.advanced_only_evaluate_survey_feature_flags?"&only_evaluate_survey_feature_flags=true":"",f=this._instance.requestRouter.endpointFor("flags",(d?"/flags/?v=2":"/flags/?v=2&config=true")+e);d&&(c.timezone=gF()),this.ri=!0,this._instance.ci({method:"POST",url:f,data:c,compression:this._instance.config.disable_compression?void 0:e$.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:a=>{var b,d,e,f=!0;200===a.statusCode&&(this.ni||(this.$anon_distinct_id=void 0),f=!1),this.ri=!1,this.oi||(this.oi=!0,this._instance.fi(null!=(e=a.json)?e:{})),(!c.disable_flags||this.ni)&&((this.ai=!f,a.json&&null!=(d=a.json.quotaLimited)&&d.includes(hA.FeatureFlags))?ht.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more."):(c.disable_flags||this.receivedFeatureFlags(null!=(b=a.json)?b:{},f),this.ni&&(this.ni=!1,this.di())))}})}}getFeatureFlag(a,b){if(void 0===b&&(b={}),this.ei||this.getFlags()&&this.getFlags().length>0){var c=this.getFlagVariants()[a],d=""+c,e=this._instance.get_property(hy)||void 0,f=this._instance.get_property(er)||{};if((b.send_event||!("send_event"in b))&&(!(a in f)||!f[a].includes(d))){cM(f[a])?f[a].push(d):f[a]=[d],null==(i=this._instance.persistence)||i.register({[er]:f});var g=this.getFeatureFlagDetails(a),h={$feature_flag:a,$feature_flag_response:c,$feature_flag_payload:this.getFeatureFlagPayload(a)||null,$feature_flag_request_id:e,$feature_flag_bootstrapped_response:(null==(j=this._instance.config.bootstrap)||null==(j=j.featureFlags)?void 0:j[a])||null,$feature_flag_bootstrapped_payload:(null==(k=this._instance.config.bootstrap)||null==(k=k.featureFlagPayloads)?void 0:k[a])||null,$used_bootstrap_value:!this.ai};cQ(null==g||null==(l=g.metadata)?void 0:l.version)||(h.$feature_flag_version=g.metadata.version);var i,j,k,l,m,n,o,p,q,r,s=null!=(m=null==g||null==(n=g.reason)?void 0:n.description)?m:null==g||null==(o=g.reason)?void 0:o.code;s&&(h.$feature_flag_reason=s),null!=g&&null!=(p=g.metadata)&&p.id&&(h.$feature_flag_id=g.metadata.id),cQ(null==g?void 0:g.original_variant)&&cQ(null==g?void 0:g.original_enabled)||(h.$feature_flag_original_response=cQ(g.original_variant)?g.original_enabled:g.original_variant),null!=g&&null!=(q=g.metadata)&&q.original_payload&&(h.$feature_flag_original_payload=null==g||null==(r=g.metadata)?void 0:r.original_payload),this._instance.capture("$feature_flag_called",h)}return c}ht.warn('getFeatureFlag for key "'+a+"\" failed. Feature flags didn't load in time.")}getFeatureFlagDetails(a){return this.getFlagsWithDetails()[a]}getFeatureFlagPayload(a){return this.getFlagPayloads()[a]}getRemoteConfigPayload(a,b){var c=this._instance.config.token,d={distinct_id:this._instance.get_distinct_id(),token:c};this.ui()&&(d.evaluation_environments=this.li()),this._instance.ci({method:"POST",url:this._instance.requestRouter.endpointFor("flags","/flags/?v=2&config=true"),data:d,compression:this._instance.config.disable_compression?void 0:e$.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:c=>{var d,e=null==(d=c.json)?void 0:d.featureFlagPayloads;b((null==e?void 0:e[a])||void 0)}})}isFeatureEnabled(a,b){if(void 0===b&&(b={}),this.ei||this.getFlags()&&this.getFlags().length>0){var c=this.getFeatureFlag(a,b);return cQ(c)?void 0:!!c}ht.warn('isFeatureEnabled for key "'+a+"\" failed. Feature flags didn't load in time.")}addFeatureFlagsHandler(a){this.featureFlagEventHandlers.push(a)}removeFeatureFlagsHandler(a){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(b=>b!==a)}receivedFeatureFlags(a,b){if(this._instance.persistence){this.ei=!0;var c=this.getFlagVariants(),d=this.getFlagPayloads(),e=this.getFlagsWithDetails();!function(a,b,c,d,e){void 0===c&&(c={}),void 0===d&&(d={}),void 0===e&&(e={});var f,g=((f=a.flags)?(a.featureFlags=Object.fromEntries(Object.keys(f).map(a=>{var b;return[a,null!=(b=f[a].variant)?b:f[a].enabled]})),a.featureFlagPayloads=Object.fromEntries(Object.keys(f).filter(a=>f[a].enabled).filter(a=>{var b;return null==(b=f[a].metadata)?void 0:b.payload}).map(a=>{var b;return[a,null==(b=f[a].metadata)?void 0:b.payload]}))):ht.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),a),h=g.flags,i=g.featureFlags,j=g.featureFlagPayloads;if(i){var k=a.requestId;if(cM(i)){ht.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var l={};if(i)for(var m=0;m<i.length;m++)l[i[m]]=!0;b&&b.register({[hu]:i,[ek]:l})}else{var n=i,o=j,p=h;a.errorsWhileComputingFlags&&(n=cA({},c,n),o=cA({},d,o),p=cA({},e,p)),b&&b.register(cA({[hu]:Object.keys(hz(n)),[ek]:n||{},[hw]:o||{},[em]:p||{}},k?{[hy]:k}:{}))}}}(a,this._instance.persistence,c,d,e),this.pi(b)}}override(a,b){void 0===b&&(b=!1),ht.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:a,suppressWarning:b})}overrideFeatureFlags(a){if(!this._instance.__loaded||!this._instance.persistence)return ht.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(!1===a)return this._instance.persistence.unregister(hv),this._instance.persistence.unregister(hx),void this.pi();if(a&&"object"==typeof a&&("flags"in a||"payloads"in a)){var b;if(this.ii=!!(null!=(b=a.suppressWarning)&&b),"flags"in a){if(!1===a.flags)this._instance.persistence.unregister(hv);else if(a.flags)if(cM(a.flags)){for(var c={},d=0;d<a.flags.length;d++)c[a.flags[d]]=!0;this._instance.persistence.register({[hv]:c})}else this._instance.persistence.register({[hv]:a.flags})}return"payloads"in a&&(!1===a.payloads?this._instance.persistence.unregister(hx):a.payloads&&this._instance.persistence.register({[hx]:a.payloads})),void this.pi()}this.pi()}onFeatureFlags(a){if(this.addFeatureFlagsHandler(a),this.ei){var{flags:b,flagVariants:c}=this.gi();a(b,c)}return()=>this.removeFeatureFlagsHandler(a)}updateEarlyAccessFeatureEnrollment(a,b,c){var d,e=(this._instance.get_property(el)||[]).find(b=>b.flagKey===a),f={["$feature_enrollment/"+a]:b},g={$feature_flag:a,$feature_enrollment:b,$set:f};e&&(g.$early_access_feature_name=e.name),c&&(g.$feature_enrollment_stage=c),this._instance.capture("$feature_enrollment_update",g),this.setPersonPropertiesForFlags(f,!1);var h=cA({},this.getFlagVariants(),{[a]:b});null==(d=this._instance.persistence)||d.register({[hu]:Object.keys(hz(h)),[ek]:h}),this.pi()}getEarlyAccessFeatures(a,b,c){void 0===b&&(b=!1);var d=this._instance.get_property(el),e=c?"&"+c.map(a=>"stage="+a).join("&"):"";if(d&&!b)return a(d);this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+e),method:"GET",callback:b=>{var c,d;if(b.json){var e=b.json.earlyAccessFeatures;return null==(c=this._instance.persistence)||c.unregister(el),null==(d=this._instance.persistence)||d.register({[el]:e}),a(e)}}})}gi(){var a=this.getFlags(),b=this.getFlagVariants();return{flags:a.filter(a=>b[a]),flagVariants:Object.keys(b).filter(a=>b[a]).reduce((a,c)=>(a[c]=b[c],a),{})}}pi(a){var{flags:b,flagVariants:c}=this.gi();this.featureFlagEventHandlers.forEach(d=>d(b,c,{errorsLoading:a}))}setPersonPropertiesForFlags(a,b){void 0===b&&(b=!0);var c=this._instance.get_property(en)||{};this._instance.register({[en]:cA({},c,a)}),b&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(en)}setGroupPropertiesForFlags(a,b){void 0===b&&(b=!0);var c=this._instance.get_property(eo)||{};0!==Object.keys(c).length&&Object.keys(c).forEach(b=>{c[b]=cA({},c[b],a[b]),delete a[b]}),this._instance.register({[eo]:cA({},c,a)}),b&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(a){if(a){var b=this._instance.get_property(eo)||{};this._instance.register({[eo]:cA({},b,{[a]:{}})})}else this._instance.unregister(eo)}reset(){this.ei=!1,this.ri=!1,this.si=!1,this.ni=!1,this.oi=!1,this.ai=!1,this.$anon_distinct_id=void 0,this.vi(),this.ii=!1}}var hC=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class hD{constructor(a,b){this.C=a,this.props={},this.mi=!1,this.yi=(a=>{var b="";return a.token&&(b=a.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),a.persistence_name?"ph_"+a.persistence_name:"ph_"+b+"_posthog"})(a),this.Y=this.bi(a),this.load(),a.debug&&dT.info("Persistence loaded",a.persistence,cA({},this.props)),this.update_config(a,a,b),this.save()}isDisabled(){return!!this.wi}bi(a){-1===hC.indexOf(a.persistence.toLowerCase())&&(dT.critical("Unknown persistence type "+a.persistence+"; falling back to localStorage+cookie"),a.persistence="localStorage+cookie");var b=a.persistence.toLowerCase();return"localstorage"===b&&fk.H()?fk:"localstorage+cookie"===b&&fm.H()?fm:"sessionstorage"===b&&fq.H()?fq:"memory"===b?fo:"cookie"===b?fi:fm.H()?fm:fi}properties(){var a={};return dZ(this.props,function(b,c){if(c===ek&&cO(b))for(var d,e=Object.keys(b),f=0;f<e.length;f++)a["$feature/"+e[f]]=b[e[f]];else d=!1,(cT(eB)?d:co&&eB.indexOf===co?-1!=eB.indexOf(c):(dZ(eB,function(a){if(d||(d=a===c))return dX}),d))||(a[c]=b)}),a}load(){if(!this.wi){var a=this.Y.W(this.yi);a&&(this.props=d$({},a))}}save(){this.wi||this.Y.G(this.yi,this.props,this.xi,this.$i,this.Si,this.C.debug)}remove(){this.Y.V(this.yi,!1),this.Y.V(this.yi,!0)}clear(){this.remove(),this.props={}}register_once(a,b,c){if(cO(a)){cQ(b)&&(b="None"),this.xi=cQ(c)?this.Ei:c;var d=!1;if(dZ(a,(a,c)=>{this.props.hasOwnProperty(c)&&this.props[c]!==b||(this.props[c]=a,d=!0)}),d)return this.save(),!0}return!1}register(a,b){if(cO(a)){this.xi=cQ(b)?this.Ei:b;var c=!1;if(dZ(a,(b,d)=>{a.hasOwnProperty(d)&&this.props[d]!==b&&(this.props[d]=b,c=!0)}),c)return this.save(),!0}return!1}unregister(a){a in this.props&&(delete this.props[a],this.save())}update_campaign_params(){if(!this.mi){var a=gy(this.C.custom_campaign_params,this.C.mask_personal_data_properties,this.C.custom_personal_data_properties);cP(d2(a))||this.register(a),this.mi=!0}}update_search_keyword(){var a;this.register((a=null==cq?void 0:cq.referrer)?gA(a):{})}update_referrer_info(){var a;this.register_once({$referrer:gC(),$referring_domain:null!=cq&&cq.referrer&&(null==(a=e_(cq.referrer))?void 0:a.host)||"$direct"},void 0)}set_initial_person_info(){this.props[ev]||this.props[ew]||this.register_once({[ex]:gD(this.C.mask_personal_data_properties,this.C.custom_personal_data_properties)},void 0)}get_initial_props(){var a={};dZ([ew,ev],b=>{var c=this.props[b];c&&dZ(c,function(b,c){a["$initial_"+cH(c)]=b})});var b,c,d=this.props[ex];return d&&d$(a,(b=gE(d),c={},dZ(b,function(a,b){c["$initial_"+cH(b)]=a}),c)),a}safe_merge(a){return dZ(this.props,function(b,c){c in a||(a[c]=b)}),a}update_config(a,b,c){if(this.Ei=this.xi=a.cookie_expiration,this.set_disabled(a.disable_persistence||!!c),this.set_cross_subdomain(a.cross_subdomain_cookie),this.set_secure(a.secure_cookie),a.persistence!==b.persistence){var d=this.bi(a),e=this.props;this.clear(),this.Y=d,this.props=e,this.save()}}set_disabled(a){this.wi=a,this.wi?this.remove():this.save()}set_cross_subdomain(a){a!==this.$i&&(this.$i=a,this.remove(),this.save())}set_secure(a){a!==this.Si&&(this.Si=a,this.remove(),this.save())}set_event_timer(a,b){var c=this.props[d8]||{};c[a]=b,this.props[d8]=c,this.save()}remove_event_timer(a){var b=(this.props[d8]||{})[a];return cQ(b)||(delete this.props[d8][a],this.save()),b}get_property(a){return this.props[a]}set_property(a,b){this.props[a]=b,this.save()}}(j={}).Button="button",j.Tab="tab",j.Selector="selector",(k={}).TopLeft="top_left",k.TopRight="top_right",k.TopCenter="top_center",k.MiddleLeft="middle_left",k.MiddleRight="middle_right",k.MiddleCenter="middle_center",k.Left="left",k.Center="center",k.Right="right",k.NextToTrigger="next_to_trigger";var hE=((l={}).Popover="popover",l.API="api",l.Widget="widget",l.ExternalSurvey="external_survey",l),hF=((m={}).Open="open",m.MultipleChoice="multiple_choice",m.SingleChoice="single_choice",m.Rating="rating",m.Link="link",(n={}).NextQuestion="next_question",n.End="end",n.ResponseBased="response_based",n.SpecificQuestion="specific_question",(o={}).Once="once",o.Recurring="recurring",o.Always="always",(p={}).SHOWN="survey shown",p.DISMISSED="survey dismissed",p.SENT="survey sent",p),hG=((q={}).SURVEY_ID="$survey_id",q.SURVEY_NAME="$survey_name",q.SURVEY_RESPONSE="$survey_response",q.SURVEY_ITERATION="$survey_iteration",q.SURVEY_ITERATION_START_DATE="$survey_iteration_start_date",q.SURVEY_PARTIALLY_COMPLETED="$survey_partially_completed",q.SURVEY_SUBMISSION_ID="$survey_submission_id",q.SURVEY_QUESTIONS="$survey_questions",q.SURVEY_COMPLETED="$survey_completed",q),hH=((r={}).Popover="popover",r.Inline="inline",r);class hI{constructor(){this.ki={},this.ki={}}on(a,b){return this.ki[a]||(this.ki[a]=[]),this.ki[a].push(b),()=>{this.ki[a]=this.ki[a].filter(a=>a!==b)}}emit(a,b){for(var c of this.ki[a]||[])c(b);for(var d of this.ki["*"]||[])d(a,b)}}class hJ{constructor(a){this.Pi=new hI,this.Ti=(a,b)=>this.Ii(a,b)&&this.Ri(a,b)&&this.Ci(a,b),this.Ii=(a,b)=>null==b||!b.event||(null==a?void 0:a.event)===(null==b?void 0:b.event),this._instance=a,this.Oi=new Set,this.Fi=new Set}init(){var a,b;cQ(null==(a=this._instance)?void 0:a.Mi)||null==(b=this._instance)||b.Mi((a,b)=>{this.on(a,b)})}register(a){var b,c;if(!cQ(null==(b=this._instance)?void 0:b.Mi)&&(a.forEach(a=>{var b,c;null==(b=this.Fi)||b.add(a),null==(c=a.steps)||c.forEach(a=>{var b;null==(b=this.Oi)||b.add((null==a?void 0:a.event)||"")})}),null!=(c=this._instance)&&c.autocapture)){var d,e=new Set;a.forEach(a=>{var b;null==(b=a.steps)||b.forEach(a=>{null!=a&&a.selector&&e.add(null==a?void 0:a.selector)})}),null==(d=this._instance)||d.autocapture.setElementSelectors(e)}}on(a,b){var c;null!=b&&0!=a.length&&(this.Oi.has(a)||this.Oi.has(null==b?void 0:b.event))&&this.Fi&&(null==(c=this.Fi)?void 0:c.size)>0&&this.Fi.forEach(a=>{this.Ai(b,a)&&this.Pi.emit("actionCaptured",a.name)})}Di(a){this.onAction("actionCaptured",b=>a(b))}Ai(a,b){if(null==(null==b?void 0:b.steps))return!1;for(var c of b.steps)if(this.Ti(a,c))return!0;return!1}onAction(a,b){return this.Pi.on(a,b)}Ri(a,b){if(null!=b&&b.url){var c,d=null==a||null==(c=a.properties)?void 0:c.$current_url;if(!d||"string"!=typeof d||!hJ.ji(d,null==b?void 0:b.url,(null==b?void 0:b.url_matching)||"contains"))return!1}return!0}static ji(a,b,c){switch(c){case"regex":return!!ck&&hn(a,b);case"exact":return b===a;case"contains":return hn(a,hJ.Li(b).replace(/_/g,".").replace(/%/g,".*"));default:return!1}}static Li(a){return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}Ci(a,b){if((null!=b&&b.href||null!=b&&b.tag_name||null!=b&&b.text)&&!this.Ni(a).some(a=>!(null!=b&&b.href&&!hJ.ji(a.href||"",null==b?void 0:b.href,(null==b?void 0:b.href_matching)||"exact"))&&(null==b||!b.tag_name||a.tag_name===(null==b?void 0:b.tag_name))&&!(null!=b&&b.text&&!hJ.ji(a.text||"",null==b?void 0:b.text,(null==b?void 0:b.text_matching)||"exact")&&!hJ.ji(a.$el_text||"",null==b?void 0:b.text,(null==b?void 0:b.text_matching)||"exact"))))return!1;if(null!=b&&b.selector){var c,d=null==a||null==(c=a.properties)?void 0:c.$element_selectors;if(!d||!d.includes(null==b?void 0:b.selector))return!1}return!0}Ni(a){return null==(null==a?void 0:a.properties.$elements)?[]:null==a?void 0:a.properties.$elements}}var hK=dU("[Surveys]"),hL="seenSurvey_",hM=a=>{var b=""+hL+a.id;return a.current_iteration&&a.current_iteration>0&&(b=""+hL+a.id+"_"+a.current_iteration),b},hN=[hE.Popover,hE.Widget,hE.API],hO={ignoreConditions:!1,ignoreDelay:!1,displayType:hH.Popover};class hP{constructor(a){this._instance=a,this.Ui=new Map,this.zi=new Map}register(a){var b;cQ(null==(b=this._instance)?void 0:b.Mi)||(this.Hi(a),this.Bi(a))}Bi(a){var b=a.filter(a=>{var b,c;return(null==(b=a.conditions)?void 0:b.actions)&&(null==(c=a.conditions)||null==(c=c.actions)||null==(c=c.values)?void 0:c.length)>0});0!==b.length&&(null==this.qi&&(this.qi=new hJ(this._instance),this.qi.init(),this.qi.Di(a=>{this.onAction(a)})),b.forEach(a=>{var b,c,d,e,f;a.conditions&&null!=(b=a.conditions)&&b.actions&&null!=(c=a.conditions)&&null!=(c=c.actions)&&c.values&&(null==(d=a.conditions)||null==(d=d.actions)||null==(d=d.values)?void 0:d.length)>0&&(null==(e=this.qi)||e.register(a.conditions.actions.values),null==(f=a.conditions)||null==(f=f.actions)||null==(f=f.values)||f.forEach(b=>{if(b&&b.name){var c=this.zi.get(b.name);c&&c.push(a.id),this.zi.set(b.name,c||[a.id])}}))}))}Hi(a){var b;0!==a.filter(a=>{var b,c;return(null==(b=a.conditions)?void 0:b.events)&&(null==(c=a.conditions)||null==(c=c.events)||null==(c=c.values)?void 0:c.length)>0}).length&&(null==(b=this._instance)||b.Mi((a,b)=>{this.onEvent(a,b)}),a.forEach(a=>{var b;null==(b=a.conditions)||null==(b=b.events)||null==(b=b.values)||b.forEach(b=>{if(b&&b.name){var c=this.Ui.get(b.name);c&&c.push(a.id),this.Ui.set(b.name,c||[a.id])}})}))}onEvent(a,b){var c,d,e=(null==(c=this._instance)||null==(c=c.persistence)?void 0:c.props[eq])||[];if(hF.SHOWN===a&&b&&e.length>0){hK.info("survey event matched, removing survey from activated surveys",{event:a,eventPayload:b,existingActivatedSurveys:e});var f,g=null==b||null==(f=b.properties)?void 0:f.$survey_id;if(g){var h=e.indexOf(g);h>=0&&(e.splice(h,1),this.Wi(e))}}else if(this.Ui.has(a)){hK.info("survey event name matched",{event:a,eventPayload:b,surveys:this.Ui.get(a)});var i=[];null==(d=this._instance)||d.getSurveys(b=>{i=b.filter(b=>{var c;return null==(c=this.Ui.get(a))?void 0:c.includes(b.id)})});var j=i.filter(c=>{var d,e=null==(d=c.conditions)||null==(d=d.events)||null==(d=d.values)?void 0:d.find(b=>b.name===a);return!!e&&(!e.propertyFilters||Object.entries(e.propertyFilters).every(a=>{var c,[d,e]=a,f=null==b||null==(c=b.properties)?void 0:c[d];if(cQ(f)||cT(f))return!1;var g=[String(f)],h=hp[e.operator];return h?h(e.values,g):(hK.warn("Unknown property comparison operator: "+e.operator),!1)}))});this.Wi(e.concat(j.map(a=>a.id)||[]))}}onAction(a){var b,c=(null==(b=this._instance)||null==(b=b.persistence)?void 0:b.props[eq])||[];this.zi.has(a)&&this.Wi(c.concat(this.zi.get(a)||[]))}Wi(a){var b;hK.info("updating activated surveys",{activatedSurveys:a}),null==(b=this._instance)||null==(b=b.persistence)||b.register({[eq]:[...new Set(a)]})}getSurveys(){var a;return(null==(a=this._instance)||null==(a=a.persistence)?void 0:a.props[eq])||[]}getEventToSurveys(){return this.Ui}Gi(){return this.qi}}class hQ{constructor(a){this.Vi=void 0,this._surveyManager=null,this.Ji=!1,this.Ki=!1,this.Yi=[],this._instance=a,this._surveyEventReceiver=null}onRemoteConfig(a){if(!this._instance.config.disable_surveys){var b=a.surveys;if(cU(b))return hK.warn("Flags not loaded yet. Not loading surveys.");var c=cM(b);this.Vi=c?b.length>0:b,hK.info("flags response received, isSurveysEnabled: "+this.Vi),this.loadIfEnabled()}}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var a=[],b=0;b<localStorage.length;b++){var c=localStorage.key(b);(null!=c&&c.startsWith(hL)||null!=c&&c.startsWith("inProgressSurvey_"))&&a.push(c)}a.forEach(a=>localStorage.removeItem(a))}loadIfEnabled(){if(!this._surveyManager)if(this.Ki)hK.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)hK.info("Disabled. Not loading surveys.");else if(this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())hK.info("Not loading surveys in cookieless mode without consent.");else{var a=null==cw?void 0:cw.__PosthogExtensions__;if(a){if(!cQ(this.Vi)||this._instance.config.advanced_enable_surveys){var b=this.Vi||this._instance.config.advanced_enable_surveys;this.Ki=!0;try{var c=a.generateSurveys;if(c)return void this.Xi(c,b);var d=a.loadExternalDependency;if(!d)return void this.Qi("PostHog loadExternalDependency extension not found.");d(this._instance,"surveys",c=>{c||!a.generateSurveys?this.Qi("Could not load surveys script",c):this.Xi(a.generateSurveys,b)})}catch(a){throw this.Qi("Error initializing surveys",a),a}finally{this.Ki=!1}}}else hK.error("PostHog Extensions not found.")}}Xi(a,b){this._surveyManager=a(this._instance,b),this._surveyEventReceiver=new hP(this._instance),hK.info("Surveys loaded successfully"),this.Zi({isLoaded:!0})}Qi(a,b){hK.error(a,b),this.Zi({isLoaded:!1,error:a})}onSurveysLoaded(a){return this.Yi.push(a),this._surveyManager&&this.Zi({isLoaded:!0}),()=>{this.Yi=this.Yi.filter(b=>b!==a)}}getSurveys(a,b){if(void 0===b&&(b=!1),this._instance.config.disable_surveys)return hK.info("Disabled. Not loading surveys."),a([]);var c=this._instance.get_property(ep);if(c&&!b)return a(c,{isLoaded:!0});if(this.Ji)return a([],{isLoaded:!1,error:"Surveys are already being loaded"});try{this.Ji=!0,this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:b=>{this.Ji=!1;var c=b.statusCode;if(200!==c||!b.json){var d="Surveys API could not be loaded, status: "+c;return hK.error(d),a([],{isLoaded:!1,error:d})}var e,f,g=b.json.surveys||[],h=g.filter(a=>{var b,c;return!(!a.start_date||a.end_date)&&(!(null==(b=a.conditions)||null==(b=b.events)||null==(b=b.values)||!b.length)||!(null==(c=a.conditions)||null==(c=c.actions)||null==(c=c.values)||!c.length))});return h.length>0&&(null==(f=this._surveyEventReceiver)||f.register(h)),null==(e=this._instance.persistence)||e.register({[ep]:g}),a(g,{isLoaded:!0})}})}catch(a){throw this.Ji=!1,a}}Zi(a){for(var b of this.Yi)try{if(!a.isLoaded)return b([],a);this.getSurveys(b)}catch(a){hK.error("Error in survey callback",a)}}getActiveMatchingSurveys(a,b){if(void 0===b&&(b=!1),!cU(this._surveyManager))return this._surveyManager.getActiveMatchingSurveys(a,b);hK.warn("init was not called")}te(a){var b=null;return this.getSurveys(c=>{var d;b=null!=(d=c.find(b=>b.id===a))?d:null}),b}ie(a){if(cU(this._surveyManager))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var b="string"==typeof a?this.te(a):a;return b?this._surveyManager.checkSurveyEligibility(b):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(a){if(cU(this._surveyManager))return hK.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var b=this.ie(a);return{visible:b.eligible,disabledReason:b.reason}}canRenderSurveyAsync(a,b){return cU(this._surveyManager)?(hK.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise(c=>{this.getSurveys(b=>{var d,e=null!=(d=b.find(b=>b.id===a))?d:null;if(e){var f=this.ie(e);c({visible:f.eligible,disabledReason:f.reason})}else c({visible:!1,disabledReason:"Survey not found"})},b)})}renderSurvey(a,b){var c;if(cU(this._surveyManager))hK.warn("init was not called");else{var d="string"==typeof a?this.te(a):a;if(null!=d&&d.id)if(hN.includes(d.type)){var e=null==cq?void 0:cq.querySelector(b);if(e)return null!=(c=d.appearance)&&c.surveyPopupDelaySeconds?(hK.info("Rendering survey "+d.id+" with delay of "+d.appearance.surveyPopupDelaySeconds+" seconds"),void setTimeout(()=>{var a,b;hK.info("Rendering survey "+d.id+" with delay of "+(null==(a=d.appearance)?void 0:a.surveyPopupDelaySeconds)+" seconds"),null==(b=this._surveyManager)||b.renderSurvey(d,e),hK.info("Survey "+d.id+" rendered")},1e3*d.appearance.surveyPopupDelaySeconds)):void this._surveyManager.renderSurvey(d,e);hK.warn("Survey element not found")}else hK.warn("Surveys of type "+d.type+" cannot be rendered in the app");else hK.warn("Survey not found")}}displaySurvey(a,b){var c;if(cU(this._surveyManager))hK.warn("init was not called");else{var d=this.te(a);if(d){var e=d;if(null!=(c=d.appearance)&&c.surveyPopupDelaySeconds&&b.ignoreDelay&&(e=cA({},d,{appearance:cA({},d.appearance,{surveyPopupDelaySeconds:0})})),!1===b.ignoreConditions){var f=this.canRenderSurvey(d);if(!f.visible)return void hK.warn("Survey is not eligible to be displayed: ",f.disabledReason)}b.displayType!==hH.Inline?this._surveyManager.handlePopoverSurvey(e):this.renderSurvey(e,b.selector)}else hK.warn("Survey not found")}}}var hR=dU("[RateLimiter]");class hS{constructor(a){var b,c;this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=a=>{var b=a.text;if(b&&b.length)try{(JSON.parse(b).quota_limited||[]).forEach(a=>{hR.info((a||"events")+" is quota limited."),this.serverLimits[a]=(new Date).getTime()+6e4})}catch(a){return void hR.warn('could not rate limit - continuing. Error: "'+(null==a?void 0:a.message)+'"',{text:b})}},this.instance=a,this.captureEventsPerSecond=(null==(b=a.config.rate_limiting)?void 0:b.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null==(c=a.config.rate_limiting)?void 0:c.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}clientRateLimitContext(a){void 0===a&&(a=!1);var b,c,d,e=(new Date).getTime(),f=null!=(b=null==(c=this.instance.persistence)?void 0:c.get_property(eu))?b:{tokens:this.captureEventsBurstLimit,last:e};f.tokens+=(e-f.last)/1e3*this.captureEventsPerSecond,f.last=e,f.tokens>this.captureEventsBurstLimit&&(f.tokens=this.captureEventsBurstLimit);var g=f.tokens<1;return g||a||(f.tokens=Math.max(0,f.tokens-1)),!g||this.lastEventRateLimited||a||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+this.captureEventsPerSecond+" events per second and "+this.captureEventsBurstLimit+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=g,null==(d=this.instance.persistence)||d.set_property(eu,f),{isRateLimited:g,remainingTokens:f.tokens}}isServerRateLimited(a){var b=this.serverLimits[a||"events"]||!1;return!1!==b&&(new Date).getTime()<b}}var hT=dU("[RemoteConfig]");class hU{constructor(a){this._instance=a}get remoteConfig(){var a;return null==(a=cw._POSTHOG_REMOTE_CONFIG)||null==(a=a[this._instance.config.token])?void 0:a.config}ee(a){var b,c;null!=(b=cw.__PosthogExtensions__)&&b.loadExternalDependency?null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this._instance,"remote-config",()=>a(this.remoteConfig)):(hT.error("PostHog Extensions not found. Cannot load remote config."),a())}re(a){this._instance.ci({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:b=>{a(b.json)}})}load(){try{if(this.remoteConfig)return hT.info("Using preloaded remote config",this.remoteConfig),void this.fi(this.remoteConfig);if(this._instance.M())return void hT.warn("Remote config is disabled. Falling back to local config.");this.ee(a=>{a?this.fi(a):(hT.info("No config found after loading remote JS config. Falling back to JSON."),this.re(a=>{this.fi(a)}))})}catch(a){hT.error("Error loading remote config",a)}}fi(a){a?this._instance.config.__preview_remote_config?(this._instance.fi(a),!1!==a.hasFeatureFlags&&this._instance.featureFlags.ensureFlagsLoaded()):hT.info("__preview_remote_config is disabled. Logging config instead",a):hT.error("Failed to fetch remote config from PostHog.")}}class hV{constructor(a,b){this.se=!0,this.ne=[],this.oe=c1((null==b?void 0:b.flush_interval_ms)||3e3,250,5e3,dT.createLogger("flush interval"),3e3),this.ae=a}enqueue(a){this.ne.push(a),this.le||this.ue()}unload(){this.he();var a=Object.values(this.ne.length>0?this.de():{});[...a.filter(a=>0===a.url.indexOf("/e")),...a.filter(a=>0!==a.url.indexOf("/e"))].map(a=>{this.ae(cA({},a,{transport:"sendBeacon"}))})}enable(){this.se=!1,this.ue()}ue(){var a=this;this.se||(this.le=setTimeout(()=>{if(this.he(),this.ne.length>0){var b=this.de();for(var c in b)!function(){var d=b[c],e=(new Date).getTime();d.data&&cM(d.data)&&dZ(d.data,a=>{a.offset=Math.abs(a.timestamp-e),delete a.timestamp}),a.ae(d)}()}},this.oe))}he(){clearTimeout(this.le),this.le=void 0}de(){var a={};return dZ(this.ne,b=>{var c,d=(b?b.batchKey:null)||b.url;cQ(a[d])&&(a[d]=cA({},b,{data:[]})),null==(c=a[d].data)||c.push(b.data)}),this.ne=[],a}}var hW=["retriesPerformedSoFar"];class hX{constructor(a){this.ve=!1,this.ce=3e3,this.ne=[],this._instance=a,this.ne=[],this.fe=!0,!cQ(ck)&&"onLine"in ck.navigator&&(this.fe=ck.navigator.onLine,this.pe=()=>{this.fe=!0,this.Dt()},this.ge=()=>{this.fe=!1},d5(ck,"online",this.pe),d5(ck,"offline",this.ge))}get length(){return this.ne.length}retriableRequest(a){var{retriesPerformedSoFar:b}=a,c=cB(a,hW);cV(b)&&b>0&&(c.url=hj(c.url,{retry_count:b})),this._instance.ci(cA({},c,{callback:a=>{200!==a.statusCode&&(a.statusCode<400||a.statusCode>=500)&&(null!=b?b:0)<10?this._e(cA({retriesPerformedSoFar:b},c)):null==c.callback||c.callback(a)}}))}_e(a){var b,c,d,e=a.retriesPerformedSoFar||0;a.retriesPerformedSoFar=e+1;var f=(d=(Math.random()-.5)*((c=Math.min(18e5,b=3e3*Math.pow(2,e)))-b/2),Math.ceil(c+d)),g=Date.now()+f;this.ne.push({retryAt:g,requestOptions:a});var h="Enqueued failed request for retry in "+f;navigator.onLine||(h+=" (Browser is offline)"),dT.warn(h),this.ve||(this.ve=!0,this.me())}me(){(this.ye&&clearTimeout(this.ye),0===this.ne.length)?(this.ve=!1,this.ye=void 0):this.ye=setTimeout(()=>{this.fe&&this.ne.length>0&&this.Dt(),this.me()},this.ce)}Dt(){var a=Date.now(),b=[],c=this.ne.filter(c=>c.retryAt<a||(b.push(c),!1));if(this.ne=b,c.length>0)for(var{requestOptions:d}of c)this.retriableRequest(d)}unload(){for(var{requestOptions:a}of(this.ye&&(clearTimeout(this.ye),this.ye=void 0),this.ve=!1,cQ(ck)||(this.pe&&(ck.removeEventListener("online",this.pe),this.pe=void 0),this.ge&&(ck.removeEventListener("offline",this.ge),this.ge=void 0)),this.ne))try{this._instance.ci(cA({},a,{transport:"sendBeacon"}))}catch(a){dT.error(a)}this.ne=[]}}class hY{constructor(a){this.be=()=>{this.we||(this.we={});var a,b,c,d,e=this.scrollElement(),f=this.scrollY(),g=e?Math.max(0,e.scrollHeight-e.clientHeight):0,h=f+((null==e?void 0:e.clientHeight)||0),i=(null==e?void 0:e.scrollHeight)||0;this.we.lastScrollY=Math.ceil(f),this.we.maxScrollY=Math.max(f,null!=(a=this.we.maxScrollY)?a:0),this.we.maxScrollHeight=Math.max(g,null!=(b=this.we.maxScrollHeight)?b:0),this.we.lastContentY=h,this.we.maxContentY=Math.max(h,null!=(c=this.we.maxContentY)?c:0),this.we.maxContentHeight=Math.max(i,null!=(d=this.we.maxContentHeight)?d:0)},this._instance=a}getContext(){return this.we}resetContext(){var a=this.we;return setTimeout(this.be,0),a}startMeasuringScrollPosition(){d5(ck,"scroll",this.be,{capture:!0}),d5(ck,"scrollend",this.be,{capture:!0}),d5(ck,"resize",this.be)}scrollElement(){if(!this._instance.config.scroll_root_selector)return null==ck?void 0:ck.document.documentElement;for(var a of cM(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector]){var b=null==ck?void 0:ck.document.querySelector(a);if(b)return b}}scrollY(){if(this._instance.config.scroll_root_selector){var a=this.scrollElement();return a&&a.scrollTop||0}return ck&&(ck.scrollY||ck.pageYOffset||ck.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var a=this.scrollElement();return a&&a.scrollLeft||0}return ck&&(ck.scrollX||ck.pageXOffset||ck.document.documentElement.scrollLeft)||0}}var hZ=a=>gD(null==a?void 0:a.config.mask_personal_data_properties,null==a?void 0:a.config.custom_personal_data_properties);class h${constructor(a,b,c,d){this.xe=a=>{var b=this.$e();if(!b||b.sessionId!==a){var c={sessionId:a,props:this.Se(this._instance)};this.Ee.register({[et]:c})}},this._instance=a,this.ke=b,this.Ee=c,this.Se=d||hZ,this.ke.onSessionId(this.xe)}$e(){return this.Ee.props[et]}getSetOnceProps(){var a,b=null==(a=this.$e())?void 0:a.props;return b?"r"in b?gE(b):{$referring_domain:b.referringDomain,$pathname:b.initialPathName,utm_source:b.utm_source,utm_campaign:b.utm_campaign,utm_medium:b.utm_medium,utm_content:b.utm_content,utm_term:b.utm_term}:{}}getSessionProps(){var a={};return dZ(d2(this.getSetOnceProps()),(b,c)=>{"$current_url"===c&&(c="url"),a["$session_entry_"+cH(c)]=b}),a}}var h_=dU("[SessionId]");class h0{on(a,b){return this.Pe.on(a,b)}constructor(a,b,c){if(this.Te=[],this.Ie=void 0,this.Pe=new hI,this.Re=(a,b)=>Math.abs(a-b)>this.sessionTimeoutMs,!a.persistence)throw Error("SessionIdManager requires a PostHogPersistence instance");if("always"===a.config.cookieless_mode)throw Error('SessionIdManager cannot be used with cookieless_mode="always"');this.C=a.config,this.Ee=a.persistence,this.Ce=void 0,this.Oe=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.Fe=b||fe,this.Me=c||fe;var d,e=this.C.persistence_name||this.C.token,f=this.C.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*c1(f,60,36e3,h_.createLogger("session_idle_timeout_seconds"),1800),a.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.Ae(),this.De="ph_"+e+"_window_id",this.je="ph_"+e+"_primary_window_exists",this.Le()){var g=fq.W(this.De),h=fq.W(this.je);g&&!h?this.Ce=g:fq.V(this.De),fq.G(this.je,!0)}if(null!=(d=this.C.bootstrap)&&d.sessionID)try{var i=(a=>{var b=a.replace(/-/g,"");if(32!==b.length)throw Error("Not a valid UUID");if("7"!==b[12])throw Error("Not a UUIDv7");return parseInt(b.substring(0,12),16)})(this.C.bootstrap.sessionID);this.Ne(this.C.bootstrap.sessionID,(new Date).getTime(),i)}catch(a){h_.error("Invalid sessionID in bootstrap",a)}this.Ue()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(a){return cQ(this.Te)&&(this.Te=[]),this.Te.push(a),this.Oe&&a(this.Oe,this.Ce),()=>{this.Te=this.Te.filter(b=>b!==a)}}Le(){return"memory"!==this.C.persistence&&!this.Ee.wi&&fq.H()}ze(a){a!==this.Ce&&(this.Ce=a,this.Le()&&fq.G(this.De,a))}He(){return this.Ce?this.Ce:this.Le()?fq.W(this.De):null}Ne(a,b,c){a===this.Oe&&b===this._sessionActivityTimestamp&&c===this._sessionStartTimestamp||(this._sessionStartTimestamp=c,this._sessionActivityTimestamp=b,this.Oe=a,this.Ee.register({[ei]:[b,a,c]}))}Be(){if(this.Oe&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this.Oe,this._sessionStartTimestamp];var a=this.Ee.props[ei];return cM(a)&&2===a.length&&a.push(a[0]),a||[0,null,0]}resetSessionId(){this.Ne(null,null,null)}destroy(){clearTimeout(this.qe),this.qe=void 0,this.Ie&&ck&&(ck.removeEventListener("beforeunload",this.Ie,{capture:!1}),this.Ie=void 0),this.Te=[]}Ue(){this.Ie=()=>{this.Le()&&fq.V(this.je)},d5(ck,"beforeunload",this.Ie,{capture:!1})}checkAndGetSessionAndWindowId(a,b){if(void 0===a&&(a=!1),void 0===b&&(b=null),"always"===this.C.cookieless_mode)throw Error('checkAndGetSessionAndWindowId should not be called with cookieless_mode="always"');var c=b||(new Date).getTime(),[d,e,f]=this.Be(),g=this.He(),h=cV(f)&&f>0&&Math.abs(c-f)>864e5,i=!1,j=!e,k=!j&&!a&&this.Re(c,d);j||k||h?(e=this.Fe(),g=this.Me(),h_.info("new session ID generated",{sessionId:e,windowId:g,changeReason:{noSessionId:j,activityTimeout:k,sessionPastMaximumLength:h}}),f=c,i=!0):g||(g=this.Me(),i=!0);var l=0===d||!a||h?c:d,m=0===f?(new Date).getTime():f;return this.ze(g),this.Ne(e,l,m),a||this.Ae(),i&&this.Te.forEach(a=>a(e,g,i?{noSessionId:j,activityTimeout:k,sessionPastMaximumLength:h}:void 0)),{sessionId:e,windowId:g,sessionStartTimestamp:m,changeReason:i?{noSessionId:j,activityTimeout:k,sessionPastMaximumLength:h}:void 0,lastActivityTimestamp:d}}Ae(){clearTimeout(this.qe),this.qe=setTimeout(()=>{var[a]=this.Be();if(this.Re((new Date).getTime(),a)){var b=this.Oe;this.resetSessionId(),this.Pe.emit("forcedIdleReset",{idleSessionId:b})}},1.1*this.sessionTimeoutMs)}}var h1=["$set_once","$set"],h2=dU("[SiteApps]");class h3{constructor(a){this._instance=a,this.We=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}Ge(a,b){if(b){var c=this.globalsForEvent(b);this.We.push(c),this.We.length>1e3&&(this.We=this.We.slice(10))}}get siteAppLoaders(){var a;return null==(a=cw._POSTHOG_REMOTE_CONFIG)||null==(a=a[this._instance.config.token])?void 0:a.siteApps}init(){if(this.isEnabled){var a=this._instance.Mi(this.Ge.bind(this));this.Ve=()=>{a(),this.We=[],this.Ve=void 0}}}globalsForEvent(a){if(!a)throw Error("Event payload is required");var b,c,d,e,f,g,h,i={},j=this._instance.get_property("$groups")||[];for(var[k,l]of Object.entries(this._instance.get_property("$stored_group_properties")||{}))i[k]={id:j[k],type:k,properties:l};var{$set_once:m,$set:n}=a;return{event:cA({},cB(a,h1),{properties:cA({},a.properties,n?{$set:cA({},null!=(b=null==(c=a.properties)?void 0:c.$set)?b:{},n)}:{},m?{$set_once:cA({},null!=(d=null==(e=a.properties)?void 0:e.$set_once)?d:{},m)}:{}),elements_chain:null!=(f=null==(g=a.properties)?void 0:g.$elements_chain)?f:"",distinct_id:null==(h=a.properties)?void 0:h.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:i}}setupSiteApp(a){var b=this.apps[a.id],c=()=>{var c;!b.errored&&this.We.length&&(h2.info("Processing "+this.We.length+" events for site app with id "+a.id),this.We.forEach(a=>null==b.processEvent?void 0:b.processEvent(a)),b.processedBuffer=!0),Object.values(this.apps).every(a=>a.processedBuffer||a.errored)&&(null==(c=this.Ve)||c.call(this))},d=!1,e=e=>{b.errored=!e,b.loaded=!0,h2.info("Site app with id "+a.id+" "+(e?"loaded":"errored")),d&&c()};try{var{processEvent:f}=a.init({posthog:this._instance,callback:a=>{e(a)}});f&&(b.processEvent=f),d=!0}catch(b){h2.error("Error while initializing PostHog app with config id "+a.id,b),e(!1)}if(d&&b.loaded)try{c()}catch(c){h2.error("Error while processing buffered events PostHog app with config id "+a.id,c),b.errored=!0}}Je(){var a=this.siteAppLoaders||[];for(var b of a)this.apps[b.id]={id:b.id,loaded:!1,errored:!1,processedBuffer:!1};for(var c of a)this.setupSiteApp(c)}Ke(a){if(0!==Object.keys(this.apps).length){var b=this.globalsForEvent(a);for(var c of Object.values(this.apps))try{null==c.processEvent||c.processEvent(b)}catch(b){h2.error("Error while processing event "+a.event+" for site app "+c.id,b)}}}onRemoteConfig(a){var b,c,d,e=this;if(null!=(b=this.siteAppLoaders)&&b.length)return this.isEnabled?(this.Je(),void this._instance.on("eventCaptured",a=>this.Ke(a))):void h2.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if(null==(c=this.Ve)||c.call(this),null!=(d=a.siteApps)&&d.length)if(this.isEnabled){var f=function(a){var b;cw["__$$ph_site_app_"+a]=e._instance,null==(b=cw.__PosthogExtensions__)||null==b.loadSiteApp||b.loadSiteApp(e._instance,h,b=>{if(b)return h2.error("Error while initializing PostHog app with config id "+a,b)})};for(var{id:g,url:h}of a.siteApps)f(g)}else h2.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var h4=function(a,b){if(!a)return!1;var c=a.userAgent;if(c&&cD(c,b))return!0;try{var d=null==a?void 0:a.userAgentData;if(null!=d&&d.brands&&d.brands.some(a=>cD(null==a?void 0:a.brand,b)))return!0}catch(a){}return!!a.webdriver},h5=((s={}).US="us",s.EU="eu",s.CUSTOM="custom",s),h6="i.posthog.com";class h7{constructor(a){this.Ye={},this.instance=a}get apiHost(){var a=this.instance.config.api_host.trim().replace(/\/$/,"");return"https://app.posthog.com"===a?"https://us.i.posthog.com":a}get flagsApiHost(){var a=this.instance.config.flags_api_host;return a?a.trim().replace(/\/$/,""):this.apiHost}get uiHost(){var a,b=null==(a=this.instance.config.ui_host)?void 0:a.replace(/\/$/,"");return b||(b=this.apiHost.replace("."+h6,".posthog.com")),"https://app.posthog.com"===b?"https://us.posthog.com":b}get region(){return this.Ye[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Ye[this.apiHost]=h5.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Ye[this.apiHost]=h5.EU:this.Ye[this.apiHost]=h5.CUSTOM),this.Ye[this.apiHost]}endpointFor(a,b){if(void 0===b&&(b=""),b&&(b="/"===b[0]?b:"/"+b),"ui"===a)return this.uiHost+b;if("flags"===a)return this.flagsApiHost+b;if(this.region===h5.CUSTOM)return this.apiHost+b;var c=h6+b;switch(a){case"assets":return"https://"+this.region+"-assets."+c;case"api":return"https://"+this.region+"."+c}}}var h8={icontains:(a,b)=>!!ck&&b.href.toLowerCase().indexOf(a.toLowerCase())>-1,not_icontains:(a,b)=>!!ck&&-1===b.href.toLowerCase().indexOf(a.toLowerCase()),regex:(a,b)=>!!ck&&hn(b.href,a),not_regex:(a,b)=>!!ck&&!hn(b.href,a),exact:(a,b)=>b.href===a,is_not:(a,b)=>b.href!==a};class h9{constructor(a){var b=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(a){void 0===a&&(a=!1),b.getWebExperiments(a=>{h9.Xe("retrieved web experiments from the server"),b.Qe=new Map,a.forEach(a=>{if(a.feature_flag_key){b.Qe&&(h9.Xe("setting flag key ",a.feature_flag_key," to web experiment ",a),null==(c=b.Qe)||c.set(a.feature_flag_key,a));var c,d=b._instance.getFeatureFlag(a.feature_flag_key);cR(d)&&a.variants[d]&&b.Ze(a.name,d,a.variants[d].transforms)}else if(a.variants)for(var e in a.variants){var f=a.variants[e];h9.tr(f)&&b.Ze(a.name,e,f.transforms)}})},a)},this._instance=a,this._instance.onFeatureFlags(a=>{this.onFeatureFlags(a)})}onFeatureFlags(a){if(this._is_bot())h9.Xe("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(cU(this.Qe))return this.Qe=new Map,this.loadIfEnabled(),void this.previewWebExperiment();h9.Xe("applying feature flags",a),a.forEach(a=>{var b;if(this.Qe&&null!=(b=this.Qe)&&b.has(a)){var c,d=this._instance.getFeatureFlag(a),e=null==(c=this.Qe)?void 0:c.get(a);d&&null!=e&&e.variants[d]&&this.Ze(e.name,d,e.variants[d].transforms)}})}}previewWebExperiment(){var a=h9.getWindowLocation();if(null!=a&&a.search){var b=e1(null==a?void 0:a.search,"__experiment_id"),c=e1(null==a?void 0:a.search,"__experiment_variant");b&&c&&(h9.Xe("previewing web experiments "+b+" && "+c),this.getWebExperiments(a=>{this.ir(parseInt(b),c,a)},!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(a,b,c){if(this._instance.config.disable_web_experiments&&!c)return a([]);var d=this._instance.get_property("$web_experiments");if(d&&!b)return a(d);this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:b=>200===b.statusCode&&b.json?a(b.json.experiments||[]):a([])})}ir(a,b,c){var d=c.filter(b=>b.id===a);d&&d.length>0&&(h9.Xe("Previewing web experiment ["+d[0].name+"] with variant ["+b+"]"),this.Ze(d[0].name,b,d[0].variants[b].transforms))}static tr(a){return!cU(a.conditions)&&h9.er(a)&&h9.rr(a)}static er(a){if(cU(a.conditions)||cU(null==(b=a.conditions)?void 0:b.url))return!0;var b,c,d,e,f=h9.getWindowLocation();return!!f&&(null==(c=a.conditions)||!c.url||h8[null!=(d=null==(e=a.conditions)?void 0:e.urlMatchType)?d:"icontains"](a.conditions.url,f))}static getWindowLocation(){return null==ck?void 0:ck.location}static rr(a){if(cU(a.conditions)||cU(null==(c=a.conditions)?void 0:c.utm))return!0;var b=gy();if(b.utm_source){var c,d,e,f,g,h,i,j,k,l=null==(d=a.conditions)||null==(d=d.utm)||!d.utm_campaign||(null==(e=a.conditions)||null==(e=e.utm)?void 0:e.utm_campaign)==b.utm_campaign,m=null==(f=a.conditions)||null==(f=f.utm)||!f.utm_source||(null==(g=a.conditions)||null==(g=g.utm)?void 0:g.utm_source)==b.utm_source,n=null==(h=a.conditions)||null==(h=h.utm)||!h.utm_medium||(null==(i=a.conditions)||null==(i=i.utm)?void 0:i.utm_medium)==b.utm_medium,o=null==(j=a.conditions)||null==(j=j.utm)||!j.utm_term||(null==(k=a.conditions)||null==(k=k.utm)?void 0:k.utm_term)==b.utm_term;return l&&n&&o&&m}return!1}static Xe(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];dT.info("[WebExperiments] "+a,c)}Ze(a,b,c){this._is_bot()?h9.Xe("Refusing to render web experiment since the viewer is a likely bot"):"control"!==b?c.forEach(c=>{if(c.selector){h9.Xe("applying transform of variant "+b+" for experiment "+a+" ",c);var d,e=null==(d=document)?void 0:d.querySelectorAll(c.selector);null==e||e.forEach(a=>{c.html&&(a.innerHTML=c.html),c.css&&a.setAttribute("style",c.css)})}}):h9.Xe("Control variants leave the page unmodified.")}_is_bot(){return cp&&this._instance?h4(cp,this._instance.config.custom_blocked_useragents):void 0}}var ia=dU("[PostHog ExternalIntegrations]"),ib={intercom:"intercom-integration",crispChat:"crisp-chat-integration"};class ic{constructor(a){this._instance=a}it(a,b){var c;null==(c=cw.__PosthogExtensions__)||null==c.loadExternalDependency||c.loadExternalDependency(this._instance,a,a=>{if(a)return ia.error("failed to load script",a);b()})}startIfEnabledOrStop(){var a,b=this,c=function(a){var c,d,f;!e||null!=(c=cw.__PosthogExtensions__)&&null!=(c=c.integrations)&&c[a]||b.it(ib[a],()=>{var c;null==(c=cw.__PosthogExtensions__)||null==(c=c.integrations)||null==(c=c[a])||c.start(b._instance)}),!e&&null!=(d=cw.__PosthogExtensions__)&&null!=(d=d.integrations)&&d[a]&&(null==(f=cw.__PosthogExtensions__)||null==(f=f.integrations)||null==(f=f[a])||f.stop())};for(var[d,e]of Object.entries(null!=(a=this._instance.config.integrations)?a:{}))c(d)}}var id="[SessionRecording]",ie=dU(id);class ig{get started(){var a;return!(null==(a=this.sr)||!a.isStarted)}get status(){return this.sr?this.sr.status:this.nr&&!this.ar?"disabled":"lazy_loading"}constructor(a){if(this._forceAllowLocalhostNetworkCapture=!1,this.nr=!1,this.lr=void 0,this._instance=a,!this._instance.sessionManager)throw ie.error("started without valid sessionManager"),Error(id+" started without valid sessionManager. This is a bug.");if("always"===this._instance.config.cookieless_mode)throw Error(id+' cannot be used with cookieless_mode="always"')}get ar(){var a,b=!(null==(a=this._instance.get_property(eh))||!a.enabled),c=!this._instance.config.disable_session_recording,d=this._instance.config.disable_session_recording||this._instance.consent.isOptedOut();return ck&&b&&c&&!d}startIfEnabledOrStop(a){var b;if(!this.ar||null==(b=this.sr)||!b.isStarted){var c=!cQ(Object.assign)&&!cQ(Array.from);this.ar&&c?(this.ur(a),ie.info("starting")):this.stopRecording()}}ur(a){var b,c,d;this.ar&&(null!=cw&&null!=(b=cw.__PosthogExtensions__)&&null!=(b=b.rrweb)&&b.record&&null!=(c=cw.__PosthogExtensions__)&&c.initSessionRecording?this.hr(a):null==(d=cw.__PosthogExtensions__)||null==d.loadExternalDependency||d.loadExternalDependency(this._instance,this.dr,b=>{if(b)return ie.error("could not load recorder",b);this.hr(a)}))}stopRecording(){var a,b;null==(a=this.lr)||a.call(this),this.lr=void 0,null==(b=this.sr)||b.stop()}vr(){var a;null==(a=this._instance.persistence)||a.unregister(ej)}cr(a){if(this._instance.persistence){var b,c,d=this._instance.persistence,e=()=>{var b=!1===a.sessionRecording?void 0:a.sessionRecording,c=null==b?void 0:b.sampleRate,e=cU(c)?null:parseFloat(c);cU(e)&&this.vr();var f=null==b?void 0:b.minimumDurationMilliseconds;d.register({[eh]:cA({enabled:!!b},b,{networkPayloadCapture:cA({capturePerformance:a.capturePerformance},null==b?void 0:b.networkPayloadCapture),canvasRecording:{enabled:null==b?void 0:b.recordCanvas,fps:null==b?void 0:b.canvasFps,quality:null==b?void 0:b.canvasQuality},sampleRate:e,minimumDurationMilliseconds:cQ(f)?null:f,endpoint:null==b?void 0:b.endpoint,triggerMatchType:null==b?void 0:b.triggerMatchType,masking:null==b?void 0:b.masking,urlTriggers:null==b?void 0:b.urlTriggers})})};e(),null==(b=this.lr)||b.call(this),this.lr=null==(c=this._instance.sessionManager)?void 0:c.onSessionId(e)}}onRemoteConfig(a){"sessionRecording"in a?!1!==a.sessionRecording?(this.cr(a),this.nr=!0,this.startIfEnabledOrStop()):this.nr=!0:ie.info("skipping remote config with no sessionRecording",a)}log(a,b){var c;void 0===b&&(b="log"),null!=(c=this.sr)&&c.log?this.sr.log(a,b):ie.warn("log called before recorder was ready")}get dr(){var a,b,c=null==(a=this._instance)||null==(a=a.persistence)?void 0:a.get_property(eh);return(null==c||null==(b=c.scriptConfig)?void 0:b.script)||"lazy-recorder"}hr(a){var b,c;if(null==(b=cw.__PosthogExtensions__)||!b.initSessionRecording)throw Error("Called on script loaded before session recording is available");this.sr||(this.sr=null==(c=cw.__PosthogExtensions__)?void 0:c.initSessionRecording(this._instance),this.sr._forceAllowLocalhostNetworkCapture=this._forceAllowLocalhostNetworkCapture),this.sr.start(a)}onRRwebEmit(a){var b;null==(b=this.sr)||null==b.onRRwebEmit||b.onRRwebEmit(a)}overrideLinkedFlag(){var a,b;this.sr||null==(b=this._instance.persistence)||b.register({$replay_override_linked_flag:!0}),null==(a=this.sr)||a.overrideLinkedFlag()}overrideSampling(){var a,b;this.sr||null==(b=this._instance.persistence)||b.register({$replay_override_sampling:!0}),null==(a=this.sr)||a.overrideSampling()}overrideTrigger(a){var b,c;this.sr||null==(c=this._instance.persistence)||c.register({["url"===a?"$replay_override_url_trigger":"$replay_override_event_trigger"]:!0}),null==(b=this.sr)||b.overrideTrigger(a)}get sdkDebugProperties(){var a;return(null==(a=this.sr)?void 0:a.sdkDebugProperties)||{$recording_status:this.status}}tryAddCustomEvent(a,b){var c;return!(null==(c=this.sr)||!c.tryAddCustomEvent(a,b))}}var ih={},ii=()=>{},ij="posthog",ik=!hh&&-1===(null==cv?void 0:cv.indexOf("MSIE"))&&-1===(null==cv?void 0:cv.indexOf("Mozilla")),il=a=>{var b;return{api_host:"https://us.i.posthog.com",flags_api_host:null,ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:function(a){var b=null==a?void 0:a.hostname;if(!cR(b))return!1;var c=b.split(".").slice(-2).join(".");for(var d of d3)if(c===d)return!1;return!0}(null==cq?void 0:cq.location),persistence:"localStorage+cookie",persistence_name:"",loaded:ii,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:"2025-05-24"!==a||"history_change",capture_pageleave:"if_capture_pageview",defaults:null!=a?a:"unset",__preview_deferred_init_extensions:!1,debug:cr&&cR(null==cr?void 0:cr.search)&&-1!==cr.search.indexOf("__posthog_debug=true")||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_surveys_automatic_display:!1,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==ck||null==(b=ck.location)?void 0:b.protocol),ip:!1,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",consent_persistence_name:null,opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_flags:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_only_evaluate_survey_feature_flags:!1,advanced_enable_surveys:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:a=>{var b="Bad HTTP status: "+a.statusCode+" "+a.text;dT.error(b)},get_device_id:a=>a,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:3e3},error_tracking:{},_onCapture:ii,__preview_eager_load_replay:!1}},im=a=>{var b={};cQ(a.process_person)||(b.person_profiles=a.process_person),cQ(a.xhr_headers)||(b.request_headers=a.xhr_headers),cQ(a.cookie_name)||(b.persistence_name=a.cookie_name),cQ(a.disable_cookie)||(b.disable_persistence=a.disable_cookie),cQ(a.store_google)||(b.save_campaign_params=a.store_google),cQ(a.verbose)||(b.debug=a.verbose);var c=d$({},b,a);return cM(a.property_blacklist)&&(cQ(a.property_denylist)?c.property_denylist=a.property_blacklist:cM(a.property_denylist)?c.property_denylist=[...a.property_blacklist,...a.property_denylist]:dT.error("Invalid value for property_denylist config: "+a.property_denylist)),c};class io{constructor(){this.__forceAllowLocalhost=!1}get pr(){return this.__forceAllowLocalhost}set pr(a){dT.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=a}}class ip{get decideEndpointWasHit(){var a,b;return null!=(a=null==(b=this.featureFlags)?void 0:b.hasLoadedFlags)&&a}get flagsEndpointWasHit(){var a,b;return null!=(a=null==(b=this.featureFlags)?void 0:b.hasLoadedFlags)&&a}constructor(){this.webPerformance=new io,this.gr=!1,this.version=cx.LIB_VERSION,this._r=new hI,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=il(),this.SentryIntegration=fD,this.sentryIntegration=a=>{var b;return b=fC(this,a),{name:fB,processEvent:a=>b(a)}},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.mr=!1,this.yr=null,this.br=null,this.wr=null,this.featureFlags=new hB(this),this.toolbar=new fG(this),this.scrollManager=new hY(this),this.pageViewManager=new gL(this),this.surveys=new hQ(this),this.experiments=new h9(this),this.exceptions=new hs(this),this.rateLimiter=new hS(this),this.requestRouter=new h7(this),this.consent=new fs(this),this.externalIntegrations=new ic(this),this.people={set:(a,b,c)=>{var d=cR(a)?{[a]:b}:a;this.setPersonProperties(d),null==c||c({})},set_once:(a,b,c)=>{var d=cR(a)?{[a]:b}:a;this.setPersonProperties(void 0,d),null==c||c({})}},this.on("eventCaptured",a=>dT.info('send "'+(null==a?void 0:a.event)+'"',a))}init(a,b,c){if(c&&c!==ij){var d,e=null!=(d=ih[c])?d:new ip;return e._init(a,b,c),ih[c]=e,ih[ij][c]=e,e}return this._init(a,b,c)}_init(a,b,c){if(void 0===b&&(b={}),cQ(a)||cS(a))return dT.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return console.warn("[PostHog.js]","You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},b.debug=this.$r(b.debug),this.Sr=b,this.Er=[],b.person_profiles&&(this.br=b.person_profiles),this.set_config(d$({},il(b.defaults),im(b),{name:c,token:a})),this.config.on_xhr_error&&dT.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=b.disable_compression?void 0:e$.GZipJS;var d=this.kr();this.persistence=new hD(this.config,d),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new hD(cA({},this.config,{persistence:"sessionStorage"}),d);var e=cA({},this.persistence.props),f=cA({},this.sessionPersistence.props);this.register({$initialization_time:(new Date).toISOString()}),this.Pr=new hV(a=>this.Tr(a),this.config.request_queue_config),this.Ir=new hX(this),this.__request_queue=[];var g="always"===this.config.cookieless_mode||"on_reject"===this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut();if(g||(this.sessionManager=new h0(this),this.sessionPropsManager=new h$(this,this.sessionManager,this.persistence)),this.config.__preview_deferred_init_extensions?(dT.info("Deferring extension initialization to improve startup performance"),setTimeout(()=>{this.Rr(g)},0)):(dT.info("Initializing extensions synchronously"),this.Rr(g)),cx.DEBUG=cx.DEBUG||this.config.debug,cx.DEBUG&&dT.info("Starting in debug mode",{this:this,config:b,thisC:cA({},this.config),p:e,s:f}),void 0!==(null==(h=b.bootstrap)?void 0:h.distinctID)){var h,i,j,k=this.config.get_device_id(fe()),l=null!=(i=b.bootstrap)&&i.isIdentifiedID?k:b.bootstrap.distinctID;this.persistence.set_property(es,null!=(j=b.bootstrap)&&j.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:b.bootstrap.distinctID,$device_id:l})}if(this.Cr()){var m,n,o=Object.keys((null==(m=b.bootstrap)?void 0:m.featureFlags)||{}).filter(a=>{var c;return!(null==(c=b.bootstrap)||null==(c=c.featureFlags)||!c[a])}).reduce((a,c)=>{var d;return a[c]=(null==(d=b.bootstrap)||null==(d=d.featureFlags)?void 0:d[c])||!1,a},{}),p=Object.keys((null==(n=b.bootstrap)?void 0:n.featureFlagPayloads)||{}).filter(a=>o[a]).reduce((a,c)=>{var d,e;return null!=(d=b.bootstrap)&&null!=(d=d.featureFlagPayloads)&&d[c]&&(a[c]=null==(e=b.bootstrap)||null==(e=e.featureFlagPayloads)?void 0:e[c]),a},{});this.featureFlags.receivedFeatureFlags({featureFlags:o,featureFlagPayloads:p})}if(g)this.register_once({distinct_id:eA,$device_id:null},"");else if(!this.get_distinct_id()){var q=this.config.get_device_id(fe());this.register_once({distinct_id:q,$device_id:q},""),this.persistence.set_property(es,"anonymous")}return d5(ck,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),b.segment?function(a,b){var c=a.config.segment;if(!c)return b();!function(a,b){var c=a.config.segment;if(!c)return b();var d=c=>{var d=()=>c.anonymousId()||fe();a.config.get_device_id=d,c.id()&&(a.register({distinct_id:c.id(),$device_id:d()}),a.persistence.set_property(es,"identified")),b()},e=c.user();"then"in e&&cN(e.then)?e.then(a=>d(a)):d(e)}(a,()=>{var d;c.register((Promise&&Promise.resolve||fA.warn("This browser does not have Promise support, and can not use the segment integration"),d=(b,c)=>{if(!c)return b;b.event.userId||b.event.anonymousId===a.get_distinct_id()||(fA.info("No userId set, resetting PostHog"),a.reset()),b.event.userId&&b.event.userId!==a.get_distinct_id()&&(fA.info("UserId set, identifying with PostHog"),a.identify(b.event.userId));var d=a.calculateEventProperties(c,b.event.properties);return b.event.properties=Object.assign({},d,b.event.properties),b},{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:a=>d(a,a.event.event),page:a=>d(a,"$pageview"),identify:a=>d(a,"$identify"),screen:a=>d(a,"$screen")})).then(()=>{b()})})}(this,()=>this.Or()):this.Or(),cN(this.config._onCapture)&&this.config._onCapture!==ii&&(dT.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",a=>this.config._onCapture(a.event,a))),this.config.ip&&dT.warn('The `ip` config option has NO EFFECT AT ALL and has been deprecated. Use a custom transformation or "Discard IP data" project setting instead. See https://posthog.com/tutorials/web-redact-properties#hiding-customer-ip-address for more information.'),this}Rr(a){var b=performance.now();this.historyAutocapture=new fz(this),this.historyAutocapture.startIfEnabled();var c=[];c.push(()=>{new fI(this).startIfEnabledOrStop()}),c.push(()=>{var a;this.siteApps=new h3(this),null==(a=this.siteApps)||a.init()}),a||c.push(()=>{this.sessionRecording=new ig(this),this.sessionRecording.startIfEnabledOrStop()}),this.config.disable_scroll_properties||c.push(()=>{this.scrollManager.startMeasuringScrollPosition()}),c.push(()=>{this.autocapture=new e6(this),this.autocapture.startIfEnabled()}),c.push(()=>{this.surveys.loadIfEnabled()}),c.push(()=>{this.heatmaps=new gK(this),this.heatmaps.startIfEnabled()}),c.push(()=>{this.webVitalsAutocapture=new gH(this)}),c.push(()=>{this.exceptionObserver=new fy(this),this.exceptionObserver.startIfEnabled()}),c.push(()=>{this.deadClicksAutocapture=new fw(this,fv),this.deadClicksAutocapture.startIfEnabled()}),c.push(()=>{if(this.Fr){var a=this.Fr;this.Fr=void 0,this.fi(a)}}),this.Mr(c,b)}Mr(a,b){for(;a.length>0;){if(this.config.__preview_deferred_init_extensions&&performance.now()-b>=30&&a.length>0)return void setTimeout(()=>{this.Mr(a,b)},0);var c=a.shift();if(c)try{c()}catch(a){dT.error("Error initializing extension:",a)}}var d=Math.round(performance.now()-b);this.register_for_session({$sdk_debug_extensions_init_method:this.config.__preview_deferred_init_extensions?"deferred":"synchronous",$sdk_debug_extensions_init_time_ms:d}),this.config.__preview_deferred_init_extensions&&dT.info("PostHog extensions initialized ("+d+"ms)")}fi(a){var b,c,d,e,f,g,h,i;cq&&cq.body?(this.config.__preview_deferred_init_extensions&&(this.Fr=a),this.compression=void 0,a.supportedCompression&&!this.config.disable_compression&&(this.compression=cF(a.supportedCompression,e$.GZipJS)?e$.GZipJS:cF(a.supportedCompression,e$.Base64)?e$.Base64:void 0),null!=(b=a.analytics)&&b.endpoint&&(this.analyticsDefaultEndpoint=a.analytics.endpoint),this.set_config({person_profiles:this.br?this.br:"identified_only"}),null==(c=this.siteApps)||c.onRemoteConfig(a),null==(d=this.sessionRecording)||d.onRemoteConfig(a),null==(e=this.autocapture)||e.onRemoteConfig(a),null==(f=this.heatmaps)||f.onRemoteConfig(a),this.surveys.onRemoteConfig(a),null==(g=this.webVitalsAutocapture)||g.onRemoteConfig(a),null==(h=this.exceptionObserver)||h.onRemoteConfig(a),this.exceptions.onRemoteConfig(a),null==(i=this.deadClicksAutocapture)||i.onRemoteConfig(a)):(dT.info("document not ready yet, trying again in 500 milliseconds..."),setTimeout(()=>{this.fi(a)},500))}Or(){try{this.config.loaded(this)}catch(a){dT.critical("`loaded` function failed",a)}this.Ar(),this.config.capture_pageview&&setTimeout(()=>{(this.consent.isOptedIn()||"always"===this.config.cookieless_mode)&&this.Dr()},1),new hU(this).load(),this.featureFlags.flags()}Ar(){var a;this.is_capturing()&&this.config.request_batching&&(null==(a=this.Pr)||a.enable())}_dom_loaded(){this.is_capturing()&&dY(this.__request_queue,a=>this.Tr(a)),this.__request_queue=[],this.Ar()}_handle_unload(){var a,b;this.config.request_batching?(this.jr()&&this.capture("$pageleave"),null==(a=this.Pr)||a.unload(),null==(b=this.Ir)||b.unload()):this.jr()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}ci(a){this.__loaded&&(ik?this.__request_queue.push(a):this.rateLimiter.isServerRateLimited(a.batchKey)||(a.transport=a.transport||this.config.api_transport,a.url=hj(a.url,{ip:+!!this.config.ip}),a.headers=cA({},this.config.request_headers),a.compression="best-available"===a.compression?this.compression:a.compression,a.disableXHRCredentials=this.config.__preview_disable_xhr_credentials,this.config.__preview_disable_beacon&&(a.disableTransport=["sendBeacon"]),a.fetchOptions=a.fetchOptions||this.config.fetch_options,(a=>{var b,c,d,e=cA({},a);e.timeout=e.timeout||6e4,e.url=hj(e.url,{_:(new Date).getTime().toString(),ver:cx.LIB_VERSION,compression:e.compression});var f=null!=(b=e.transport)?b:"fetch",g=hm.filter(a=>!e.disableTransport||!a.transport||!e.disableTransport.includes(a.transport)),h=null!=(c=null==(d=d4(g,a=>a.transport===f))?void 0:d.method)?c:g[0].method;if(!h)throw Error("No available transport method");h(e)})(cA({},a,{callback:b=>{var c,d;this.rateLimiter.checkForLimiting(b),b.statusCode>=400&&(null==(c=(d=this.config).on_request_error)||c.call(d,b)),null==a.callback||a.callback(b)}}))))}Tr(a){this.Ir?this.Ir.retriableRequest(a):this.ci(a)}_execute_array(a){var b,c=[],d=[],e=[];dY(a,a=>{a&&(cM(b=a[0])?e.push(a):cN(a)?a.call(this):cM(a)&&"alias"===b?c.push(a):cM(a)&&-1!==b.indexOf("capture")&&cN(this[b])?e.push(a):d.push(a))});var f=function(a,b){dY(a,function(a){if(cM(a[0])){var c=b;dZ(a,function(a){c=c[a[0]].apply(c,a.slice(1))})}else this[a[0]].apply(this,a.slice(1))},b)};f(c,this),f(d,this),f(e,this)}Cr(){var a,b;return(null==(a=this.config.bootstrap)?void 0:a.featureFlags)&&Object.keys(null==(b=this.config.bootstrap)?void 0:b.featureFlags).length>0||!1}push(a){this._execute_array([a])}capture(a,b,c){var d;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.Pr){if(this.is_capturing())if(!cQ(a)&&cR(a)){var e=!this.config.opt_out_useragent_filter&&this._is_bot();if(!(e&&!this.config.__preview_capture_bot_pageviews)){var f=null!=c&&c.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==f||!f.isRateLimited){null!=b&&b.$current_url&&!cR(null==b?void 0:b.$current_url)&&(dT.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),null==b||delete b.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var g=new Date,h=(null==c?void 0:c.timestamp)||g,i=fe(),j={uuid:i,event:a,properties:this.calculateEventProperties(a,b||{},h,i)};"$pageview"===a&&this.config.__preview_capture_bot_pageviews&&e&&(j.event="$bot_pageview",j.properties.$browser_type="bot"),f&&(j.properties.$lib_rate_limit_remaining_tokens=f.remainingTokens),(null==c?void 0:c.$set)&&(j.$set=null==c?void 0:c.$set);var k,l=this.Lr(null==c?void 0:c.$set_once);if(l&&(j.$set_once=l),(m=j,n=null!=c&&c._noTruncate?null:this.config.properties_string_max_length,o=a=>cR(a)&&!cT(n)?a.slice(0,n):a,p=new Set,j=function a(b,c){var d;return b!==Object(b)?o?o(b,c):b:p.has(b)?void 0:(p.add(b),cM(b)?(d=[],dY(b,b=>{d.push(a(b))})):(d={},dZ(b,(b,c)=>{p.has(b)||(d[c]=a(b,c))})),d)}(m)).timestamp=h,cQ(null==c?void 0:c.timestamp)||(j.properties.$event_time_override_provided=!0,j.properties.$event_time_override_system_time=g),a===hF.DISMISSED||a===hF.SENT){var m,n,o,p,q,r,s,t=null==b?void 0:b[hG.SURVEY_ID],u=null==b?void 0:b[hG.SURVEY_ITERATION];k={id:t,current_iteration:u},localStorage.getItem(hM(k))||localStorage.setItem(hM(k),"true"),j.$set=cA({},j.$set,{[(q={id:t,current_iteration:u},s="$survey_"+(r=a===hF.SENT?"responded":"dismissed")+"/"+q.id,q.current_iteration&&q.current_iteration>0&&(s="$survey_"+r+"/"+q.id+"/"+q.current_iteration),s)]:!0})}var v=cA({},j.properties.$set,j.$set);if(cP(v)||this.setPersonPropertiesForFlags(v),!cU(this.config.before_send)){var w=this.Nr(j);if(!w)return;j=w}this._r.emit("eventCaptured",j);var x={method:"POST",url:null!=(d=null==c?void 0:c._url)?d:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:j,compression:"best-available",batchKey:null==c?void 0:c._batchKey};return!this.config.request_batching||c&&(null==c||!c._batchKey)||null!=c&&c.send_instantly?this.Tr(x):this.Pr.enqueue(x),j}dT.critical("This capture call is ignored due to client rate limiting.")}}else dT.error("No event name provided to posthog.capture")}else dT.uninitializedWarning("posthog.capture")}Mi(a){return this.on("eventCaptured",b=>a(b.event,b))}calculateEventProperties(a,b,c,d,e){if(c=c||new Date,!this.persistence||!this.sessionPersistence)return b;var f,g=e?void 0:this.persistence.remove_event_timer(a),h=cA({},b);if(h.token=this.config.token,h.$config_defaults=this.config.defaults,("always"==this.config.cookieless_mode||"on_reject"==this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut())&&(h.$cookieless_mode=!0),"$snapshot"===a){var i=cA({},this.persistence.properties(),this.sessionPersistence.properties());return h.distinct_id=i.distinct_id,(!cR(h.distinct_id)&&!cV(h.distinct_id)||cS(h.distinct_id))&&dT.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),h}var j,k=function(a,b){if(!cv)return{};var c,d,e=a?d_([],gu,b||[]):[],[f,g]=function(a){for(var b=0;b<gr.length;b++){var[c,d]=gr[b],e=c.exec(a),f=e&&(cN(d)?d(e,a):d);if(f)return f}return["",""]}(cv);return d$(d2({$os:f,$os_version:g,$browser:go(cv,navigator.vendor),$device:gs(cv),$device_type:(d=gs(cv))===fN||d===fM||"Kobo"===d||"Kindle Fire"===d||d===gf?fL:d===f4||d===f6||d===f5||d===gc?"Console":d===fP?"Wearable":d?fJ:"Desktop",$timezone:gF(),$timezone_offset:function(){try{return(new Date).getTimezoneOffset()}catch(a){return}}()}),{$current_url:e2(null==cr?void 0:cr.href,e,gw),$host:null==cr?void 0:cr.host,$pathname:null==cr?void 0:cr.pathname,$raw_user_agent:cv.length>1e3?cv.substring(0,997)+"...":cv,$browser_version:gq(cv,navigator.vendor),$browser_language:gB(),$browser_language_prefix:"string"==typeof(c=gB())?c.split("-")[0]:void 0,$screen_height:null==ck?void 0:ck.screen.height,$screen_width:null==ck?void 0:ck.screen.width,$viewport_height:null==ck?void 0:ck.innerHeight,$viewport_width:null==ck?void 0:ck.innerWidth,$lib:"web",$lib_version:cx.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:l,windowId:m}=this.sessionManager.checkAndGetSessionAndWindowId(e,c.getTime());h.$session_id=l,h.$window_id=m}this.sessionPropsManager&&d$(h,this.sessionPropsManager.getSessionProps());try{this.sessionRecording&&d$(h,this.sessionRecording.sdkDebugProperties),h.$sdk_debug_retry_queue_size=null==(f=this.Ir)?void 0:f.length}catch(a){h.$sdk_debug_error_capturing_properties=String(a)}if(this.requestRouter.region===h5.CUSTOM&&(h.$lib_custom_api_host=this.config.api_host),j="$pageview"!==a||e?"$pageleave"!==a||e?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(c):this.pageViewManager.doPageView(c,d),h=d$(h,j),"$pageview"===a&&cq&&(h.title=cq.title),!cQ(g)){var n=c.getTime()-g;h.$duration=parseFloat((n/1e3).toFixed(3))}cv&&this.config.opt_out_useragent_filter&&(h.$browser_type=this._is_bot()?"bot":"browser"),(h=d$({},k,this.persistence.properties(),this.sessionPersistence.properties(),h)).$is_identified=this._isIdentified(),cM(this.config.property_denylist)?dZ(this.config.property_denylist,function(a){delete h[a]}):dT.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var o=this.config.sanitize_properties;o&&(dT.error("sanitize_properties is deprecated. Use before_send instead"),h=o(h,a));var p=this.Ur();return h.$process_person_profile=p,p&&!e&&this.zr("_calculate_event_properties"),h}Lr(a){if(!this.persistence||!this.Ur()||this.gr)return a;var b,c=d$({},this.persistence.get_initial_props(),(null==(b=this.sessionPropsManager)?void 0:b.getSetOnceProps())||{},a||{}),d=this.config.sanitize_properties;return d&&(dT.error("sanitize_properties is deprecated. Use before_send instead"),c=d(c,"$set_once")),this.gr=!0,cP(c)?void 0:c}register(a,b){var c;null==(c=this.persistence)||c.register(a,b)}register_once(a,b,c){var d;null==(d=this.persistence)||d.register_once(a,b,c)}register_for_session(a){var b;null==(b=this.sessionPersistence)||b.register(a)}unregister(a){var b;null==(b=this.persistence)||b.unregister(a)}unregister_for_session(a){var b;null==(b=this.sessionPersistence)||b.unregister(a)}Hr(a,b){this.register({[a]:b})}getFeatureFlag(a,b){return this.featureFlags.getFeatureFlag(a,b)}getFeatureFlagPayload(a){var b=this.featureFlags.getFeatureFlagPayload(a);try{return JSON.parse(b)}catch(a){return b}}isFeatureEnabled(a,b){return this.featureFlags.isFeatureEnabled(a,b)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateEarlyAccessFeatureEnrollment(a,b,c){this.featureFlags.updateEarlyAccessFeatureEnrollment(a,b,c)}getEarlyAccessFeatures(a,b,c){return void 0===b&&(b=!1),this.featureFlags.getEarlyAccessFeatures(a,b,c)}on(a,b){return this._r.on(a,b)}onFeatureFlags(a){return this.featureFlags.onFeatureFlags(a)}onSurveysLoaded(a){return this.surveys.onSurveysLoaded(a)}onSessionId(a){var b,c;return null!=(b=null==(c=this.sessionManager)?void 0:c.onSessionId(a))?b:()=>{}}getSurveys(a,b){void 0===b&&(b=!1),this.surveys.getSurveys(a,b)}getActiveMatchingSurveys(a,b){void 0===b&&(b=!1),this.surveys.getActiveMatchingSurveys(a,b)}renderSurvey(a,b){this.surveys.renderSurvey(a,b)}displaySurvey(a,b){void 0===b&&(b=hO),this.surveys.displaySurvey(a,b)}canRenderSurvey(a){return this.surveys.canRenderSurvey(a)}canRenderSurveyAsync(a,b){return void 0===b&&(b=!1),this.surveys.canRenderSurveyAsync(a,b)}identify(a,b,c){if(!this.__loaded||!this.persistence)return dT.uninitializedWarning("posthog.identify");if(cV(a)&&(a=a.toString(),dT.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),a)if(["distinct_id","distinctid"].includes(a.toLowerCase()))dT.critical('The string "'+a+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(a!==eA){if(this.zr("posthog.identify")){var d=this.get_distinct_id();this.register({$user_id:a}),this.get_property("$device_id")||this.register_once({$had_persisted_distinct_id:!0,$device_id:d},""),a!==d&&a!==this.get_property(d7)&&(this.unregister(d7),this.register({distinct_id:a}));var e="anonymous"===(this.persistence.get_property(es)||"anonymous");a!==d&&e?(this.persistence.set_property(es,"identified"),this.setPersonPropertiesForFlags(cA({},c||{},b||{}),!1),this.capture("$identify",{distinct_id:a,$anon_distinct_id:d},{$set:b||{},$set_once:c||{}}),this.wr=ho(a,b,c),this.featureFlags.setAnonymousDistinctId(d)):(b||c)&&this.setPersonProperties(b,c),a!==d&&(this.reloadFeatureFlags(),this.unregister(er))}}else dT.critical('The string "'+eA+'" was set in posthog.identify which indicates an error. This ID is only used as a sentinel value.');else dT.error("Unique user id has not been set in posthog.identify")}setPersonProperties(a,b){if((a||b)&&this.zr("posthog.setPersonProperties")){var c=ho(this.get_distinct_id(),a,b);this.wr!==c?(this.setPersonPropertiesForFlags(cA({},b||{},a||{})),this.capture("$set",{$set:a||{},$set_once:b||{}}),this.wr=c):dT.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(a,b,c){if(a&&b){if(this.zr("posthog.group")){var d=this.getGroups();d[a]!==b&&this.resetGroupPropertiesForFlags(a),this.register({$groups:cA({},d,{[a]:b})}),c&&(this.capture("$groupidentify",{$group_type:a,$group_key:b,$group_set:c}),this.setGroupPropertiesForFlags({[a]:c})),d[a]===b||c||this.reloadFeatureFlags()}}else dT.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(a,b){void 0===b&&(b=!0),this.featureFlags.setPersonPropertiesForFlags(a,b)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(a,b){void 0===b&&(b=!0),this.zr("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(a,b)}resetGroupPropertiesForFlags(a){this.featureFlags.resetGroupPropertiesForFlags(a)}reset(a){if(dT.info("reset"),!this.__loaded)return dT.uninitializedWarning("posthog.reset");var b,c,d,e,f=this.get_property("$device_id");if(this.consent.reset(),null==(b=this.persistence)||b.clear(),null==(c=this.sessionPersistence)||c.clear(),this.surveys.reset(),this.featureFlags.reset(),null==(d=this.persistence)||d.set_property(es,"anonymous"),null==(e=this.sessionManager)||e.resetSessionId(),this.wr=null,"always"===this.config.cookieless_mode)this.register_once({distinct_id:eA,$device_id:null},"");else{var g=this.config.get_device_id(fe());this.register_once({distinct_id:g,$device_id:a?g:f},"")}this.register({$last_posthog_reset:(new Date).toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var a,b;return null!=(a=null==(b=this.sessionManager)?void 0:b.checkAndGetSessionAndWindowId(!0).sessionId)?a:""}get_session_replay_url(a){if(!this.sessionManager)return"";var{sessionId:b,sessionStartTimestamp:c}=this.sessionManager.checkAndGetSessionAndWindowId(!0),d=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+b);if(null!=a&&a.withTimestamp&&c){var e,f=null!=(e=a.timestampLookBack)?e:10;if(!c)return d;d+="?t="+Math.max(Math.floor(((new Date).getTime()-c)/1e3)-f,0)}return d}alias(a,b){return a===this.get_property(d6)?(dT.critical("Attempting to create alias for existing People user - aborting."),-2):this.zr("posthog.alias")?(cQ(b)&&(b=this.get_distinct_id()),a!==b?(this.Hr(d7,a),this.capture("$create_alias",{alias:a,distinct_id:b})):(dT.warn("alias matches current distinct_id - skipping api call."),this.identify(a),-1)):void 0}set_config(a){var b=cA({},this.config);if(cO(a)){d$(this.config,im(a));var c,d,e,f,g,h=this.kr();null==(c=this.persistence)||c.update_config(this.config,b,h),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new hD(cA({},this.config,{persistence:"sessionStorage"}),h);var i=this.$r(this.config.debug);cW(i)&&(this.config.debug=i),cW(this.config.debug)&&(this.config.debug?(cx.DEBUG=!0,fk.H()&&fk.G("ph_debug","true"),dT.info("set_config",{config:a,oldConfig:b,newConfig:cA({},this.config)})):(cx.DEBUG=!1,fk.H()&&fk.V("ph_debug"))),null==(d=this.sessionRecording)||d.startIfEnabledOrStop(),null==(e=this.autocapture)||e.startIfEnabled(),null==(f=this.heatmaps)||f.startIfEnabled(),this.surveys.loadIfEnabled(),this.Br(),null==(g=this.externalIntegrations)||g.startIfEnabledOrStop()}}startSessionRecording(a){var b,c,d,e,f,g=!0===a,h={sampling:g||!(null==a||!a.sampling),linked_flag:g||!(null==a||!a.linked_flag),url_trigger:g||!(null==a||!a.url_trigger),event_trigger:g||!(null==a||!a.event_trigger)};Object.values(h).some(Boolean)&&(null==(b=this.sessionManager)||b.checkAndGetSessionAndWindowId(),h.sampling&&(null==(c=this.sessionRecording)||c.overrideSampling()),h.linked_flag&&(null==(d=this.sessionRecording)||d.overrideLinkedFlag()),h.url_trigger&&(null==(e=this.sessionRecording)||e.overrideTrigger("url")),h.event_trigger&&(null==(f=this.sessionRecording)||f.overrideTrigger("event"))),this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var a;return!(null==(a=this.sessionRecording)||!a.started)}captureException(a,b){var c=Error("PostHog syntheticException"),d=this.exceptions.buildProperties(a,{handled:!0,syntheticException:c});return this.exceptions.sendExceptionEvent(cA({},d,b))}loadToolbar(a){return this.toolbar.loadToolbar(a)}get_property(a){var b;return null==(b=this.persistence)?void 0:b.props[a]}getSessionProperty(a){var b;return null==(b=this.sessionPersistence)?void 0:b.props[a]}toString(){var a,b=null!=(a=this.config.name)?a:ij;return b!==ij&&(b=ij+"."+b),b}_isIdentified(){var a,b;return"identified"===(null==(a=this.persistence)?void 0:a.get_property(es))||"identified"===(null==(b=this.sessionPersistence)?void 0:b.get_property(es))}Ur(){var a,b;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&cP(this.getGroups())&&(null==(a=this.persistence)||null==(a=a.props)||!a[d7])&&(null==(b=this.persistence)||null==(b=b.props)||!b[ey]))}jr(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&(!0===this.config.capture_pageview||"history_change"===this.config.capture_pageview)}createPersonProfile(){this.Ur()||this.zr("posthog.createPersonProfile")&&this.setPersonProperties({},{})}zr(a){return"never"===this.config.person_profiles?(dT.error(a+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this.Hr(ey,!0),!0)}kr(){if("always"===this.config.cookieless_mode)return!0;var a=this.consent.isOptedOut(),b=this.config.opt_out_persistence_by_default||"on_reject"===this.config.cookieless_mode;return this.config.disable_persistence||a&&!!b}Br(){var a,b,c,d,e=this.kr();return(null==(a=this.persistence)?void 0:a.wi)!==e&&(null==(c=this.persistence)||c.set_disabled(e)),(null==(b=this.sessionPersistence)?void 0:b.wi)!==e&&(null==(d=this.sessionPersistence)||d.set_disabled(e)),e}opt_in_capturing(a){if("always"!==this.config.cookieless_mode){var b,c;"on_reject"===this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut()&&(this.reset(!0),null==(b=this.sessionManager)||b.destroy(),this.sessionManager=new h0(this),this.persistence&&(this.sessionPropsManager=new h$(this,this.sessionManager,this.persistence)),this.sessionRecording=new ig(this),this.sessionRecording.startIfEnabledOrStop()),this.consent.optInOut(!0),this.Br(),this.Ar(),"on_reject"==this.config.cookieless_mode&&this.surveys.loadIfEnabled(),(cQ(null==a?void 0:a.captureEventName)||null!=a&&a.captureEventName)&&this.capture(null!=(c=null==a?void 0:a.captureEventName)?c:"$opt_in",null==a?void 0:a.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.Dr()}else dT.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}opt_out_capturing(){var a,b;"always"!==this.config.cookieless_mode?("on_reject"===this.config.cookieless_mode&&this.consent.isOptedIn()&&this.reset(!0),this.consent.optInOut(!1),this.Br(),"on_reject"===this.config.cookieless_mode&&(this.register({distinct_id:eA,$device_id:null}),null==(a=this.sessionManager)||a.destroy(),this.sessionManager=void 0,this.sessionPropsManager=void 0,null==(b=this.sessionRecording)||b.stopRecording(),this.sessionRecording=void 0,this.Dr())):dT.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}get_explicit_consent_status(){var a=this.consent.consent;return a===fr.GRANTED?"granted":a===fr.DENIED?"denied":"pending"}is_capturing(){return"always"===this.config.cookieless_mode||("on_reject"===this.config.cookieless_mode?this.consent.isExplicitlyOptedOut()||this.consent.isOptedIn():!this.has_opted_out_capturing())}clear_opt_in_out_capturing(){this.consent.reset(),this.Br()}_is_bot(){return cp?h4(cp,this.config.custom_blocked_useragents):void 0}Dr(){cq&&("visible"===cq.visibilityState?this.mr||(this.mr=!0,this.capture("$pageview",{title:cq.title},{send_instantly:!0}),this.yr&&(cq.removeEventListener("visibilitychange",this.yr),this.yr=null)):this.yr||(this.yr=this.Dr.bind(this),d5(cq,"visibilitychange",this.yr)))}debug(a){!1===a?(null==ck||ck.console.log("You've disabled debug mode."),this.set_config({debug:!1})):(null==ck||ck.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),this.set_config({debug:!0}))}M(){var a,b,c,d,e=this.Sr||{};return"advanced_disable_flags"in e?!!e.advanced_disable_flags:!1!==this.config.advanced_disable_flags?!!this.config.advanced_disable_flags:!0===this.config.advanced_disable_decide?(dT.warn("Config field 'advanced_disable_decide' is deprecated. Please use 'advanced_disable_flags' instead. The old field will be removed in a future major version."),!0):(b="advanced_disable_decide",c=(a="advanced_disable_flags")in e&&!cQ(e[a]),d=b in e&&!cQ(e[b]),c?e[a]:!!d&&(dT&&dT.warn("Config field '"+b+"' is deprecated. Please use '"+a+"' instead. The old field will be removed in a future major version."),e[b]))}Nr(a){if(cU(this.config.before_send))return a;var b=cM(this.config.before_send)?this.config.before_send:[this.config.before_send],c=a;for(var d of b){if(cU(c=d(c))){var e="Event '"+a.event+"' was rejected in beforeSend function";return cX(a.event)?dT.warn(e+". This can cause unexpected behavior."):dT.info(e),null}c.properties&&!cP(c.properties)||dT.warn("Event '"+a.event+"' has no properties after beforeSend function, this is likely an error.")}return c}getPageViewId(){var a;return null==(a=this.pageViewManager.Vt)?void 0:a.pageViewId}captureTraceFeedback(a,b){this.capture("$ai_feedback",{$ai_trace_id:String(a),$ai_feedback_text:b})}captureTraceMetric(a,b,c){this.capture("$ai_metric",{$ai_trace_id:String(a),$ai_metric_name:b,$ai_metric_value:String(c)})}$r(a){var b=cW(a)&&!a,c=fk.H()&&"true"===fk.q("ph_debug");return!b&&(!!c||a)}}for(var iq=["identify"],ir=0;ir<iq.length;ir++)ip.prototype[iq[ir]]=d1(ip.prototype[iq[ir]]);ih[ij]=new ip,function(){function a(){a.done||(a.done=!0,ik=!1,dZ(ih,function(a){a._dom_loaded()}))}null!=cq&&cq.addEventListener?"complete"===cq.readyState?a():d5(cq,"DOMContentLoaded",a,{capture:!1}):ck&&dT.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}();var is=a.i(14747);function it(a){return a.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}let iu=a=>void 0===a?void 0:a.variant??a.enabled,iv=a=>{if("string"!=typeof a)return a;try{return JSON.parse(a)}catch{return a}},iw="0123456789abcdef";class ix{constructor(a){this.bytes=a}static ofInner(a){if(16===a.length)return new ix(a);throw TypeError("not 128-bit length")}static fromFieldsV7(a,b,c,d){if(!Number.isInteger(a)||!Number.isInteger(b)||!Number.isInteger(c)||!Number.isInteger(d)||a<0||b<0||c<0||d<0||a>0xffffffffffff||b>4095||c>0x3fffffff||d>0xffffffff)throw RangeError("invalid field value");let e=new Uint8Array(16);return e[0]=a/0x10000000000,e[1]=a/0x100000000,e[2]=a/0x1000000,e[3]=a/65536,e[4]=a/256,e[5]=a,e[6]=112|b>>>8,e[7]=b,e[8]=128|c>>>24,e[9]=c>>>16,e[10]=c>>>8,e[11]=c,e[12]=d>>>24,e[13]=d>>>16,e[14]=d>>>8,e[15]=d,new ix(e)}static parse(a){let b;switch(a.length){case 32:b=/^[0-9a-f]{32}$/i.exec(a)?.[0];break;case 36:b=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(a)?.slice(1,6).join("");break;case 38:b=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(a)?.slice(1,6).join("");break;case 45:b=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(a)?.slice(1,6).join("")}if(b){let a=new Uint8Array(16);for(let c=0;c<16;c+=4){let d=parseInt(b.substring(2*c,2*c+8),16);a[c+0]=d>>>24,a[c+1]=d>>>16,a[c+2]=d>>>8,a[c+3]=d}return new ix(a)}throw SyntaxError("could not parse UUID string")}toString(){let a="";for(let b=0;b<this.bytes.length;b++)a+=iw.charAt(this.bytes[b]>>>4),a+=iw.charAt(15&this.bytes[b]),(3===b||5===b||7===b||9===b)&&(a+="-");return a}toHex(){let a="";for(let b=0;b<this.bytes.length;b++)a+=iw.charAt(this.bytes[b]>>>4),a+=iw.charAt(15&this.bytes[b]);return a}toJSON(){return this.toString()}getVariant(){let a=this.bytes[8]>>>4;if(a<0)throw Error("unreachable");if(a<=7)return this.bytes.every(a=>0===a)?"NIL":"VAR_0";if(a<=11)return"VAR_10";if(a<=13)return"VAR_110";if(a<=15)return this.bytes.every(a=>255===a)?"MAX":"VAR_RESERVED";throw Error("unreachable")}getVersion(){return"VAR_10"===this.getVariant()?this.bytes[6]>>>4:void 0}clone(){return new ix(this.bytes.slice(0))}equals(a){return 0===this.compareTo(a)}compareTo(a){for(let b=0;b<16;b++){let c=this.bytes[b]-a.bytes[b];if(0!==c)return Math.sign(c)}return 0}}class iy{constructor(a){this.timestamp=0,this.counter=0,this.random=a??iz()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(a,b){let c=this.generateOrAbortCore(a,b);return void 0===c&&(this.timestamp=0,c=this.generateOrAbortCore(a,b)),c}generateOrAbortCore(a,b){if(!Number.isInteger(a)||a<1||a>0xffffffffffff)throw RangeError("`unixTsMs` must be a 48-bit positive integer");if(b<0||b>0xffffffffffff)throw RangeError("`rollbackAllowance` out of reasonable range");if(a>this.timestamp)this.timestamp=a,this.resetCounter();else{if(!(a+b>=this.timestamp))return;this.counter++,this.counter>0x3ffffffffff&&(this.timestamp++,this.resetCounter())}return ix.fromFieldsV7(this.timestamp,Math.trunc(this.counter/0x40000000),this.counter&0x40000000-1,this.random.nextUint32())}resetCounter(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}generateV4(){let a=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return a[6]=64|a[6]>>>4,a[8]=128|a[8]>>>2,ix.ofInner(a)}}let iz=()=>({nextUint32:()=>65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random())}),iA=()=>(b||(b=new iy)).generate(),iB=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","leikibot","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercel-screenshot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleother","google-cloudvertexbot","googleweblight","mediapartners-google","storebot-google","google-inspectiontool","bytespider"],iC=function(a,b=[]){if(!a)return!1;let c=a.toLowerCase();return iB.concat(b).some(a=>{let b=a.toLowerCase();return -1!==c.indexOf(b)})};a.s(["DEFAULT_BLOCKED_UA_STRS",()=>iB,"isBlockedUA",()=>iC],43619);var iD=((t={}).AnonymousId="anonymous_id",t.DistinctId="distinct_id",t.Props="props",t.FeatureFlagDetails="feature_flag_details",t.FeatureFlags="feature_flags",t.FeatureFlagPayloads="feature_flag_payloads",t.BootstrapFeatureFlagDetails="bootstrap_feature_flag_details",t.BootstrapFeatureFlags="bootstrap_feature_flags",t.BootstrapFeatureFlagPayloads="bootstrap_feature_flag_payloads",t.OverrideFeatureFlags="override_feature_flags",t.Queue="queue",t.OptedOut="opted_out",t.SessionId="session_id",t.SessionStartTimestamp="session_start_timestamp",t.SessionLastTimestamp="session_timestamp",t.PersonProperties="person_properties",t.GroupProperties="group_properties",t.InstalledAppBuild="installed_app_build",t.InstalledAppVersion="installed_app_version",t.SessionReplay="session_replay",t.SurveyLastSeenDate="survey_last_seen_date",t.SurveysSeen="surveys_seen",t.Surveys="surveys",t.RemoteConfig="remote_config",t.FlagsEndpointWasHit="flags_endpoint_was_hit",t);let iE=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];function iF(a,b){return -1!==a.indexOf(b)}let iG=function(a){return a.trim()},iH=function(a){return a.replace(/^\$/,"")};function iI(a){return["distinct_id","distinctid"].includes(a.toLowerCase())}a.s(["includes",()=>iF,"isDistinctIdStringLike",()=>iI,"stripLeadingDollar",()=>iH,"trim",()=>iG],21052);let iJ=Array.isArray,iK=Object.prototype,iL=iK.hasOwnProperty,iM=iK.toString,iN=iJ||function(a){return"[object Array]"===iM.call(a)},iO=a=>"function"==typeof a,iP=a=>iO(a)&&-1!==a.toString().indexOf("[native code]"),iQ=a=>a===Object(a)&&!iN(a),iR=a=>{if(iQ(a)){for(let b in a)if(iL.call(a,b))return!1;return!0}return!1},iS=a=>void 0===a,iT=a=>"[object String]"==iM.call(a),iU=a=>iT(a)&&0===a.trim().length,iV=a=>null===a,iW=a=>iS(a)||iV(a),iX=a=>"[object Number]"==iM.call(a),iY=a=>"[object Boolean]"===iM.call(a),iZ=a=>a instanceof FormData,i$=a=>a instanceof File,i_=a=>a instanceof Error,i0=a=>iF(iE,a);function i1(a,b){try{return a instanceof b}catch{return!1}}function i2(a){return null===a||"object"!=typeof a}function i3(a,b){return Object.prototype.toString.call(a)===`[object ${b}]`}function i4(a){switch(Object.prototype.toString.call(a)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object DOMError]":case"[object WebAssembly.Exception]":return!0;default:return i1(a,Error)}}function i5(a){return i3(a,"ErrorEvent")}function i6(a){return!iS(Event)&&i1(a,Event)}function i7(a){return i3(a,"Object")}let i8=[!0,"true",1,"1","yes"],i9=a=>iF(i8,a),ja=[!1,"false",0,"0","no"],jb=a=>iF(ja,a);function jc(a,b,c,d,e){if(b>c&&(d.warn("min cannot be greater than max."),b=c),iX(a))if(a>c)return d.warn(" cannot be  greater than max: "+c+". Using max value instead."),c;else return a<b?(d.warn(" cannot be less than min: "+b+". Using min value instead."),b):a;return d.warn(" must be a number. using max or fallback. max: "+c+", fallback: "+e),jc(e||c,b,c,d)}a.s(["hasOwnProperty",()=>iL,"isArray",()=>iN,"isBoolean",()=>iY,"isBuiltin",()=>i3,"isEmptyObject",()=>iR,"isEmptyString",()=>iU,"isError",()=>i4,"isErrorEvent",()=>i5,"isEvent",()=>i6,"isFile",()=>i$,"isFormData",()=>iZ,"isFunction",()=>iO,"isInstanceOf",()=>i1,"isKnownUnsafeEditableEvent",()=>i0,"isNativeFunction",()=>iP,"isNoLike",()=>jb,"isNull",()=>iV,"isNullish",()=>iW,"isNumber",()=>iX,"isObject",()=>iQ,"isPlainError",()=>i_,"isPlainObject",()=>i7,"isPrimitive",()=>i2,"isString",()=>iT,"isUndefined",()=>iS,"isYesLike",()=>i9,"noLikeValues",()=>ja,"yesLikeValues",()=>i8],1122),a.s(["clampToRange",()=>jc],5664);class jd{constructor(a){this._buckets={},this._onBucketRateLimited=a._onBucketRateLimited,this._bucketSize=jc(a.bucketSize,0,100,a._logger),this._refillRate=jc(a.refillRate,0,this._bucketSize,a._logger),this._refillInterval=jc(a.refillInterval,0,864e5,a._logger)}_applyRefill(a,b){let c=Math.floor((b-a.lastAccess)/this._refillInterval);if(c>0){let b=c*this._refillRate;a.tokens=Math.min(a.tokens+b,this._bucketSize),a.lastAccess=a.lastAccess+c*this._refillInterval}}consumeRateLimit(a){let b=Date.now(),c=String(a),d=this._buckets[c];return d?this._applyRefill(d,b):(d={tokens:this._bucketSize,lastAccess:b},this._buckets[c]=d),0===d.tokens||(d.tokens--,0===d.tokens&&this._onBucketRateLimited?.(a),0===d.tokens)}stop(){this._buckets={}}}a.s(["BucketedRateLimiter",()=>jd],68835);class je{add(a){let b=iA().toString();return this.promiseByIds[b]=a,a.catch(()=>{}).finally(()=>{delete this.promiseByIds[b]}),a}async join(){let a=Object.values(this.promiseByIds),b=a.length;for(;b>0;)await Promise.all(a),b=(a=Object.values(this.promiseByIds)).length}get length(){return Object.keys(this.promiseByIds).length}constructor(){this.promiseByIds={}}}a.s(["PromiseQueue",()=>je],54523);let jf="utf8";function jg(a,b){if(!a||"string"!=typeof a||0===a.trim().length)throw Error(b)}function jh(a){return a?.replace(/\/+$/,"")}async function ji(a,b){let c=null;for(let d=0;d<b.retryCount+1;d++){d>0&&await new Promise(a=>setTimeout(a,b.retryDelay));try{return await a()}catch(a){if(c=a,!b.retryCheck(a))throw a}}throw c}function jj(){return new Date().getTime()}function jk(){return new Date().toISOString()}function jl(a,b){let c=setTimeout(a,b);return c?.unref&&c?.unref(),c}let jm=a=>a&&"function"==typeof a.then,jn=a=>a instanceof Error;function jo(){return"undefined"!=typeof fetch?fetch:void 0!==globalThis.fetch?globalThis.fetch:void 0}function jp(a){return Promise.all(a.map(a=>(a??Promise.resolve()).then(a=>({status:"fulfilled",value:a}),a=>({status:"rejected",reason:a}))))}a.s(["STRING_FORMAT",()=>jf,"allSettled",()=>jp,"assert",()=>jg,"currentISOTime",()=>jk,"currentTimestamp",()=>jj,"getFetch",()=>jo,"isError",()=>jn,"isPromise",()=>jm,"removeTrailingSlash",()=>jh,"retriable",()=>ji,"safeSetTimeout",()=>jl],44508);class jq{constructor(){this.events={},this.events={}}on(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),()=>{this.events[a]=this.events[a].filter(a=>a!==b)}}emit(a,b){for(let c of this.events[a]||[])c(b);for(let c of this.events["*"]||[])c(a,b)}}async function jr(a,b=!0){try{let b=new Blob([a],{type:"text/plain"}).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(b).blob()}catch(a){return b&&console.error("Failed to gzip compress data",a),null}}let js=(a,b,c)=>{function d(e,...f){b(()=>{(0,c[e])(a,...f)})}return{info:(...a)=>{d("log",...a)},warn:(...a)=>{d("warn",...a)},error:(...a)=>{d("error",...a)},critical:(...b)=>{c.error(a,...b)},createLogger:d=>js(`${a} ${d}`,b,c)}};class jt extends Error{constructor(a,b){super("HTTP error while fetching PostHog: status="+a.status+", reqByteLength="+b),this.response=a,this.reqByteLength=b,this.name="PostHogFetchHttpError"}get status(){return this.response.status}get text(){return this.response.text()}get json(){return this.response.json()}}class ju extends Error{constructor(a){super("Network error while fetching PostHog",a instanceof Error?{cause:a}:{}),this.error=a,this.name="PostHogFetchNetworkError"}}async function jv(a){if(a instanceof jt){let b="";try{b=await a.text}catch{}console.error(`Error while flushing PostHog: message=${a.message}, response body=${b}`,a)}else console.error("Error while flushing PostHog",a);return Promise.resolve()}function jw(a){return"object"==typeof a&&(a instanceof jt||a instanceof ju)}function jx(a){return"object"==typeof a&&a instanceof jt&&413===a.status}class jy{constructor(a,b={}){this.flushPromise=null,this.shutdownPromise=null,this.promiseQueue=new je,this._events=new jq,this._isInitialized=!1,jg(a,"You must pass your PostHog project's api key."),this.apiKey=a,this.host=jh(b.host||"https://us.i.posthog.com"),this.flushAt=b.flushAt?Math.max(b.flushAt,1):20,this.maxBatchSize=Math.max(this.flushAt,b.maxBatchSize??100),this.maxQueueSize=Math.max(this.flushAt,b.maxQueueSize??1e3),this.flushInterval=b.flushInterval??1e4,this.preloadFeatureFlags=b.preloadFeatureFlags??!0,this.defaultOptIn=b.defaultOptIn??!0,this.disableSurveys=b.disableSurveys??!1,this._retryOptions={retryCount:b.fetchRetryCount??3,retryDelay:b.fetchRetryDelay??3e3,retryCheck:jw},this.requestTimeout=b.requestTimeout??1e4,this.featureFlagsRequestTimeoutMs=b.featureFlagsRequestTimeoutMs??3e3,this.remoteConfigRequestTimeoutMs=b.remoteConfigRequestTimeoutMs??3e3,this.disableGeoip=b.disableGeoip??!0,this.disabled=b.disabled??!1,this.historicalMigration=b?.historicalMigration??!1,this.evaluationEnvironments=b?.evaluationEnvironments,this._initPromise=Promise.resolve(),this._isInitialized=!0,this._logger=js("[PostHog]",this.logMsgIfDebug.bind(this),function(a=console){return{log:a.log.bind(a),warn:a.warn.bind(a),error:a.error.bind(a),debug:a.debug.bind(a)}}()),this.disableCompression=!("CompressionStream"in globalThis)||(b?.disableCompression??!1)}logMsgIfDebug(a){this.isDebug&&a()}wrap(a){return this.disabled?void this._logger.warn("The client is disabled"):this._isInitialized?a():void this._initPromise.then(()=>a())}getCommonEventProperties(){return{$lib:this.getLibraryId(),$lib_version:this.getLibraryVersion()}}get optedOut(){return this.getPersistedProperty(iD.OptedOut)??!this.defaultOptIn}async optIn(){this.wrap(()=>{this.setPersistedProperty(iD.OptedOut,!1)})}async optOut(){this.wrap(()=>{this.setPersistedProperty(iD.OptedOut,!0)})}on(a,b){return this._events.on(a,b)}debug(a=!0){if(this.removeDebugCallback?.(),a){let a=this.on("*",(a,b)=>this._logger.info(a,b));this.removeDebugCallback=()=>{a(),this.removeDebugCallback=void 0}}}get isDebug(){return!!this.removeDebugCallback}get isDisabled(){return this.disabled}buildPayload(a){return{distinct_id:a.distinct_id,event:a.event,properties:{...a.properties||{},...this.getCommonEventProperties()}}}addPendingPromise(a){return this.promiseQueue.add(a)}identifyStateless(a,b,c){this.wrap(()=>{let d={...this.buildPayload({distinct_id:a,event:"$identify",properties:b})};this.enqueue("identify",d,c)})}async identifyStatelessImmediate(a,b,c){let d={...this.buildPayload({distinct_id:a,event:"$identify",properties:b})};await this.sendImmediate("identify",d,c)}captureStateless(a,b,c,d){this.wrap(()=>{let e=this.buildPayload({distinct_id:a,event:b,properties:c});this.enqueue("capture",e,d)})}async captureStatelessImmediate(a,b,c,d){let e=this.buildPayload({distinct_id:a,event:b,properties:c});await this.sendImmediate("capture",e,d)}aliasStateless(a,b,c,d){this.wrap(()=>{let e=this.buildPayload({event:"$create_alias",distinct_id:b,properties:{...c||{},distinct_id:b,alias:a}});this.enqueue("alias",e,d)})}async aliasStatelessImmediate(a,b,c,d){let e=this.buildPayload({event:"$create_alias",distinct_id:b,properties:{...c||{},distinct_id:b,alias:a}});await this.sendImmediate("alias",e,d)}groupIdentifyStateless(a,b,c,d,e,f){this.wrap(()=>{let g=this.buildPayload({distinct_id:e||`$${a}_${b}`,event:"$groupidentify",properties:{$group_type:a,$group_key:b,$group_set:c||{},...f||{}}});this.enqueue("capture",g,d)})}async getRemoteConfig(){await this._initPromise;let a=this.host;"https://us.i.posthog.com"===a?a="https://us-assets.i.posthog.com":"https://eu.i.posthog.com"===a&&(a="https://eu-assets.i.posthog.com");let b=`${a}/array/${this.apiKey}/config`,c={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}};return this.fetchWithRetry(b,c,{retryCount:0},this.remoteConfigRequestTimeoutMs).then(a=>a.json()).catch(a=>{this._logger.error("Remote config could not be loaded",a),this._events.emit("error",a)})}async getFlags(a,b={},c={},d={},e={},f=!0){await this._initPromise;let g=`${this.host}/flags/?v=2${f?"&config=true":""}`,h={token:this.apiKey,distinct_id:a,groups:b,person_properties:c,group_properties:d,...e};this.evaluationEnvironments&&this.evaluationEnvironments.length>0&&(h.evaluation_environments=this.evaluationEnvironments);let i={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"},body:JSON.stringify(h)};return this._logger.info("Flags URL",g),this.fetchWithRetry(g,i,{retryCount:0},this.featureFlagsRequestTimeoutMs).then(a=>a.json()).then(a=>(a=>{if("flags"in a){let b,c=Object.fromEntries(Object.entries(a.flags??{}).map(([a,b])=>[a,iu(b)]).filter(([,a])=>void 0!==a)),d=Object.fromEntries(Object.keys(b=a.flags??{}).filter(a=>{let c=b[a];return c.enabled&&c.metadata&&void 0!==c.metadata.payload}).map(a=>{let c=b[a].metadata?.payload;return[a,c?iv(c):void 0]}));return{...a,featureFlags:c,featureFlagPayloads:d}}{let b=a.featureFlags??{},c=Object.fromEntries(Object.entries(a.featureFlagPayloads||{}).map(([a,b])=>[a,iv(b)])),d=Object.fromEntries(Object.entries(b).map(([a,b])=>{var d,e;return[a,{key:a,enabled:"string"==typeof(d=b)||d,variant:"string"==typeof d?d:void 0,reason:void 0,metadata:{id:void 0,version:void 0,payload:(e=c[a])?JSON.stringify(e):void 0,description:void 0}}]}));return{...a,featureFlags:b,featureFlagPayloads:c,flags:d}}})(a)).catch(a=>{this._events.emit("error",a)})}async getFeatureFlagStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagDetailStateless(a,b,c,d,e,f);if(void 0===g)return{response:void 0,requestId:void 0};let h=iu(g.response);return void 0===h&&(h=!1),{response:h,requestId:g.requestId}}async getFeatureFlagDetailStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagDetailsStateless(b,c,d,e,f,[a]);if(void 0!==g)return{response:g.flags[a],requestId:g.requestId}}async getFeatureFlagPayloadStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagPayloadsStateless(b,c,d,e,f,[a]);if(!g)return;let h=g[a];return void 0===h?null:h}async getFeatureFlagPayloadsStateless(a,b={},c={},d={},e,f){return await this._initPromise,(await this.getFeatureFlagsAndPayloadsStateless(a,b,c,d,e,f)).payloads}async getFeatureFlagsStateless(a,b={},c={},d={},e,f){return await this._initPromise,await this.getFeatureFlagsAndPayloadsStateless(a,b,c,d,e,f)}async getFeatureFlagsAndPayloadsStateless(a,b={},c={},d={},e,f){await this._initPromise;let g=await this.getFeatureFlagDetailsStateless(a,b,c,d,e,f);return g?{flags:g.featureFlags,payloads:g.featureFlagPayloads,requestId:g.requestId}:{flags:void 0,payloads:void 0,requestId:void 0}}async getFeatureFlagDetailsStateless(a,b={},c={},d={},e,f){await this._initPromise;let g={};(e??this.disableGeoip)&&(g.geoip_disable=!0),f&&(g.flag_keys_to_evaluate=f);let h=await this.getFlags(a,b,c,d,g);if(void 0!==h)return(h.errorsWhileComputingFlags&&console.error("[FEATURE FLAGS] Error while computing feature flags, some flags may be missing or incorrect. Learn more at https://posthog.com/docs/feature-flags/best-practices"),h.quotaLimited?.includes("feature_flags"))?(console.warn("[FEATURE FLAGS] Feature flags quota limit exceeded - feature flags unavailable. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),{flags:{},featureFlags:{},featureFlagPayloads:{},requestId:h?.requestId}):h}async getSurveysStateless(){if(await this._initPromise,!0===this.disableSurveys)return this._logger.info("Loading surveys is disabled."),[];let a=`${this.host}/api/surveys/?token=${this.apiKey}`,b={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}},c=await this.fetchWithRetry(a,b).then(a=>{if(200!==a.status||!a.json){let b=`Surveys API could not be loaded: ${a.status}`,c=Error(b);this._logger.error(c),this._events.emit("error",Error(b));return}return a.json()}).catch(a=>{this._logger.error("Surveys API could not be loaded",a),this._events.emit("error",a)}),d=c?.surveys;return d&&this._logger.info("Surveys fetched from API: ",JSON.stringify(d)),d??[]}get props(){return this._props||(this._props=this.getPersistedProperty(iD.Props)),this._props||{}}set props(a){this._props=a}async register(a){this.wrap(()=>{this.props={...this.props,...a},this.setPersistedProperty(iD.Props,this.props)})}async unregister(a){this.wrap(()=>{delete this.props[a],this.setPersistedProperty(iD.Props,this.props)})}enqueue(a,b,c){this.wrap(()=>{if(this.optedOut)return void this._events.emit(a,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let d=this.prepareMessage(a,b,c),e=this.getPersistedProperty(iD.Queue)||[];e.length>=this.maxQueueSize&&(e.shift(),this._logger.info("Queue is full, the oldest event is dropped.")),e.push({message:d}),this.setPersistedProperty(iD.Queue,e),this._events.emit(a,d),e.length>=this.flushAt&&this.flushBackground(),this.flushInterval&&!this._flushTimer&&(this._flushTimer=jl(()=>this.flushBackground(),this.flushInterval))})}async sendImmediate(a,b,c){if(this.disabled)return void this._logger.warn("The client is disabled");if(this._isInitialized||await this._initPromise,this.optedOut)return void this._events.emit(a,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let d={api_key:this.apiKey,batch:[this.prepareMessage(a,b,c)],sent_at:jk()};this.historicalMigration&&(d.historical_migration=!0);let e=JSON.stringify(d),f=`${this.host}/batch/`,g=this.disableCompression?null:await jr(e,this.isDebug),h={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...null!==g&&{"Content-Encoding":"gzip"}},body:g||e};try{await this.fetchWithRetry(f,h)}catch(a){this._events.emit("error",a)}}prepareMessage(a,b,c){let d={...b,type:a,library:this.getLibraryId(),library_version:this.getLibraryVersion(),timestamp:c?.timestamp?c?.timestamp:jk(),uuid:c?.uuid?c.uuid:iA().toString()};return(c?.disableGeoip??this.disableGeoip)&&(d.properties||(d.properties={}),d.properties.$geoip_disable=!0),d.distinctId&&(d.distinct_id=d.distinctId,delete d.distinctId),d}clearFlushTimer(){this._flushTimer&&(clearTimeout(this._flushTimer),this._flushTimer=void 0)}flushBackground(){this.flush().catch(async a=>{await jv(a)})}async flush(){let a=jp([this.flushPromise]).then(()=>this._flush());return this.flushPromise=a,this.addPendingPromise(a),jp([a]).then(()=>{this.flushPromise===a&&(this.flushPromise=null)}),a}getCustomHeaders(){let a=this.getCustomUserAgent(),b={};return a&&""!==a&&(b["User-Agent"]=a),b}async _flush(){this.clearFlushTimer(),await this._initPromise;let a=this.getPersistedProperty(iD.Queue)||[];if(!a.length)return;let b=[],c=a.length;for(;a.length>0&&b.length<c;){let c=a.slice(0,this.maxBatchSize),d=c.map(a=>a.message),e=()=>{let b=(this.getPersistedProperty(iD.Queue)||[]).slice(c.length);this.setPersistedProperty(iD.Queue,b),a=b},f={api_key:this.apiKey,batch:d,sent_at:jk()};this.historicalMigration&&(f.historical_migration=!0);let g=JSON.stringify(f),h=`${this.host}/batch/`,i=this.disableCompression?null:await jr(g,this.isDebug),j={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...null!==i&&{"Content-Encoding":"gzip"}},body:i||g},k={retryCheck:a=>!jx(a)&&jw(a)};try{await this.fetchWithRetry(h,j,k)}catch(a){if(jx(a)&&d.length>1){this.maxBatchSize=Math.max(1,Math.floor(d.length/2)),this._logger.warn(`Received 413 when sending batch of size ${d.length}, reducing batch size to ${this.maxBatchSize}`);continue}throw a instanceof ju||e(),this._events.emit("error",a),a}e(),b.push(...d)}this._events.emit("flush",b)}async fetchWithRetry(a,b,c,d){AbortSignal.timeout??=function(a){let b=new AbortController;return setTimeout(()=>b.abort(),a),b.signal};let e=b.body?b.body:"",f=-1;try{f=e instanceof Blob?e.size:Buffer.byteLength(e,jf)}catch{f=e instanceof Blob?e.size:new TextEncoder().encode(e).length}return await ji(async()=>{let c=null;try{c=await this.fetch(a,{signal:AbortSignal.timeout(d??this.requestTimeout),...b})}catch(a){throw new ju(a)}if("no-cors"!==b.mode&&(c.status<200||c.status>=400))throw new jt(c,f);return c},{...this._retryOptions,...c})}async _shutdown(a=3e4){await this._initPromise;let b=!1;this.clearFlushTimer();let c=async()=>{try{for(await this.promiseQueue.join();;){let a=this.getPersistedProperty(iD.Queue)||[];if(0===a.length||(await this.flush(),b))break}}catch(a){if(!jw(a))throw a;await jv(a)}};return Promise.race([new Promise((c,d)=>{jl(()=>{this._logger.error("Timed out while shutting down PostHog"),b=!0,d("Timeout while shutting down PostHog. Some events may not have been sent.")},a)}),c()])}async shutdown(a=3e4){return this.shutdownPromise?this._logger.warn("shutdown() called while already shutting down. shutdown() is meant to be called once before process exit - use flush() for per-request cleanup"):this.shutdownPromise=this._shutdown(a).finally(()=>{this.shutdownPromise=null}),this.shutdownPromise}}function jz(a,b,c,d){let e={platform:"web:javascript",filename:a,function:"<anonymous>"===b?"?":b,in_app:!0};return iS(c)||(e.lineno=c),iS(d)||(e.colno=d),e}let jA=(a,b)=>{let c=-1!==a.indexOf("safari-extension"),d=-1!==a.indexOf("safari-web-extension");return c||d?[-1!==a.indexOf("@")?a.split("@")[0]:"?",c?`safari-extension:${b}`:`safari-web-extension:${b}`]:[a,b]},jB=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,jC=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,jD=/\((\S*)(?::(\d+))(?::(\d+))\)/,jE=a=>{let b=jB.exec(a);if(b){let[,a,c,d]=b;return jz(a,"?",+c,+d)}let c=jC.exec(a);if(c){if(c[2]&&0===c[2].indexOf("eval")){let a=jD.exec(c[2]);a&&(c[2]=a[1],c[3]=a[2],c[4]=a[3])}let[a,b]=jA(c[1]||"?",c[2]);return jz(b,a,c[3]?+c[3]:void 0,c[4]?+c[4]:void 0)}},jF=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,jG=a=>{let b=jF.exec(a);return b?jz(b[2],b[1]||"?",+b[3],b[4]?+b[4]:void 0):void 0},jH=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,jI=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,jJ=a=>{let b=jH.exec(a);if(b){if(b[3]&&b[3].indexOf(" > eval")>-1){let a=jI.exec(b[3]);a&&(b[1]=b[1]||"eval",b[3]=a[1],b[4]=a[2],b[5]="")}let a=b[3],c=b[1]||"?";return[c,a]=jA(c,a),jz(a,c,b[4]?+b[4]:void 0,b[5]?+b[5]:void 0)}},jK=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,jL=a=>{let b=jK.exec(a);return b?jz(b[2],b[3]||"?",+b[1]):void 0},jM=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\(.*\))? in (.*):\s*$/i,jN=a=>{let b=jM.exec(a);return b?jz(b[5],b[3]||b[4]||"?",+b[1],+b[2]):void 0},jO=/^\s*[-]{4,}$/,jP=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,jQ=a=>{let b=a.match(jP);if(b){let a,c,d,e,f;if(b[1]){let f=(d=b[1]).lastIndexOf(".");if("."===d[f-1]&&f--,f>0){a=d.slice(0,f),c=d.slice(f+1);let b=a.indexOf(".Module");b>0&&(d=d.slice(b+1),a=a.slice(0,b))}e=void 0}c&&(e=a,f=c),"<anonymous>"===c&&(f=void 0,d=void 0),void 0===d&&(f=f||"?",d=e?`${e}.${f}`:f);let g=b[2]?.startsWith("file://")?b[2].slice(7):b[2],h="native"===b[5];return g?.match(/\/[A-Z]:/)&&(g=g.slice(1)),g||!b[5]||h||(g=b[5]),{filename:g?decodeURI(g):void 0,module:void 0,function:d,lineno:jR(b[3]),colno:jR(b[4]),in_app:function(a,b=!1){return!(b||a&&!a.startsWith("/")&&!a.match(/^[A-Z]:/)&&!a.startsWith(".")&&!a.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&void 0!==a&&!a.includes("node_modules/")}(g||"",h),platform:"node:javascript"}}if(a.match(jO))return{filename:a,platform:"node:javascript"}};function jR(a){return parseInt(a||"",10)||void 0}let jS=/\(error: (.*)\)/;function jT(a){if(!a.length)return[];let b=Array.from(a);return b.reverse(),b.slice(0,50).map(a=>{var c;return{...a,filename:a.filename||((c=b)[c.length-1]||{}).filename,function:a.function||"?"}})}function jU(...a){return(b,c=0)=>{let d=[],e=b.split("\n");for(let b=c;b<e.length;b++){let c=e[b];if(c.length>1024)continue;let f=jS.test(c)?c.replace(jS,"$1"):c;if(!f.match(/\S*Error: /)){for(let b of a){let a=b(f);if(a){d.push(a);break}}if(d.length>=50)break}}return jT(d)}}a.s(["createStackParser",()=>jU,"reverseAndStripFrames",()=>jT],2754);class jV{constructor(a=[],b=[],c=[]){this.coercers=a,this.modifiers=c,this.stackParser=jU(...b)}buildFromUnknown(a,b={}){let c=b&&b.mechanism||{handled:!0,type:"generic"},d=this.buildCoercingContext(c,b,0).apply(a),e=this.buildParsingContext(),f=this.parseStacktrace(d,e);return{$exception_list:this.convertToExceptionList(f,c),$exception_level:"error"}}async modifyFrames(a){for(let b of a)b.stacktrace&&b.stacktrace.frames&&iN(b.stacktrace.frames)&&(b.stacktrace.frames=await this.applyModifiers(b.stacktrace.frames));return a}coerceFallback(a){return{type:"Error",value:"Unknown error",stack:a.syntheticException?.stack,synthetic:!0}}parseStacktrace(a,b){let c,d;return null!=a.cause&&(c=this.parseStacktrace(a.cause,b)),""!=a.stack&&null!=a.stack&&(d=this.applyChunkIds(this.stackParser(a.stack,+!!a.synthetic),b.chunkIdMap)),{...a,cause:c,stack:d}}applyChunkIds(a,b){return a.map(a=>(a.filename&&b&&(a.chunk_id=b[a.filename]),a))}applyCoercers(a,b){for(let c of this.coercers)if(c.match(a))return c.coerce(a,b);return this.coerceFallback(b)}async applyModifiers(a){let b=a;for(let a of this.modifiers)b=await a(b);return b}convertToExceptionList(a,b){let c={type:a.type,value:a.value,mechanism:{type:b.type??"generic",handled:b.handled??!0,synthetic:a.synthetic??!1}};a.stack&&(c.stacktrace={type:"raw",frames:a.stack});let d=[c];return null!=a.cause&&d.push(...this.convertToExceptionList(a.cause,{...b,handled:!0})),d}buildParsingContext(){return{chunkIdMap:function(a){let b=globalThis._posthogChunkIds;if(!b)return;let f=Object.keys(b);return e&&f.length===d?e:(d=f.length,e=f.reduce((d,e)=>{c||(c={});let f=c[e];if(f)d[f[0]]=f[1];else{let f=a(e);for(let a=f.length-1;a>=0;a--){let g=f[a],h=g?.filename,i=b[e];if(h&&i){d[h]=i,c[e]=[h,i];break}}}return d},{}))}(this.stackParser)}}buildCoercingContext(a,b,c=0){let d=(c,d)=>{if(d<=4){let e=this.buildCoercingContext(a,b,d);return this.applyCoercers(c,e)}};return{...b,syntheticException:0==c?b.syntheticException:void 0,mechanism:a,apply:a=>d(a,c),next:a=>d(a,c+1)}}}a.s(["ErrorPropertiesBuilder",()=>jV],78316);class jW{match(a){return this.isDOMException(a)||this.isDOMError(a)}coerce(a,b){let c=iT(a.stack);return{type:this.getType(a),value:this.getValue(a),stack:c?a.stack:void 0,cause:a.cause?b.next(a.cause):void 0,synthetic:!1}}getType(a){return this.isDOMError(a)?"DOMError":"DOMException"}getValue(a){let b=a.name||(this.isDOMError(a)?"DOMError":"DOMException");return a.message?`${b}: ${a.message}`:b}isDOMException(a){return i3(a,"DOMException")}isDOMError(a){return i3(a,"DOMError")}}a.s(["DOMExceptionCoercer",()=>jW],82128);class jX{match(a){return i_(a)}coerce(a,b){return{type:this.getType(a),value:this.getMessage(a,b),stack:this.getStack(a),cause:a.cause?b.next(a.cause):void 0,synthetic:!1}}getType(a){return a.name||a.constructor.name}getMessage(a,b){let c=a.message;return c.error&&"string"==typeof c.error.message?String(c.error.message):String(c)}getStack(a){return a.stacktrace||a.stack||void 0}}a.s(["ErrorCoercer",()=>jX],23083);class jY{constructor(){}match(a){return i5(a)&&void 0!=a.error}coerce(a,b){let c=b.apply(a.error);return c||{type:"ErrorEvent",value:a.message,stack:b.syntheticException?.stack,synthetic:!0}}}a.s(["ErrorEventCoercer",()=>jY],56367);let jZ=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class j${match(a){return"string"==typeof a}coerce(a,b){let[c,d]=this.getInfos(a);return{type:c??"Error",value:d??a,stack:b.syntheticException?.stack,synthetic:!0}}getInfos(a){let b="Error",c=a,d=a.match(jZ);return d&&(b=d[1],c=d[2]),[b,c]}}a.s(["StringCoercer",()=>j$],89119);let j_=["fatal","error","warning","log","info","debug"];function j0(a,b=40){let c=Object.keys(a);if(c.sort(),!c.length)return"[object has no keys]";for(let a=c.length;a>0;a--){let d=c.slice(0,a).join(", ");if(!(d.length>b)){if(a===c.length)return d;return d.length<=b?d:`${d.slice(0,b)}...`}}return""}class j1{match(a){return"object"==typeof a&&null!==a}coerce(a,b){let c=this.getErrorPropertyFromObject(a);return c?b.apply(c):{type:this.getType(a),value:this.getValue(a),stack:b.syntheticException?.stack,level:this.isSeverityLevel(a.level)?a.level:"error",synthetic:!0}}getType(a){return i6(a)?a.constructor.name:"Error"}getValue(a){if("name"in a&&"string"==typeof a.name){let b=`'${a.name}' captured as exception`;return"message"in a&&"string"==typeof a.message&&(b+=` with message: '${a.message}'`),b}if("message"in a&&"string"==typeof a.message)return a.message;let b=this.getObjectClassName(a),c=j0(a);return`${b&&"Object"!==b?`'${b}'`:"Object"} captured as exception with keys: ${c}`}isSeverityLevel(a){return iT(a)&&!iU(a)&&j_.indexOf(a)>=0}getErrorPropertyFromObject(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b)){let c=a[b];if(jn(c))return c}}getObjectClassName(a){try{let b=Object.getPrototypeOf(a);return b?b.constructor.name:void 0}catch(a){return}}}a.s(["ObjectCoercer",()=>j1],78026);class j2{match(a){return i6(a)}coerce(a,b){let c=a.constructor.name;return{type:c,value:`${c} captured as exception with keys: ${j0(a)}`,stack:b.syntheticException?.stack,synthetic:!0}}}a.s(["EventCoercer",()=>j2],80219);class j3{match(a){return i2(a)}coerce(a,b){return{type:"Error",value:`Primitive value captured as exception: ${String(a)}`,stack:b.syntheticException?.stack,synthetic:!0}}}a.s(["PrimitiveCoercer",()=>j3],46273);class j4{match(a){return i3(a,"PromiseRejectionEvent")}coerce(a,b){let c=this.getUnhandledRejectionReason(a);return i2(c)?{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(c)}`,stack:b.syntheticException?.stack,synthetic:!0}:b.apply(c)}getUnhandledRejectionReason(a){if(i2(a))return a;try{if("reason"in a)return a.reason;if("detail"in a&&"reason"in a.detail)return a.detail.reason}catch{}return a}}a.s(["PromiseRejectionEventCoercer",()=>j4],24757),a.s([],34284);class j5{constructor(a){this._maxSize=a,this._cache=new Map}get(a){let b=this._cache.get(a);if(void 0!==b)return this._cache.delete(a),this._cache.set(a,b),b}set(a,b){this._cache.set(a,b)}reduce(){for(;this._cache.size>=this._maxSize;){let a=this._cache.keys().next().value;a&&this._cache.delete(a)}}}a.s(["ReduceableCache",()=>j5],83880),a.s([],12895),a.i(12895),a.i(78316),a.i(2754),a.s(["chromeStackLineParser",()=>jE,"createStackParser",()=>jU,"geckoStackLineParser",()=>jJ,"nodeStackLineParser",()=>jQ,"opera10StackLineParser",()=>jL,"opera11StackLineParser",()=>jN,"reverseAndStripFrames",()=>jT,"winjsStackLineParser",()=>jG],31619),a.i(31619),a.i(34284),a.i(82128),a.i(23083),a.i(56367),a.i(89119),a.i(78026),a.i(80219),a.i(46273),a.i(24757),a.s(["DOMExceptionCoercer",()=>jW,"ErrorCoercer",()=>jX,"ErrorEventCoercer",()=>jY,"EventCoercer",()=>j2,"ObjectCoercer",()=>j1,"PrimitiveCoercer",()=>j3,"PromiseRejectionEventCoercer",()=>j4,"StringCoercer",()=>j$],16172),a.i(16172),a.i(83880),a.s(["DOMExceptionCoercer",()=>jW,"ErrorCoercer",()=>jX,"ErrorEventCoercer",()=>jY,"ErrorPropertiesBuilder",()=>jV,"EventCoercer",()=>j2,"ObjectCoercer",()=>j1,"PrimitiveCoercer",()=>j3,"PromiseRejectionEventCoercer",()=>j4,"ReduceableCache",()=>j5,"StringCoercer",()=>j$,"chromeStackLineParser",()=>jE,"createStackParser",()=>jU,"geckoStackLineParser",()=>jJ,"nodeStackLineParser",()=>jQ,"opera10StackLineParser",()=>jL,"opera11StackLineParser",()=>jN,"reverseAndStripFrames",()=>jT,"winjsStackLineParser",()=>jG],96270);var j6=a.i(96270),j7=j6,j8=a.i(2157),j9=a.i(1457);let ka=new j7.ReduceableCache(25),kb=new j7.ReduceableCache(20);async function kc(a){let b={};for(let e=a.length-1;e>=0;e--){var c,d;let f=a[e],g=f?.filename;!(!f||"string"!=typeof g||"number"!=typeof f.lineno||(c=g).startsWith("node:")||c.endsWith(".min.js")||c.endsWith(".min.cjs")||c.endsWith(".min.mjs")||c.startsWith("data:")||void 0!==(d=f).lineno&&d.lineno>1e4||void 0!==d.colno&&d.colno>1e3)&&(b[g]||(b[g]=[]),b[g].push(f.lineno))}let e=Object.keys(b);if(0==e.length)return a;let f=[];for(let a of e){if(kb.get(a))continue;let c=b[a];if(!c)continue;c.sort((a,b)=>a-b);let d=function(a){if(!a.length)return[];let b=0,c=a[0];if("number"!=typeof c)return[];let d=ke(c),e=[];for(;;){if(b===a.length-1){e.push(d);break}let c=a[b+1];if("number"!=typeof c)break;c<=d[1]?d[1]=c+7:(e.push(d),d=ke(c)),b++}return e}(c);if(d.every(b=>(function(a,b){let c=ka.get(a);if(void 0===c)return!1;for(let a=b[0];a<=b[1];a++)if(void 0===c[a])return!1;return!0})(a,b)))continue;let e=function(a,b,c){let d=a.get(b);return void 0===d?(a.set(b,c),c):d}(ka,a,{});f.push(function(a,b,c){return new Promise(d=>{let e=(0,j8.createReadStream)(a),f=(0,j9.createInterface)({input:e});function g(){e.destroy(),d()}let h=0,i=0,j=b[0];if(void 0===j)return void g();let k=j[0],l=j[1];function m(){kb.set(a,1),f.close(),f.removeAllListeners(),g()}e.on("error",m),f.on("error",m),f.on("close",g),f.on("line",a=>{if(!(++h<k)&&(c[h]=function(a,b){let c=a,d=c.length;if(d<=150)return c;b>d&&(b=d);let e=Math.max(b-60,0);e<5&&(e=0);let f=Math.min(e+140,d);return f>d-5&&(f=d),f===d&&(e=Math.max(f-140,0)),c=c.slice(e,f),e>0&&(c=`...${c}`),f<d&&(c+="..."),c}(a,0),h>=l)){if(i===b.length-1){f.close(),f.removeAllListeners();return}let a=b[++i];if(void 0===a){f.close(),f.removeAllListeners();return}k=a[0],l=a[1]}})})}(a,d,e))}return await Promise.all(f).catch(()=>{}),a&&a.length>0&&function(a,b){for(let c of a)if(c.filename&&void 0===c.context_line&&"number"==typeof c.lineno){let a=b.get(c.filename);if(void 0===a)continue;!function(a,b,c){if(void 0===b.lineno||void 0===c)return;b.pre_context=[];for(let d=kf(a);d<a;d++){let a=c[d];if(void 0===a)return void kd(b);b.pre_context.push(a)}if(void 0===c[a])return kd(b);b.context_line=c[a];let d=function(a){return a+7}(a);b.post_context=[];for(let e=a+1;e<=d;e++){let a=c[e];if(void 0===a)break;b.post_context.push(a)}}(c.lineno,c,a)}}(a,ka),ka.reduce(),a}function kd(a){delete a.pre_context,delete a.context_line,delete a.post_context}function ke(a){return[kf(a),a+7]}function kf(a){return Math.max(1,a-7)}class kg{constructor(a,b,c){this.client=a,this._exceptionAutocaptureEnabled=b.enableExceptionAutocapture||!1,this._logger=c,this._rateLimiter=new jd({refillRate:1,bucketSize:10,refillInterval:1e4,_logger:this._logger}),this.startAutocaptureIfEnabled()}static async buildEventMessage(a,b,c,d){let e={...d};c||(e.$process_person_profile=!1);let f=this.errorPropertiesBuilder.buildFromUnknown(a,b);return f.$exception_list=await this.errorPropertiesBuilder.modifyFrames(f.$exception_list),{event:"$exception",distinctId:c||iA().toString(),properties:{...f,...e}}}startAutocaptureIfEnabled(){if(this.isEnabled()){var b,c,d;let e;b=this.onException.bind(this),c=this.onFatalError.bind(this),a.g.process.on("uncaughtException",(e=!1,Object.assign(d=>{let f=a.g.process.listeners("uncaughtException").filter(a=>"domainUncaughtExceptionClear"!==a.name&&!0!==a._posthogErrorHandler).length;b(d,{mechanism:{type:"onuncaughtexception",handled:!1}}),e||0!==f||(e=!0,c(d))},{_posthogErrorHandler:!0}))),d=this.onException.bind(this),a.g.process.on("unhandledRejection",a=>d(a,{mechanism:{type:"onunhandledrejection",handled:!1}}))}}onException(a,b){this.client.addPendingPromise((async()=>{let c=await kg.buildEventMessage(a,b),d=c.properties,e=d?.$exception_list[0]?.type??"Exception";return this._rateLimiter.consumeRateLimit(e)?void this._logger.info("Skipping exception capture because of client rate limiting.",{exception:e}):this.client.capture(c)})())}async onFatalError(a){console.error(a),await this.client.shutdown(2e3),process.exit(1)}isEnabled(){return!this.client.isDisabled&&this._exceptionAutocaptureEnabled}shutdown(){this._rateLimiter.stop()}}async function kh(a){let b=globalThis.crypto?.subtle;if(!b)throw Error("SubtleCrypto API not available");return Array.from(new Uint8Array(await b.digest("SHA-1",new TextEncoder().encode(a)))).map(a=>a.toString(16).padStart(2,"0")).join("")}a.i(44508),a.i(43619),a.i(68835),a.i(5664),a.i(21052),a.i(1122),a.i(54523);let ki=["is_not"];class kj extends Error{constructor(a){super(),Error.captureStackTrace(this,this.constructor),this.name="ClientError",this.message=a,Object.setPrototypeOf(this,kj.prototype)}}class kk extends Error{constructor(a){super(a),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor),Object.setPrototypeOf(this,kk.prototype)}}class kl extends Error{constructor(a){super(a),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor),Object.setPrototypeOf(this,kl.prototype)}}class km{constructor({pollingInterval:a,personalApiKey:b,projectApiKey:c,timeout:d,host:e,customHeaders:f,...g}){this.debugMode=!1,this.shouldBeginExponentialBackoff=!1,this.backOffCount=0,this.pollingInterval=a,this.personalApiKey=b,this.featureFlags=[],this.featureFlagsByKey={},this.groupTypeMapping={},this.cohorts={},this.loadedSuccessfullyOnce=!1,this.timeout=d,this.projectApiKey=c,this.host=e,this.poller=void 0,this.fetch=g.fetch||fetch,this.onError=g.onError,this.customHeaders=f,this.onLoad=g.onLoad,this.loadFeatureFlags()}debug(a=!0){this.debugMode=a}logMsgIfDebug(a){this.debugMode&&a()}async getFeatureFlag(a,b,c={},d={},e={}){let f,g;if(await this.loadFeatureFlags(),!this.loadedSuccessfullyOnce)return f;if(void 0!==(g=this.featureFlagsByKey[a]))try{f=(await this.computeFlagAndPayloadLocally(g,b,c,d,e)).value,this.logMsgIfDebug(()=>console.debug(`Successfully computed flag locally: ${a} -> ${f}`))}catch(b){b instanceof kl||b instanceof kk?this.logMsgIfDebug(()=>console.debug(`${b.name} when computing flag locally: ${a}: ${b.message}`)):b instanceof Error&&this.onError?.(Error(`Error computing flag locally: ${a}: ${b}`))}return f}async getAllFlagsAndPayloads(a,b={},c={},d={},e){await this.loadFeatureFlags();let f={},g={},h=0==this.featureFlags.length,i=e?e.map(a=>this.featureFlagsByKey[a]).filter(Boolean):this.featureFlags,j={};return await Promise.all(i.map(async e=>{try{let{value:h,payload:i}=await this.computeFlagAndPayloadLocally(e,a,b,c,d,void 0,j);f[e.key]=h,i&&(g[e.key]=i)}catch(a){a instanceof kl||a instanceof kk?this.logMsgIfDebug(()=>console.debug(`${a.name} when computing flag locally: ${e.key}: ${a.message}`)):a instanceof Error&&this.onError?.(Error(`Error computing flag locally: ${e.key}: ${a}`)),h=!0}})),{response:f,payloads:g,fallbackToFlags:h}}async computeFlagAndPayloadLocally(a,b,c={},d={},e={},f,g,h=!1){let i;if(h||await this.loadFeatureFlags(),!this.loadedSuccessfullyOnce)return{value:!1,payload:null};i=void 0!==f?f:await this.computeFlagValueLocally(a,b,c,d,e,g);let j=this.getFeatureFlagPayload(a.key,i);return{value:i,payload:j}}async computeFlagValueLocally(a,b,c={},d={},e={},f={}){if(a.ensure_experience_continuity)throw new kk("Flag has experience continuity enabled");if(!a.active)return!1;let g=(a.filters||{}).aggregation_group_type_index;if(void 0==g)return await this.matchFeatureFlagProperties(a,b,d,f);{let b=this.groupTypeMapping[String(g)];if(!b)throw this.logMsgIfDebug(()=>console.warn(`[FEATURE FLAGS] Unknown group type index ${g} for feature flag ${a.key}`)),new kk("Flag has unknown group type index");if(!(b in c))return this.logMsgIfDebug(()=>console.warn(`[FEATURE FLAGS] Can't compute group feature flag: ${a.key} without group names passed in`)),!1;let d=e[b];return await this.matchFeatureFlagProperties(a,c[b],d,f)}}getFeatureFlagPayload(a,b){let c=null;if(!1!==b&&null!=b&&("boolean"==typeof b?c=this.featureFlagsByKey?.[a]?.filters?.payloads?.[b.toString()]||null:"string"==typeof b&&(c=this.featureFlagsByKey?.[a]?.filters?.payloads?.[b]||null),null!=c)){if("object"==typeof c)return c;if("string"==typeof c)try{return JSON.parse(c)}catch{}return c}return null}async evaluateFlagDependency(a,b,c,d){let e=a.key;if(!this.featureFlagsByKey)throw new kk("Feature flags not available for dependency evaluation");if(!("dependency_chain"in a))throw new kk(`Flag dependency property for '${e}' is missing required 'dependency_chain' field`);let f=a.dependency_chain;if(!Array.isArray(f))throw new kk(`Flag dependency property for '${e}' has an invalid 'dependency_chain' (expected array, got ${typeof f})`);if(0===f.length)throw new kk(`Circular dependency detected for flag '${e}' (empty dependency chain)`);for(let a of f){if(!(a in d)){let f=this.featureFlagsByKey[a];if(f)if(f.active)try{let e=await this.matchFeatureFlagProperties(f,b,c,d);d[a]=e}catch(b){throw new kk(`Error evaluating flag dependency '${a}' for flag '${e}': ${b}`)}else d[a]=!1;else throw new kk(`Missing flag dependency '${a}' for flag '${e}'`)}if(null==d[a])throw new kk(`Dependency '${a}' could not be evaluated`)}let g=d[e];return this.flagEvaluatesToExpectedValue(a.value,g)}flagEvaluatesToExpectedValue(a,b){return"boolean"==typeof a?a===b||"string"==typeof b&&""!==b&&!0===a:"string"==typeof a&&b===a}async matchFeatureFlagProperties(a,b,c,d={}){let e,f=a.filters||{},g=f.groups||[],h=!1;for(let i of g)try{if(await this.isConditionMatch(a,b,i,c,d)){let c=i.variant,d=f.multivariate?.variants||[];e=c&&d.some(a=>a.key===c)?c:await this.getMatchingVariant(a,b)||!0;break}}catch(a){if(a instanceof kl)throw a;if(a instanceof kk)h=!0;else throw a}if(void 0!==e)return e;if(h)throw new kk("Can't determine if feature flag is enabled or not with given properties");return!1}async isConditionMatch(a,b,c,d,e={}){let f=c.rollout_percentage,g=a=>{this.logMsgIfDebug(()=>console.warn(a))};if((c.properties||[]).length>0){for(let a of c.properties){let c=a.type;if(!("cohort"===c?function a(b,c,d,e=!1){let f=String(b.value);if(!(f in d))throw new kl(`cohort ${f} not found in local cohorts - likely a static cohort that requires server evaluation`);return function b(c,d,e,f=!1){if(!c)return!0;let g=c.type,h=c.values;if(!h||0===h.length)return!0;let i=!1;if("values"in h[0]){for(let a of h)try{let c=b(a,d,e,f);if("AND"===g){if(!c)return!1}else if(c)return!0}catch(b){if(b instanceof kl)throw b;if(b instanceof kk)f&&console.debug(`Failed to compute property ${a} locally: ${b}`),i=!0;else throw b}if(i)throw new kk("Can't match cohort without a given cohort property value");return"AND"===g}for(let b of h)try{let c;if("cohort"===b.type)c=a(b,d,e,f);else if("flag"===b.type){f&&console.warn(`[FEATURE FLAGS] Flag dependency filters are not supported in local evaluation. Skipping condition with dependency on flag '${b.key||"unknown"}'`);continue}else c=ko(b,d);let h=b.negation||!1;if("AND"===g){if(!c&&!h||c&&h)return!1}else if(c&&!h||!c&&h)return!0}catch(a){if(a instanceof kl)throw a;if(a instanceof kk)f&&console.debug(`Failed to compute property ${b} locally: ${a}`),i=!0;else throw a}if(i)throw new kk("can't match cohort without a given cohort property value");return"AND"===g}(d[f],c,d,e)}(a,d,this.cohorts,this.debugMode):"flag"===c?await this.evaluateFlagDependency(a,b,d,e):ko(a,d,g)))return!1}if(void 0==f)return!0}return!(void 0!=f&&await kn(a.key,b)>f/100)}async getMatchingVariant(a,b){let c=await kn(a.key,b,"variant"),d=this.variantLookupTable(a).find(a=>c>=a.valueMin&&c<a.valueMax);if(d)return d.key}variantLookupTable(a){let b=[],c=0,d=0,e=a.filters||{};return(e.multivariate?.variants||[]).forEach(a=>{d=c+a.rollout_percentage/100,b.push({valueMin:c,valueMax:d,key:a.key}),c=d}),b}async loadFeatureFlags(a=!1){(!this.loadedSuccessfullyOnce||a)&&await this._loadFeatureFlags()}isLocalEvaluationReady(){return(this.loadedSuccessfullyOnce??!1)&&(this.featureFlags?.length??0)>0}getPollingInterval(){return this.shouldBeginExponentialBackoff?Math.min(6e4,this.pollingInterval*2**this.backOffCount):this.pollingInterval}async _loadFeatureFlags(){this.poller&&(clearTimeout(this.poller),this.poller=void 0),this.poller=setTimeout(()=>this._loadFeatureFlags(),this.getPollingInterval());try{let a=await this._requestFeatureFlagDefinitions();if(!a)return;switch(a.status){case 401:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new kj(`Your project key or personal API key is invalid. Setting next polling interval to ${this.getPollingInterval()}ms. More information: https://posthog.com/docs/api#rate-limiting`);case 402:console.warn("[FEATURE FLAGS] Feature flags quota limit exceeded - unsetting all local flags. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),this.featureFlags=[],this.featureFlagsByKey={},this.groupTypeMapping={},this.cohorts={};return;case 403:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new kj(`Your personal API key does not have permission to fetch feature flag definitions for local evaluation. Setting next polling interval to ${this.getPollingInterval()}ms. Are you sure you're using the correct personal and Project API key pair? More information: https://posthog.com/docs/api/overview`);case 429:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new kj(`You are being rate limited. Setting next polling interval to ${this.getPollingInterval()}ms. More information: https://posthog.com/docs/api#rate-limiting`);case 200:{let b=await a.json()??{};if(!("flags"in b))return void this.onError?.(Error(`Invalid response when getting feature flags: ${JSON.stringify(b)}`));this.featureFlags=b.flags??[],this.featureFlagsByKey=this.featureFlags.reduce((a,b)=>(a[b.key]=b,a),{}),this.groupTypeMapping=b.group_type_mapping||{},this.cohorts=b.cohorts||{},this.loadedSuccessfullyOnce=!0,this.shouldBeginExponentialBackoff=!1,this.backOffCount=0,this.onLoad?.(this.featureFlags.length);break}default:return}}catch(a){a instanceof kj&&this.onError?.(a)}}getPersonalApiKeyRequestOptions(a="GET"){return{method:a,headers:{...this.customHeaders,"Content-Type":"application/json",Authorization:`Bearer ${this.personalApiKey}`}}}async _requestFeatureFlagDefinitions(){let a=`${this.host}/api/feature_flag/local_evaluation?token=${this.projectApiKey}&send_cohorts`,b=this.getPersonalApiKeyRequestOptions(),c=null;if(this.timeout&&"number"==typeof this.timeout){let a=new AbortController;c=jl(()=>{a.abort()},this.timeout),b.signal=a.signal}try{return await this.fetch(a,b)}finally{clearTimeout(c)}}stopPoller(){clearTimeout(this.poller)}}async function kn(a,b,c=""){return parseInt((await kh(`${a}.${b}${c}`)).slice(0,15),16)/0x1000000000000000}function ko(a,b,c){let d=a.key,e=a.value,f=a.operator||"exact";if(d in b){if("is_not_set"===f)throw new kk("Operator is_not_set is not supported")}else throw new kk(`Property ${d} not found in propertyValues`);let g=b[d];if(null==g&&!ki.includes(f))return c&&c(`Property ${d} cannot have a value of null/undefined with the ${f} operator`),!1;function h(a,b){return Array.isArray(a)?a.map(a=>String(a).toLowerCase()).includes(String(b).toLowerCase()):String(a).toLowerCase()===String(b).toLowerCase()}function i(a,b,c){if("gt"===c)return a>b;if("gte"===c)return a>=b;if("lt"===c)return a<b;if("lte"===c)return a<=b;throw Error(`Invalid operator: ${c}`)}switch(f){case"exact":return h(e,g);case"is_not":return!h(e,g);case"is_set":return d in b;case"icontains":return String(g).toLowerCase().includes(String(e).toLowerCase());case"not_icontains":return!String(g).toLowerCase().includes(String(e).toLowerCase());case"regex":return kp(String(e))&&null!==String(g).match(String(e));case"not_regex":return kp(String(e))&&null===String(g).match(String(e));case"gt":case"gte":case"lt":case"lte":{let a="number"==typeof e?e:null;if("string"==typeof e)try{a=parseFloat(e)}catch(a){}if(null==a||null==g)return i(String(g),String(e),f);if("string"==typeof g)return i(g,String(e),f);return i(g,a,f)}case"is_date_after":case"is_date_before":{if("boolean"==typeof e)throw new kk("Date operations cannot be performed on boolean values");let a=function(a){let b=a.match(/^-?(?<number>[0-9]+)(?<interval>[a-z])$/),c=new Date(new Date().toISOString());if(!b)return null;{if(!b.groups)return null;let a=parseInt(b.groups.number);if(a>=1e4)return null;let d=b.groups.interval;if("h"==d)c.setUTCHours(c.getUTCHours()-a);else if("d"==d)c.setUTCDate(c.getUTCDate()-a);else if("w"==d)c.setUTCDate(c.getUTCDate()-7*a);else if("m"==d)c.setUTCMonth(c.getUTCMonth()-a);else{if("y"!=d)return null;c.setUTCFullYear(c.getUTCFullYear()-a)}return c}}(String(e));if(null==a&&(a=kq(e)),null==a)throw new kk(`Invalid date: ${e}`);let b=kq(g);if(["is_date_before"].includes(f))return b<a;return b>a}default:throw new kk(`Unknown operator: ${f}`)}}function kp(a){try{return new RegExp(a),!0}catch(a){return!1}}function kq(a){if(a instanceof Date)return a;if("string"==typeof a||"number"==typeof a){let b=new Date(a);if(!isNaN(b.valueOf()))return b;throw new kk(`${a} is in an invalid date format`)}throw new kk(`The date provided ${a} must be a string, number, or date object`)}class kr{getProperty(a){return this._memoryStorage[a]}setProperty(a,b){this._memoryStorage[a]=null!==b?b:void 0}constructor(){this._memoryStorage={}}}class ks extends jy{constructor(a,b={}){if(super(a,b),this._memoryStorage=new kr,this.options=b,this.options.featureFlagsPollingInterval="number"==typeof b.featureFlagsPollingInterval?Math.max(b.featureFlagsPollingInterval,100):3e4,b.personalApiKey){if(b.personalApiKey.includes("phc_"))throw Error('Your Personal API key is invalid. These keys are prefixed with "phx_" and can be created in PostHog project settings.');!1!==b.enableLocalEvaluation&&(this.featureFlagsPoller=new km({pollingInterval:this.options.featureFlagsPollingInterval,personalApiKey:b.personalApiKey,projectApiKey:a,timeout:b.requestTimeout??1e4,host:this.host,fetch:b.fetch,onError:a=>{this._events.emit("error",a)},onLoad:a=>{this._events.emit("localEvaluationFlagsLoaded",a)},customHeaders:this.getCustomHeaders()}))}this.errorTracking=new kg(this,b,this._logger),this.distinctIdHasSentFlagCalls={},this.maxCacheSize=b.maxCacheSize||5e4}getPersistedProperty(a){return this._memoryStorage.getProperty(a)}setPersistedProperty(a,b){return this._memoryStorage.setProperty(a,b)}fetch(a,b){return this.options.fetch?this.options.fetch(a,b):fetch(a,b)}getLibraryVersion(){return"5.11.2"}getCustomUserAgent(){return`${this.getLibraryId()}/${this.getLibraryVersion()}`}enable(){return super.optIn()}disable(){return super.optOut()}debug(a=!0){super.debug(a),this.featureFlagsPoller?.debug(a)}capture(a){"string"==typeof a&&this._logger.warn("Called capture() with a string as the first argument when an object was expected."),this.addPendingPromise(this.prepareEventMessage(a).then(({distinctId:a,event:b,properties:c,options:d})=>super.captureStateless(a,b,c,{timestamp:d.timestamp,disableGeoip:d.disableGeoip,uuid:d.uuid})).catch(a=>{a&&console.error(a)}))}async captureImmediate(a){return"string"==typeof a&&this._logger.warn("Called captureImmediate() with a string as the first argument when an object was expected."),this.addPendingPromise(this.prepareEventMessage(a).then(({distinctId:a,event:b,properties:c,options:d})=>super.captureStatelessImmediate(a,b,c,{timestamp:d.timestamp,disableGeoip:d.disableGeoip,uuid:d.uuid})).catch(a=>{a&&console.error(a)}))}identify({distinctId:a,properties:b,disableGeoip:c}){let d=b?.$set_once;delete b?.$set_once;let e=b?.$set||b;super.identifyStateless(a,{$set:e,$set_once:d},{disableGeoip:c})}async identifyImmediate({distinctId:a,properties:b,disableGeoip:c}){let d=b?.$set_once;delete b?.$set_once;let e=b?.$set||b;await super.identifyStatelessImmediate(a,{$set:e,$set_once:d},{disableGeoip:c})}alias(a){super.aliasStateless(a.alias,a.distinctId,void 0,{disableGeoip:a.disableGeoip})}async aliasImmediate(a){await super.aliasStatelessImmediate(a.alias,a.distinctId,void 0,{disableGeoip:a.disableGeoip})}isLocalEvaluationReady(){return this.featureFlagsPoller?.isLocalEvaluationReady()??!1}async waitForLocalEvaluationReady(a=3e4){return!!this.isLocalEvaluationReady()||void 0!==this.featureFlagsPoller&&new Promise(b=>{let c=setTimeout(()=>{d(),b(!1)},a),d=this._events.on("localEvaluationFlagsLoaded",a=>{clearTimeout(c),d(),b(a>0)})})}async getFeatureFlag(a,b,c){let d,e,{groups:f,disableGeoip:g}=c||{},{onlyEvaluateLocally:h,sendFeatureFlagEvents:i,personProperties:j,groupProperties:k}=c||{},l=this.addLocalPersonAndGroupProperties(b,f,j,k);j=l.allPersonProperties,k=l.allGroupProperties,void 0==h&&(h=!1),void 0==i&&(i=this.options.sendFeatureFlagEvent??!0);let m=await this.featureFlagsPoller?.getFeatureFlag(a,b,f,j,k),n=void 0!==m;if(!n&&!h){let c=await super.getFeatureFlagDetailStateless(a,b,f,j,k,g);if(void 0===c)return;m=iu(e=c.response),d=c?.requestId}let o=`${a}_${m}`;return!i||b in this.distinctIdHasSentFlagCalls&&this.distinctIdHasSentFlagCalls[b].includes(o)||(Object.keys(this.distinctIdHasSentFlagCalls).length>=this.maxCacheSize&&(this.distinctIdHasSentFlagCalls={}),Array.isArray(this.distinctIdHasSentFlagCalls[b])?this.distinctIdHasSentFlagCalls[b].push(o):this.distinctIdHasSentFlagCalls[b]=[o],this.capture({distinctId:b,event:"$feature_flag_called",properties:{$feature_flag:a,$feature_flag_response:m,$feature_flag_id:e?.metadata?.id,$feature_flag_version:e?.metadata?.version,$feature_flag_reason:e?.reason?.description??e?.reason?.code,locally_evaluated:n,[`$feature/${a}`]:m,$feature_flag_request_id:d},groups:f,disableGeoip:g})),m}async getFeatureFlagPayload(a,b,c,d){let e,{groups:f,disableGeoip:g}=d||{},{onlyEvaluateLocally:h,personProperties:i,groupProperties:j}=d||{},k=this.addLocalPersonAndGroupProperties(b,f,i,j);if(i=k.allPersonProperties,j=k.allGroupProperties,void 0!==this.featureFlagsPoller){await this.featureFlagsPoller?.loadFeatureFlags();let d=this.featureFlagsPoller?.featureFlagsByKey[a];if(d)try{let a=await this.featureFlagsPoller?.computeFlagAndPayloadLocally(d,b,f,i,j,c);a&&(c=a.value,e=a.payload)}catch(a){if(a instanceof kl||a instanceof kk)this._logger?.info(`${a.name} when computing flag locally: ${d.key}: ${a.message}`);else throw a}}return void 0==h&&(h=!1),void 0!==e||h||(e=await super.getFeatureFlagPayloadStateless(a,b,f,i,j,g)),e}async getRemoteConfigPayload(a){if(!this.options.personalApiKey)throw Error("Personal API key is required for remote config payload decryption");let b=await this._requestRemoteConfigPayload(a);if(!b)return;let c=await b.json();if("string"==typeof c)try{return JSON.parse(c)}catch(a){}return c}async isFeatureEnabled(a,b,c){let d=await this.getFeatureFlag(a,b,c);if(void 0!==d)return!!d}async getAllFlags(a,b){return(await this.getAllFlagsAndPayloads(a,b)).featureFlags||{}}async getAllFlagsAndPayloads(a,b){let{groups:c,disableGeoip:d,flagKeys:e}=b||{},{onlyEvaluateLocally:f,personProperties:g,groupProperties:h}=b||{},i=this.addLocalPersonAndGroupProperties(a,c,g,h);g=i.allPersonProperties,h=i.allGroupProperties,void 0==f&&(f=!1);let j=await this.featureFlagsPoller?.getAllFlagsAndPayloads(a,c,g,h,e),k={},l={},m=!0;if(j&&(k=j.response,l=j.payloads,m=j.fallbackToFlags),m&&!f){let b=await super.getFeatureFlagsAndPayloadsStateless(a,c,g,h,d,e);k={...k,...b.flags||{}},l={...l,...b.payloads||{}}}return{featureFlags:k,featureFlagPayloads:l}}groupIdentify({groupType:a,groupKey:b,properties:c,distinctId:d,disableGeoip:e}){super.groupIdentifyStateless(a,b,c,{disableGeoip:e},d)}async reloadFeatureFlags(){await this.featureFlagsPoller?.loadFeatureFlags(!0)}async _shutdown(a){return this.featureFlagsPoller?.stopPoller(),this.errorTracking.shutdown(),super._shutdown(a)}async _requestRemoteConfigPayload(a){if(!this.options.personalApiKey)return;let b=`${this.host}/api/projects/@current/feature_flags/${a}/remote_config?token=${encodeURIComponent(this.apiKey)}`,c={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",Authorization:`Bearer ${this.options.personalApiKey}`}},d=null;if(this.options.requestTimeout&&"number"==typeof this.options.requestTimeout){let a=new AbortController;d=jl(()=>{a.abort()},this.options.requestTimeout),c.signal=a.signal}try{return await this.fetch(b,c)}catch(a){this._events.emit("error",a);return}finally{d&&clearTimeout(d)}}extractPropertiesFromEvent(a,b){if(!a)return{personProperties:{},groupProperties:{}};let c={},d={};for(let[e,f]of Object.entries(a))if(i7(f)&&b&&e in b){let a={};for(let[b,c]of Object.entries(f))a[String(b)]=String(c);d[String(e)]=a}else c[String(e)]=String(f);return{personProperties:c,groupProperties:d}}async getFeatureFlagsForEvent(a,b,c,d){let e=d?.personProperties||{},f=d?.groupProperties||{},g=d?.flagKeys;if(d?.onlyEvaluateLocally)if(!((this.featureFlagsPoller?.featureFlags?.length||0)>0))return{};else{let d={};for(let[a,c]of Object.entries(b||{}))d[a]=String(c);return await this.getAllFlags(a,{groups:d,personProperties:e,groupProperties:f,disableGeoip:c,onlyEvaluateLocally:!0,flagKeys:g})}if((this.featureFlagsPoller?.featureFlags?.length||0)>0){let d={};for(let[a,c]of Object.entries(b||{}))d[a]=String(c);return await this.getAllFlags(a,{groups:d,personProperties:e,groupProperties:f,disableGeoip:c,onlyEvaluateLocally:!0,flagKeys:g})}return(await super.getFeatureFlagsStateless(a,b,e,f,c)).flags}addLocalPersonAndGroupProperties(a,b,c,d){let e={distinct_id:a,...c||{}},f={};if(b)for(let a of Object.keys(b))f[a]={$group_key:b[a],...d?.[a]||{}};return{allPersonProperties:e,allGroupProperties:f}}captureException(a,b,c){let d=Error("PostHog syntheticException");this.addPendingPromise(kg.buildEventMessage(a,{syntheticException:d},b,c).then(a=>this.capture(a)))}async captureExceptionImmediate(a,b,c){let d=Error("PostHog syntheticException");this.addPendingPromise(kg.buildEventMessage(a,{syntheticException:d},b,c).then(a=>this.captureImmediate(a)))}async prepareEventMessage(a){let{distinctId:b,event:c,properties:d,groups:e,sendFeatureFlags:f,timestamp:g,disableGeoip:h,uuid:i}=a,j=this._runBeforeSend({distinctId:b,event:c,properties:d,groups:e,sendFeatureFlags:f,timestamp:g,disableGeoip:h,uuid:i});if(!j)return Promise.reject(null);let k=await Promise.resolve().then(async()=>f?await this.getFeatureFlagsForEvent(b,e,h,"object"==typeof f?f:void 0):{}).then(a=>{let b={};if(a)for(let[c,d]of Object.entries(a))b[`$feature/${c}`]=d;let c=Object.keys(a||{}).filter(b=>a?.[b]!==!1).sort();return c.length>0&&(b.$active_feature_flags=c),b}).catch(()=>({})).then(a=>({...a,...j.properties||{},$groups:j.groups||e}));return"$pageview"===j.event&&this.options.__preview_capture_bot_pageviews&&"string"==typeof k.$raw_user_agent&&iC(k.$raw_user_agent,this.options.custom_blocked_useragents||[])&&(j.event="$bot_pageview",k.$browser_type="bot"),{distinctId:j.distinctId,event:j.event,properties:k,options:{timestamp:j.timestamp,disableGeoip:j.disableGeoip,uuid:j.uuid}}}_runBeforeSend(a){let b=this.options.before_send;if(!b)return a;let c=Array.isArray(b)?b:[b],d=a;for(let b of c){if(!(d=b(d)))return this._logger.info(`Event '${a.event}' was rejected in beforeSend function`),null;if(!d.properties||0===Object.keys(d.properties).length){let a=`Event '${d.event}' has no properties after beforeSend function, this is likely an error.`;this._logger.warn(a)}}return d}}var j7=j6;let kt="posthog-node";class ku{static #a=this.POSTHOG_ID_TAG="posthog_distinct_id";constructor(a,b,c,d,e){this.name=kt,this.name=kt,this.setupOnce=function(f,g){f(createEventProcessor(a,{organization:b,projectId:g()?.getClient()?.getDsn()?.projectId,prefix:c,severityAllowList:d,sendExceptionsToPostHog:e??!0}))}}}kg.errorPropertiesBuilder=new j7.ErrorPropertiesBuilder([new j7.EventCoercer,new j7.ErrorCoercer,new j7.ObjectCoercer,new j7.StringCoercer,new j7.PrimitiveCoercer],[j7.nodeStackLineParser],[(f=function(a=process.argv[1]?(0,is.dirname)(process.argv[1]):process.cwd(),b="\\"===is.sep){let c=b?it(a):a;return a=>{if(!a)return;let d=b?it(a):a,{dir:e,base:f,ext:g}=is.posix.parse(d);(".js"===g||".mjs"===g||".cjs"===g)&&(f=f.slice(0,-1*g.length));let h=decodeURIComponent(f);e||(e=".");let i=e.lastIndexOf("/node_modules");if(i>-1)return`${e.slice(i+14).replace(/\//g,".")}:${h}`;if(e.startsWith(c)){let a=e.slice(c.length+1).replace(/\//g,".");return a?`${a}:${h}`:h}return h}}(),async a=>{for(let b of a)b.module=f(b.filename);return a}),kc]);class kv extends ks{getLibraryId(){return"posthog-node"}}let kw=null;function kx(){if(kw)return kw;let a=process.env.POSTHOG_SERVER_KEY;if(!a)return console.warn("[PostHog Server] POSTHOG_SERVER_KEY is not set. Server-side feature flags will be disabled."),null;try{return kw=new kv(a,{host:"https://us.i.posthog.com",flushAt:20,flushInterval:1e4})}catch(a){return console.error("[PostHog Server] Failed to initialize:",a),null}}async function ky(a,b,c){let d=kx();if(!d)return!1;try{return await d.isFeatureEnabled(a,b||"anonymous",c)??!1}catch(b){return console.error(`[PostHog Server] Error checking feature flag "${a}":`,b),!1}}async function kz(a,b,c){let d=kx();if(!d)return null;try{return await d.getFeatureFlag(a,b||"anonymous",c)??null}catch(b){return console.error(`[PostHog Server] Error getting feature flag value "${a}":`,b),null}}async function kA(a,b,c){let d=kx();if(!d)return null;try{return await d.getFeatureFlagPayload(a,b||"anonymous")??null}catch(b){return console.error(`[PostHog Server] Error getting feature flag payload "${a}":`,b),null}}let kB={SPARK_BETA:"spark-beta",MUSE_AI:"muse-ai",ORBIT_EXPERIMENTAL:"orbit-experimental",VAULT_ENHANCED:"vault-enhanced",KLUTR_GLOBAL_DISABLE:"klutr-global-disable"};var kC=a.i(29171),kD=a.i(40088);async function kE(){let a=await cj();a||(0,v.redirect)("/login?redirect=/debug/flags");let b=a.id,c=a.email,d=Object.values(kB),e=await Promise.all(d.map(async a=>{let c=await ky(a,b),d=await kz(a,b),e=await kA(a,b);return{flag:a,enabled:c,value:d,payload:e}}));return(0,u.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:[(0,u.jsxs)("div",{className:"mb-6",children:[(0,u.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Feature Flags Debug"}),(0,u.jsx)("p",{className:"text-muted-foreground",children:"View active feature flags for the current user"})]}),(0,u.jsxs)(kC.Card,{className:"mb-6",children:[(0,u.jsxs)(kC.CardHeader,{children:[(0,u.jsx)(kC.CardTitle,{children:"User Information"}),(0,u.jsx)(kC.CardDescription,{children:"Current authenticated user"})]}),(0,u.jsx)(kC.CardContent,{children:(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"font-medium",children:"User ID:"})," ",(0,u.jsx)("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:b})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"font-medium",children:"Email:"})," ",(0,u.jsx)("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:c})]})]})})]}),(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsx)("h2",{className:"text-2xl font-semibold",children:"Feature Flags"}),e.map(a=>(0,u.jsxs)(kC.Card,{children:[(0,u.jsx)(kC.CardHeader,{children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsx)(kC.CardTitle,{className:"text-lg font-mono",children:a.flag}),(0,u.jsx)(kD.Badge,{variant:a.enabled?"default":"secondary",children:a.enabled?"Enabled":"Disabled"})]})}),(0,u.jsx)(kC.CardContent,{children:(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"font-medium text-sm",children:"Status:"})," ",(0,u.jsx)("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:a.enabled?"true":"false"})]}),null!==a.value&&a.value!==a.enabled&&(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"font-medium text-sm",children:"Value:"})," ",(0,u.jsx)("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:String(a.value)})]}),a.payload&&(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"font-medium text-sm",children:"Payload:"}),(0,u.jsx)("pre",{className:"mt-2 text-xs bg-muted p-3 rounded overflow-auto",children:JSON.stringify(a.payload,null,2)})]})]})})]},a.flag))]}),!1]})}a.s(["default",()=>kE],14698)}];

//# sourceMappingURL=_87404337._.js.map