module.exports=[70918,a=>{"use strict";var b=class extends Error{constructor(a,b,c){let d=Array.isArray(a)?a.map(a=>a?.message||"").join("\n"):"";d||(d="GraphQL error"),super(d),this.errors=[],this.errors=a,this.data=b,this.errorsStringified=JSON.stringify(a,null,2).slice(0,1e3),this.extraWarnings=c}};function c(a,c){let d=c.map(a=>a.request);1===d.length&&(d=d[0]),(()=>{try{return a.fetcher(d)}catch(a){return Promise.reject(a)}})().then(a=>{if(!(1!==c.length||Array.isArray(a)))return a.errors&&a.errors.length?void c[0]?.reject(new b(a.errors,a.data)):void c[0]?.resolve(a);if(a.length!==c.length)throw Error("response length did not match query length");for(let d=0;d<c.length;d++)a[d].errors&&a[d].errors.length?c[d]?.reject(new b(a[d].errors,a[d].data)):c[d]?.resolve(a[d])}).catch(a=>{for(let b=0;b<c.length;b++)c[b]?.reject(a)})}function d(a,b){let d=a._queue,e=b.maxBatchSize||0;if(a._queue=[],e>0&&e<d.length)for(let b=0;b<d.length/e;b++)c(a,d.slice(b*e,(b+1)*e));else c(a,d)}var e=class a{constructor(a,{batchInterval:b=16,shouldBatch:c=!0,maxBatchSize:d=0}={}){this.fetcher=a,this._options={batchInterval:b,shouldBatch:c,maxBatchSize:d},this._queue=[]}fetch(a,b,c,e={}){let f={query:a},g=Object.assign({},this._options,e);return b&&(f.variables=b),c&&(f.operationName=c),new Promise((a,b)=>{this._queue.push({request:f,resolve:a,reject:b}),1===this._queue.length&&(g.shouldBatch?setTimeout(()=>d(this,g),g.batchInterval):d(this,g))})}forceFetch(b,c,e,f={}){let g={query:b},h=Object.assign({},this._options,f,{shouldBatch:!1});return c&&(g.variables=c),e&&(g.operationName=e),new Promise((b,c)=>{let e=new a(this.fetcher,this._options);e._queue=[{request:g,resolve:b,reject:c}],d(e,h)})}},f={maxBatchSize:10,batchInterval:40},g=({url:a,headers:c={},fetcher:d,fetch:g,batch:h=!1,...i})=>{if(!a&&!d)throw Error("url or fetcher is required");if(d=d||(async(b,d)=>{let e="function"==typeof c?await c():c;if(e=e||{},"undefined"==typeof fetch&&!g)throw Error("Global `fetch` function is not available, pass a fetch polyfill to Genql `createClient`");let f=g||fetch;d?.headers&&(e={...e,...d.headers},delete d.headers);let h=await f(a,{headers:{"Content-Type":"application/json",...e},method:"POST",body:JSON.stringify(b),...i,...d});if(!h.ok)throw Error(`${h.statusText}: ${await h.text()}`);return await h.json()}),!h)return async(a,c)=>{let e=await d(a,c);if(Array.isArray(e))return e.map(a=>{if(a?.errors?.length)throw new b(a.errors||[],a.data);return a.data});if(e?.errors?.length)throw new b(e.errors||[],e.data);return e.data};let j=new e(async(a,b)=>await d(a,b),!0===h?f:h);return async({query:a,variables:b})=>{let c=await j.fetch(a,b);if(c?.data)return c.data;throw Error("Genql batch fetcher returned unexpected result "+JSON.stringify(c))}},h="__alias__";function i(a){if("object"!=typeof a||null===a)return a;if(Array.isArray(a))return a.map(a=>i(a));let b={};for(let[c,d]of Object.entries(a))if(c.includes(h)){let[a,...e]=c.split(h);b[e.join(h)]=i(d)}else b[c]=i(d);return b}var j=(a,b,c,d,e)=>{if("object"==typeof b&&"__args"in b){let f=b.__args,g={...b};delete g.__args;let h=Object.keys(f);if(0===h.length)return j(a,g,c,d,e);let i=["anim","background","border","compression","fit","gamma","gravity","metadata","rotate","sharpen","trim","fileName","autoCommit","authorId",...["_structure"].includes(d?.[0]||"")?[]:["format"]],k=["variants"],l=h.map(b=>{let c=f[b];return"object"==typeof c?(c=JSON.stringify(c),c="mutation"===a&&["transaction","transactionAsync"].includes(d?.[0]||"")&&"data"===b?JSON.stringify(c):k.includes(b)?(c=c.replace(/"([^"]+)":/g,"$1:")).replace(/:"([^"]*)"/g,":$1"):c.replace(/"([^"]+)":/g,"$1:")):"string"==typeof c&&i.includes(b)&&(c=JSON.stringify(c)),`${b}:${c}`});return`(${l})${j(a,g,c,d,e)}`}if("object"!=typeof b||!(Object.keys(b).length>0))return"";{let f=Object.keys(b).filter(a=>!!b[a]).filter(a=>!["__scalar","__name","__fragmentOn"].includes(a)).map(f=>{if(f.startsWith("on_")){c.fragmentCounter++;let g=`f${c.fragmentCounter}`,h=j(a,b[f],c,[...d,f],{...e,aliasPrefix:g}),i=f.match(/^on_(.+)/);if(!i||!i[1])throw Error("match failed");return c.fragments.push(`fragment ${g} on ${i[1]}${h}`),`...${g}`}{let g=b?.[f];if(!g)return"";if("boolean"==typeof g||"number"==typeof g||"string"==typeof g)return`${e?.aliasPrefix?`${e.aliasPrefix}${h}${f}: `:""}${f}`;let i=j(a,b[f],c,[...d,f],e);return i?`${e?.aliasPrefix?`${e.aliasPrefix}${h}${f}: `:""}${f}${i}`:`${e?.aliasPrefix?`${e.aliasPrefix}${h}${f}: `:""}${f}{__typename}`}}).filter(Boolean).join(",");return f?`{${f}}`:""}},k=(a,b)=>{let c={fragmentCounter:0,fragments:[]},d=j(a,b,c,[]),e=b?.__name||"";return{query:[`${a} ${e}${d}`,...c.fragments].join(","),variables:{},...e?{operationName:e.toString()}:{}}},l=({getExtraFetchOptions:a,...b})=>({query:async c=>{let d=k("query",c),e=await a?.("query",d,c),f=g({...b,...e});return i(await f(d,e))},mutation:async c=>{let d=k("mutation",c),e=await a?.("mutation",d,c),f=g({...b,...e});return i(await f(d,e))}});l.replaceSystemAliases=i;var m=async b=>{let c=async b=>{try{return(await a.A(44264).then(a=>a.execSync))(b,{stdio:"pipe"}).toString().trim()}catch(a){return""}},d=process.env.VERCEL_GIT_COMMIT_REF||process.env.BRANCH||process.env.RENDER_GIT_BRANCH||process.env.GIT_BRANCH||process.env.CF_PAGES_BRANCH||await c("git symbolic-ref --short HEAD")||await c("git rev-parse --abbrev-ref HEAD"),e=process.env.VERCEL_GIT_COMMIT_SHA||process.env.COMMIT_REF||process.env.RENDER_GIT_COMMIT||process.env.COMMIT_SHA||process.env.CF_PAGES_COMMIT_SHA||await c("git rev-parse HEAD");return{gitBranch:d,gitCommitSHA:e,gitBranchDeploymentURL:process.env.VERCEL_BRANCH_URL||process.env.DEPLOY_PRIME_URL||process.env.CF_PAGES_URL||null,productionDeploymentURL:process.env.VERCEL_PROJECT_PRODUCTION_URL||process.env.URL||process.env.RENDER_EXTERNAL_URL||null}};function n(a){let b=a=>{let d=c(a)?Object.keys(a).sort().reduce((b,c)=>(b[c]=a[c],b),{}):a;return c(d)&&Object.keys(d).forEach(a=>{c(d[a])?d[a]=b(d[a]):Array.isArray(d[a])&&(d[a]=d[a].map(a=>c(a)?b(a):a))}),d},c=a=>"[object Object]"===Object.prototype.toString.call(a),d=JSON.stringify(b(a)),e=0;for(let a=0,b=d.length;a<b;a++)e=(e<<5)-e+d.charCodeAt(a)|0;return Math.abs(e).toString()}var o=()=>(()=>{try{return process.env.VERCEL_URL?.includes(".lite.vusercontent.net")||process.env.NEXT_PUBLIC_VERCEL_URL?.includes(".lite.vusercontent.net")}catch(a){return!1}})()||(()=>{try{return"/bin/jsh"===process.env.SHELL}catch(a){return!1}})(),p=Symbol.for("basehub.config"),q="BASEHUB",r=async b=>{let c,d;b||(b={}),b.cli&&await a.A(75743).then(({dotenvLoad:a})=>{a({priorities:{".dev.vars":1}})});let e=globalThis[p]??null,f=!1;try{f=o()}catch(a){}let g=a=>{let c=q;return b.prefix&&(b.prefix.endsWith("_")&&(b.prefix=b.prefix.slice(0,-1)),b.prefix.endsWith(a)&&(b.prefix=b.prefix.slice(0,-a.length)),c=b.prefix.endsWith(q)?b.prefix:`${b.prefix}_${q}`),`${c}_${a}`},h=a=>process?.env?.[g(a)],i=h("DEBUG_FORCED_URL"),j=h("URL"),k=j?new URL(j):void 0,l=new URL(i||"https://api.basehub.com/graphql"),n=`\u{1F534} Token not found. Make sure to include the ${g("TOKEN")} env var.`,r=(a=>{if(!a)return null;if(a.startsWith("bshb_"))return a;n=`\u{1F534} Token not found. Make sure to include the ${a} env var.`;let b=process?.env?.[a];return b||""})(b?.token??null)??l.searchParams.get("token")??h("TOKEN")??e?.token??(k?k.searchParams.get("token"):void 0)??null;if(!r){let a=b.fallbackPlayground?.target??h("FALLBACK_PLAYGROUND_TARGET")??e?.fallbackPlayground?.target,d=b.fallbackPlayground?.id??h("FALLBACK_PLAYGROUND_ID")??e?.fallbackPlayground?.id;if(c=b.fallbackPlayground??(d&&a?{target:a,id:d}:void 0));else if(b.cli)console.error(n),process.exit(1);else throw Error(n)}let s=b.ref??l.searchParams.get("ref")??h("REF")??e?.ref??(k?k.searchParams.get("ref"):void 0)??null,u=l.searchParams.get("draft")??h("DRAFT")??e?.draft??(k?k.searchParams.get("draft"):void 0)??!1;f&&(u=!0),b?.draft&&(u=!0);let v=l.searchParams.get("api-version")??h("API_VERSION")??(k?k.searchParams.get("api-version"):void 0)??"4";if(b?.apiVersion&&(v=b.apiVersion),"graphql"!==l.pathname.split("/")[1]){let a=`\u{1F534} Invalid URL. The URL needs to point your repo's GraphQL endpoint, so the pathname should end with /graphql.`;if(b.cli)console.error(a),process.exit(1);else throw Error(a)}l.searchParams.delete("token"),l.searchParams.delete("ref"),l.searchParams.delete("draft"),u=!!u;let{gitBranch:w,gitCommitSHA:x,gitBranchDeploymentURL:y,productionDeploymentURL:z}=await m(b),A=await t({url:l,token:r,ref:s,gitBranch:w,gitCommitSHA:x,gitBranchDeploymentURL:y,productionDeploymentURL:z,apiVersion:v,revalidate:b.revalidateResolvedRef,fallbackPlayground:c}),B=!1;if(!o()&&!u)try{let{draftMode:b}=await a.A(16534);B=(await b()).isEnabled}catch(a){}if(B&&(u=!0),u&&!o())try{let{cookies:b}=await a.A(16534),c=await b(),e=c.get("bshb-preview-ref-"+A.repoHash)?.value;e&&(d=e)}catch(a){}let C=`bshb_sdk__9.5.3__${A.id}${w?`__git_branch_${w}`:""}${x?`__git_commit_sha_${x}`:""}`;return!s&&A&&(s=A.ref),{draft:u,previewRef:d,isForcedDraft:f,isNextjsDraftMode:B,output:h("OUTPUT")??b.cli?.output??null,resolvedRef:A,url:l.toString(),gitBranch:w,gitCommitSHA:x,token:r,fallbackPlayground:c,gitBranchDeploymentURL:y,productionDeploymentURL:z,sdkBuildId:C,apiVersion:v,headers:{"x-basehub-api-version":v,"x-basehub-sdk-build-id":C,...r?{"x-basehub-token":r}:{},...s?{"x-basehub-ref":s}:{},...d?{"x-basehub-ref":d}:{},...w?{"x-basehub-git-branch":w}:{},...x?{"x-basehub-git-commit-sha":x}:{},...u?{"x-basehub-draft":"true"}:{},...y?{"x-basehub-git-branch-deployment-url":y}:{},...z?{"x-basehub-production-deployment-url":z}:{},...c?{"x-basehub-fallback-playground-target":c.target,"x-basehub-fallback-playground-id":c.id}:{}}}},s=new Map;async function t({url:a,token:b,ref:c,gitBranch:d,gitCommitSHA:e,gitBranchDeploymentURL:f,productionDeploymentURL:g,apiVersion:h,revalidate:i,fallbackPlayground:j}){let k={...b?{"x-basehub-token":b}:{},...c?{"x-basehub-ref":c}:{},...d?{"x-basehub-git-branch":d}:{},...e?{"x-basehub-git-commit-sha":e}:{},...h?{"x-basehub-api-version":h}:{},...f?{"x-basehub-git-branch-deployment-url":f}:{},...g?{"x-basehub-production-deployment-url":g}:{},...j?{"x-basehub-fallback-playground-target":j.target,"x-basehub-fallback-playground-id":j.id}:{}},l=n({headers:k});if(!i){let a=s.get(l);if(a)return a}let m=function(a,b){let c;switch(!0){case a.origin.includes("api.bshb.dev"):c="https://basehub.dev"+b+a.search+a.hash;break;case a.origin.includes("localhost:3001"):c="http://localhost:3000"+b+a.search+a.hash;break;case a.origin.includes("api.basehub.com"):default:c="https://basehub.com"+b+a.search+a.hash}return c}(a,"/api/git/resolve-ref"),o=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",...k},cache:"no-store",body:JSON.stringify({})});if(200!==o.status)throw Error(`Failed to resolve ref: ${o.statusText}`);let p=await o.json();return s.set(l,p),p}a.s(["basehubClient",0,b=>{var c;return(c={token:process.env.BASEHUB_TOKEN||process.env.BASEHUB_API_TOKEN,draft:b??"true"===process.env.BASEHUB_DRAFT,ref:process.env.BASEHUB_REF}).getExtraFetchOptions=async(b,d,e)=>{let{url:f,headers:g,sdkBuildId:h,draft:i}=await r(c),j={url:f,headers:{...g}};if("query"!==b)return j;let k=!1;if(i&&(j.next={revalidate:void 0},j.cache="no-store"),i)return j;if(!o()&&void 0===c?.next){try{k=!!await a.A(16534)}catch(a){}if(k){let a=function({query:a,sdkBuildId:b}){return"basehub-"+n({...a,sdkBuildId:b})}({query:e,sdkBuildId:h});j.next={tags:[a]},j.headers={...j.headers,"x-basehub-cache-tag":a}}}return j},l(c)}],70918)}];

//# sourceMappingURL=lib_basehub_ts_4506bc59._.js.map