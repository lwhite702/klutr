{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/lee/Noteornope/lib/posthog/client.ts"],"sourcesContent":["/**\n * PostHog Client-Side Integration\n * \n * Provides singleton PostHog client instance for browser-side analytics and feature flags.\n * Initializes only on client-side to avoid SSR issues.\n */\n\nimport posthog from \"posthog-js\";\n\nlet posthogClient: typeof posthog | null = null;\nlet isInitialized = false;\nlet initPromise: Promise<void> | null = null;\n\n/**\n * Initialize PostHog client (singleton pattern)\n * Only initializes once, even if called multiple times\n */\nexport function initPostHog(): void {\n  // Only initialize on client-side\n  if (typeof window === \"undefined\") {\n    return;\n  }\n\n  // Return if already initialized\n  if (isInitialized && posthogClient) {\n    return;\n  }\n\n  // If initialization is in progress, return the existing promise\n  if (initPromise) {\n    return;\n  }\n\n  const apiKey = process.env.NEXT_PUBLIC_POSTHOG_KEY;\n  const apiHost = process.env.NEXT_PUBLIC_POSTHOG_HOST || \"https://us.posthog.com\";\n\n  if (!apiKey) {\n    console.warn(\"[PostHog] NEXT_PUBLIC_POSTHOG_KEY is not set. PostHog will not be initialized.\");\n    return;\n  }\n\n  // Initialize PostHog\n  posthog.init(apiKey, {\n    api_host: \"/ingest\", // Use Next.js rewrite proxy\n    ui_host: apiHost,\n    capture_exceptions: true,\n    debug: process.env.NODE_ENV === \"development\",\n    loaded: (posthog) => {\n      posthogClient = posthog;\n      isInitialized = true;\n      \n      // Set up feature flags ready callback\n      posthog.onFeatureFlags(() => {\n        if (process.env.NODE_ENV === \"development\") {\n          console.log(\"[PostHog] Feature flags loaded\");\n        }\n      });\n    },\n  });\n\n  posthogClient = posthog;\n}\n\n/**\n * Get PostHog client instance\n * Returns null if not initialized or on server-side\n */\nexport function getPostHogClient(): typeof posthog | null {\n  if (typeof window === \"undefined\") {\n    return null;\n  }\n\n  if (!isInitialized) {\n    initPostHog();\n  }\n\n  return posthogClient;\n}\n\n/**\n * Identify a user in PostHog\n * @param userId - User ID (typically Supabase user.id)\n * @param email - User email (optional)\n * @param properties - Additional user properties (optional)\n */\nexport function identifyUser(\n  userId: string,\n  email?: string,\n  properties?: Record<string, any>\n): void {\n  const client = getPostHogClient();\n  if (!client) {\n    return;\n  }\n\n  client.identify(userId, {\n    email,\n    ...properties,\n  });\n}\n\n/**\n * Reset user identification (call on logout)\n */\nexport function resetUser(): void {\n  const client = getPostHogClient();\n  if (!client) {\n    return;\n  }\n\n  client.reset();\n}\n\n/**\n * Check if a feature flag is enabled\n * Waits for PostHog to be ready before checking flags\n * @param flag - Feature flag key\n * @returns Promise that resolves to true if flag is enabled, false otherwise\n */\nexport async function isFeatureEnabled(flag: string): Promise<boolean> {\n  const client = getPostHogClient();\n  if (!client) {\n    return false;\n  }\n\n  // Wait for PostHog to be ready\n  return new Promise((resolve) => {\n    // Use onFeatureFlags callback to ensure flags are loaded\n    client!.onFeatureFlags(() => {\n      const enabled = client!.isFeatureEnabled(flag);\n      resolve(enabled ?? false);\n    });\n  });\n}\n\n/**\n * Get feature flag value (for multivariate flags)\n * @param flag - Feature flag key\n * @returns Promise that resolves to the flag value or null\n */\nexport async function getFeatureFlag(flag: string): Promise<string | boolean | null> {\n  const client = getPostHogClient();\n  if (!client) {\n    return null;\n  }\n\n  return new Promise((resolve) => {\n    client!.onFeatureFlags(() => {\n      const value = client!.getFeatureFlag(flag);\n      resolve(value ?? null);\n    });\n  });\n}\n\n/**\n * Get feature flag payload (for JSON payloads)\n * @param flag - Feature flag key\n * @returns Promise that resolves to the flag payload or null\n */\nexport async function getFeatureFlagPayload(flag: string): Promise<any> {\n  const client = getPostHogClient();\n  if (!client) {\n    return null;\n  }\n\n  return new Promise((resolve) => {\n    client!.onFeatureFlags(() => {\n      const payload = client!.getFeatureFlagPayload(flag);\n      resolve(payload ?? null);\n    });\n  });\n}\n\n/**\n * Reload feature flags from PostHog\n * Useful after user identification or when flags need to be refreshed\n * @returns Promise that resolves when flags are reloaded\n */\nexport async function reloadFeatureFlags(): Promise<void> {\n  const client = getPostHogClient();\n  if (!client) {\n    return;\n  }\n\n  return new Promise((resolve) => {\n    client!.onFeatureFlags(() => {\n      resolve();\n    });\n    client!.reloadFeatureFlags();\n  });\n}\n\n/**\n * Capture an event in PostHog\n * @param eventName - Event name\n * @param properties - Event properties (optional)\n */\nexport function captureEvent(eventName: string, properties?: Record<string, any>): void {\n  const client = getPostHogClient();\n  if (!client) {\n    return;\n  }\n\n  client.capture(eventName, properties);\n}\n\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;;;;;;;;;AA4BgB;AA1BjB;;AAEA,IAAI,gBAAuC;AAC3C,IAAI,gBAAgB;AACpB,IAAI,cAAoC;AAMjC,SAAS;IACd,iCAAiC;IACjC;;IAIA,gCAAgC;IAChC,IAAI,iBAAiB,eAAe;QAClC;IACF;IAEA,gEAAgE;IAChE;;IAIA,MAAM;IACN,MAAM,UAAU,gEAAwC;IAExD;;IAKA,qBAAqB;IACrB,yNAAO,CAAC,IAAI,CAAC,QAAQ;QACnB,UAAU;QACV,SAAS;QACT,oBAAoB;QACpB,OAAO,oDAAyB;QAChC,QAAQ,CAAC;YACP,gBAAgB;YAChB,gBAAgB;YAEhB,sCAAsC;YACtC,QAAQ,cAAc,CAAC;gBACrB,wCAA4C;oBAC1C,QAAQ,GAAG,CAAC;gBACd;YACF;QACF;IACF;IAEA,gBAAgB,yNAAO;AACzB;AAMO,SAAS;IACd;;IAIA,IAAI,CAAC,eAAe;QAClB;IACF;IAEA,OAAO;AACT;AAQO,SAAS,aACd,MAAc,EACd,KAAc,EACd,UAAgC;IAEhC,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX;IACF;IAEA,OAAO,QAAQ,CAAC,QAAQ;QACtB;QACA,GAAG,UAAU;IACf;AACF;AAKO,SAAS;IACd,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX;IACF;IAEA,OAAO,KAAK;AACd;AAQO,eAAe,iBAAiB,IAAY;IACjD,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,+BAA+B;IAC/B,OAAO,IAAI,QAAQ,CAAC;QAClB,yDAAyD;QACzD,OAAQ,cAAc,CAAC;YACrB,MAAM,UAAU,OAAQ,gBAAgB,CAAC;YACzC,QAAQ,WAAW;QACrB;IACF;AACF;AAOO,eAAe,eAAe,IAAY;IAC/C,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,OAAO,IAAI,QAAQ,CAAC;QAClB,OAAQ,cAAc,CAAC;YACrB,MAAM,QAAQ,OAAQ,cAAc,CAAC;YACrC,QAAQ,SAAS;QACnB;IACF;AACF;AAOO,eAAe,sBAAsB,IAAY;IACtD,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,OAAO,IAAI,QAAQ,CAAC;QAClB,OAAQ,cAAc,CAAC;YACrB,MAAM,UAAU,OAAQ,qBAAqB,CAAC;YAC9C,QAAQ,WAAW;QACrB;IACF;AACF;AAOO,eAAe;IACpB,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX;IACF;IAEA,OAAO,IAAI,QAAQ,CAAC;QAClB,OAAQ,cAAc,CAAC;YACrB;QACF;QACA,OAAQ,kBAAkB;IAC5B;AACF;AAOO,SAAS,aAAa,SAAiB,EAAE,UAAgC;IAC9E,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX;IACF;IAEA,OAAO,OAAO,CAAC,WAAW;AAC5B","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/lee/Noteornope/instrumentation-client.ts"],"sourcesContent":["/**\n * PostHog Client-Side Initialization\n *\n * This file is loaded by Next.js instrumentation system for client-side initialization.\n * The actual PostHog client is managed by lib/posthog/client.ts to ensure singleton pattern.\n */\n\nimport { initPostHog } from \"@/lib/posthog/client\";\n\n// Initialize PostHog on client-side\n// This is called automatically by Next.js instrumentation system\ninitPostHog();\n"],"names":[],"mappings":"AAAA;;;;;CAKC;AAED;;AAEA,oCAAoC;AACpC,iEAAiE;AACjE,IAAA,0IAAW","debugId":null}}]
}